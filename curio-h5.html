<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Curio H5 - Opening Sequence</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            margin: 0;
            padding: 0;
            background: #000;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
        }
        
        .mobile-container {
            width: 393px;
            height: 852px;
            position: relative;
            overflow: hidden;
        }
        
        /* First Page Styles */
        .page-1 {
            background: #221400;
            opacity: 1;
            transition: opacity 500ms ease-out;
        }
        
        .page-1 .bg-image {
            background-image: url('./src/assets/5fc9e58748a0fa615330e68c877a6fb860ab55a4.png');
            background-size: cover;
            background-position: center;
            animation: fadeInScale 500ms ease-out;
        }
        
        /* Second Page Styles */
        .page-2 {
            background: #221400;
            opacity: 0;
            transition: opacity 500ms ease-out;
        }
        
        .page-2 .bg-image {
            background-image: url('./src/assets/5fc9e58748a0fa615330e68c877a6fb860ab55a4.png');
            background-size: cover;
            background-position: center;
            animation: fadeIn 500ms ease-out;
        }
        
        .curio-title {
            animation: fadeIn 500ms ease-out;
        }
        
        /* Third Page Styles (Opening Page) */
        .page-3 {
            background-image: url('./src/assets/d8253cac2e39f67fcc735a3c279bbb3caac59cc5.png');
            background-size: cover;
            background-position: center;
            background-repeat: no-repeat;
            opacity: 0;
            transition: opacity 300ms ease-out;
        }
        
        /* Fourth Page Styles (Detail View) */
        .page-4 {
            background-image: url('./src/assets/2339a82e4b6020c219c18a48dca73ef3ba006ffe.png');
            background-size: cover;
            background-position: center;
            background-repeat: no-repeat;
            opacity: 0;
            transition: opacity 300ms ease-out;
        }
        
        /* Fifth Page Styles (Settings Modal) */
        .page-5 {
            background: #221400;
            opacity: 0;
            transition: opacity 300ms ease-out;
        }
        
        .settings-modal {
            background: #fffaf4;
            border-radius: 20px;
            width: 306px;
            height: 310px;
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            animation: modalSlideIn 300ms ease-out;
        }
        
        .settings-overlay {
            background: rgba(0,0,0,0.3);
            backdrop-filter: blur(4px);
        }
        
        .frame-176 {
            background-image: url('./src/assets/dff6fe23fdbc66a95b73bccee1330324b70d1957.png');
        }
        
        .frame-179 {
            background-image: url('./src/assets/e956d03147a1ec74c8563980180fa452db51f275.png');
        }
        
        .upload-button {
            backdrop-filter: blur(2.5px);
            background: rgba(255,255,255,0.3);
            border: 1px solid #c5c5c5;
        }
        
        .upload-button:hover {
            background: rgba(255,255,255,0.4);
        }
        
        .frame-hover:hover {
            transform: scale(1.05);
        }
        
        .opacity-hover:hover {
            opacity: 1;
        }
        
        .settings-hover:hover {
            transform: rotate(12deg);
        }
        
        /* Animations */
        @keyframes fadeInScale {
            0% {
                opacity: 0;
                transform: scale(0.9);
            }
            100% {
                opacity: 1;
                transform: scale(1);
            }
        }
        
        @keyframes fadeIn {
            0% {
                opacity: 0;
            }
            100% {
                opacity: 1;
            }
        }
        
        @keyframes slideIn {
            0% {
                opacity: 0;
                transform: translateY(50px);
            }
            100% {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        @keyframes titleFadeIn {
            0% {
                opacity: 0;
                transform: translateY(20px);
            }
            100% {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        @keyframes modalSlideIn {
            0% {
                opacity: 0;
                transform: translate(-50%, -50%) scale(0.9);
            }
            100% {
                opacity: 1;
                transform: translate(-50%, -50%) scale(1);
            }
        }

        @keyframes modalSlideOut {
            0% {
                opacity: 1;
                transform: translate(-50%, -50%) scale(1);
            }
            100% {
                opacity: 0;
                transform: translate(-50%, -50%) scale(0.9);
            }
        }

        /* Settings Modal */
        .page-5 {
            transition: opacity 0.3s ease, transform 0.3s ease;
            z-index: 1000;
        }

        .page-5.show {
            opacity: 1;
            transform: translateY(0);
            display: block;
        }

        .page-5.hidden {
            opacity: 0;
            transform: translateY(20px);
            display: none;
        }

        /* Character Preferences Modal */
        .character-preferences-modal {
            transition: opacity 0.3s ease, transform 0.3s ease;
        }

        .character-preferences-modal.show {
            opacity: 1;
            transform: translateY(0);
        }

        .character-preferences-modal.hide {
            opacity: 0;
            transform: translateY(20px);
        }

        .character-preference-btn {
            transition: color 0.2s ease;
        }

        .character-preference-btn:hover {
            color: #414141 !important;
        }

        .character-preference-btn.persistent {
            color: #414141 !important;
        }

        .character-preference-btn.non-persistent {
            color: #9d9c9b !important;
        }

        /* Image Upload Modal */
        .image-upload-modal {
            transition: opacity 0.3s ease, transform 0.3s ease;
        }

        .image-upload-modal.show {
            opacity: 1;
            transform: translateY(0);
        }

        .image-upload-modal.hide {
            opacity: 0;
            transform: translateY(20px);
        }
        
        /* General utility classes */
        .hidden {
            display: none !important;
        }

        .show {
            display: block !important;
        }
        
        /* Page visibility */
        .page-active {
            opacity: 1 !important;
        }
        
        .page-hidden {
            opacity: 0 !important;
        }
        
        /* Swipe and touch styles */
        .swipe-container {
            touch-action: pan-x;
            -webkit-overflow-scrolling: touch;
        }
        
        .gradient-overlay {
            background: linear-gradient(180deg, rgba(0,0,0,0) 0%, rgba(0,0,0,0.3) 39.9%);
            backdrop-filter: blur(1px);
        }
        
        /* Spinner animation for photo capture */
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Spinner animations for analysis and gallery pages */
        #cameraSpinner,
        #analyzingSpinner,
        #gallerySpinner {
            animation: spin 1s linear infinite;
        }

        /* Flash Effect Animation */
        @keyframes flashEffect {
            0% { opacity: 0; }
            50% { opacity: 1; }
            100% { opacity: 0; }
        }

        .flash {
            animation: flashEffect 0.3s ease-in-out;
        }

        /* Live Room Animations */
        @keyframes floatUp {
            0% {
                transform: translateY(0) scale(1);
                opacity: 1;
            }
            100% {
                transform: translateY(-200px) scale(0.8);
                opacity: 0;
            }
        }

        @keyframes chatSlideUp {
            0% {
                transform: translateY(0);
                opacity: 1;
            }
            80% {
                opacity: 1;
            }
            100% {
                transform: translateY(-50px);
                opacity: 0;
            }
        }

        /* Enhanced barrage scroll animation with stability fixes */
        @keyframes barrageScroll {
            0% {
                transform: translateY(0);
                opacity: 1;
            }
            95% {
                opacity: 1;
            }
            100% {
                transform: translateY(-40px);
                opacity: 0;
            }
        }

        .barrage-auto-scroll {
            animation: barrageScroll 15s linear infinite;
        }

        /* Improved continuous scrolling with natural flow */
        @keyframes continuousBarrageFlow {
            0% {
                transform: translateY(0);
            }
            100% {
                transform: translateY(-100%);
            }
        }

        .barrage-continuous-scroll {
            animation: continuousBarrageFlow 20s linear infinite;
        }

        /* New smooth message animation */
        @keyframes smoothMessageFlow {
            0% {
                transform: translateY(100%);
                opacity: 0;
            }
            10% {
                opacity: 1;
            }
            90% {
                opacity: 1;
            }
            100% {
                transform: translateY(-50px);
                opacity: 0;
            }
        }

        .smooth-message-flow {
            animation: smoothMessageFlow 12s ease-in-out infinite;
        }

        /* Enhanced emoji float animation with increased frequency */
        @keyframes enhancedFloatUp {
            0% {
                transform: translateY(0) scale(1) rotate(0deg);
                opacity: 1;
            }
            25% {
                transform: translateY(-50px) scale(1.1) rotate(5deg);
                opacity: 1;
            }
            50% {
                transform: translateY(-100px) scale(0.9) rotate(-3deg);
                opacity: 0.8;
            }
            75% {
                transform: translateY(-150px) scale(1.05) rotate(2deg);
                opacity: 0.6;
            }
            100% {
                transform: translateY(-200px) scale(0.8) rotate(0deg);
                opacity: 0;
            }
        }

        .enhanced-floating-emoji {
            animation: enhancedFloatUp 3s ease-out forwards;
        }

        /* Stabilize individual message animations */
        .chat-message {
            animation: messageStableFlow 0.5s ease-out;
        }

        @keyframes messageStableFlow {
            0% {
                opacity: 0;
                transform: translateY(10px);
            }
            100% {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* Subtle fade effect for messages at top and bottom - Now handled inline in HTML */
        /* #chatContainer::before and ::after removed for consistency with page 18 */

        .floating-emoji {
            animation: floatUp 1.5s ease-out forwards;
        }

        .floating-chat {
            animation: chatSlideUp 6s ease-out forwards;
        }

        /* Button press effects */
        .btn-pressed {
            transform: scale(0.95);
            background: rgba(0,0,0,0.6) !important;
        }

        /* Scroll behavior for chat */
        #chatContainer {
            scrollbar-width: thin;
            scrollbar-color: rgba(255,255,255,0.3) transparent;
        }
        #chatContainer::-webkit-scrollbar {
            width: 4px;
        }
        #chatContainer::-webkit-scrollbar-track {
            background: transparent;
        }
        #chatContainer::-webkit-scrollbar-thumb {
            background: rgba(255,255,255,0.3);
            border-radius: 2px;
        }
        #chatContainer::-webkit-scrollbar-thumb:hover {
            background: rgba(255,255,255,0.5);
        }

        /* Fade effect for new messages */
        .chat-message-new {
            animation: fadeInSlide 0.5s ease-out;
        }

        @keyframes fadeInSlide {
            0% {
                opacity: 0;
                transform: translateY(20px);
            }
            100% {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* Enhanced voice recording wave animation */
        @keyframes voiceWave {
            0%, 100% {
                transform: scaleX(1) scaleY(1);
                opacity: 0.8;
            }
            25% {
                transform: scaleX(1.1) scaleY(1.4);
                opacity: 1;
            }
            50% {
                transform: scaleX(0.9) scaleY(1.6);
                opacity: 0.9;
            }
            75% {
                transform: scaleX(1.2) scaleY(1.2);
                opacity: 1;
            }
        }

        /* Multi-bar wave animation for sound visualization */
        @keyframes waveBar1 {
            0%, 100% { transform: scaleY(0.5); }
            50% { transform: scaleY(1.2); }
        }
        
        @keyframes waveBar2 {
            0%, 100% { transform: scaleY(0.8); }
            50% { transform: scaleY(1.6); }
        }
        
        @keyframes waveBar3 {
            0%, 100% { transform: scaleY(0.3); }
            50% { transform: scaleY(1.0); }
        }

        .voice-wave-active {
            animation: voiceWave 1.2s ease-in-out infinite;
        }

        .voice-wave-bar-1 {
            animation: waveBar1 0.8s ease-in-out infinite;
        }
        
        .voice-wave-bar-2 {
            animation: waveBar2 1.0s ease-in-out infinite;
        }
        
        .voice-wave-bar-3 {
            animation: waveBar3 1.2s ease-in-out infinite;
        }

        /* Recording pulse effect for mic button */
        @keyframes recordingPulse {
            0%, 100% {
                transform: scale(1);
                box-shadow: 0 0 0 0 rgba(86, 66, 48, 0.7);
            }
            50% {
                transform: scale(1.05);
                box-shadow: 0 0 0 10px rgba(86, 66, 48, 0);
            }
        }

        .recording-active {
            animation: recordingPulse 2s ease-in-out infinite;
        }

        /* Enhanced smooth barrage scrolling system - Page 14 optimization */
        .barrage-scroll-container {
            position: relative;
            overflow: hidden;
        }

        .barrage-scroll-content {
            transform: translateY(0);
            transition: transform 0.3s ease-out;
        }

        .barrage-scroll-content.scrolling {
            animation: continuousBarrageFlow 25s linear infinite;
        }

        /* Page 14 specific barrage container styling - fade effects now handled inline */
        #page14ChatContainer {
            position: relative;
            overflow: hidden;
        }

        /* Timer display animation */
        @keyframes timerPulse {
            0%, 100% {
                transform: scale(1);
                opacity: 1;
            }
            50% {
                transform: scale(1.05);
                opacity: 0.9;
            }
        }

        .timer-active {
            animation: timerPulse 2s ease-in-out infinite;
        }

        /* Voice input status panel animation */
        @keyframes statusSlideIn {
            0% {
                opacity: 0;
                transform: translateY(20px) scale(0.95);
            }
            100% {
                opacity: 1;
                transform: translateY(0) scale(1);
            }
        }

        .voice-status-active {
            animation: statusSlideIn 0.3s ease-out;
        }

        /* Page 15 Character Info Scrollable Container */
        .character-info-scroll {
            scrollbar-width: thin;
            scrollbar-color: rgba(35, 35, 35, 0.3) transparent;
        }

        .character-info-scroll::-webkit-scrollbar {
            width: 4px;
        }

        .character-info-scroll::-webkit-scrollbar-track {
            background: transparent;
        }

        .character-info-scroll::-webkit-scrollbar-thumb {
            background: rgba(35, 35, 35, 0.3);
            border-radius: 2px;
        }

        .character-info-scroll::-webkit-scrollbar-thumb:hover {
            background: rgba(35, 35, 35, 0.5);
        }

        /* Smooth scroll behavior for touch devices */
        .character-info-scroll {
            -webkit-overflow-scrolling: touch;
            scroll-behavior: smooth;
        }
    </style>
</head>
<body>
    <div class="mobile-container">
        <!-- First Page - Initial Animation -->
        <div id="page1" class="page-1 absolute inset-0 w-full h-full page-active">
            <!-- Status bar -->
            <div class="absolute top-0 left-1/2 transform -translate-x-1/2 w-[393px] z-10">
                <div class="h-11 relative w-full">
                    <div class="absolute h-[22px] left-[26px] top-[15px] w-[54px]">
                        <div class="absolute font-semibold text-white text-[17px] text-center top-1/2 transform -translate-y-1/2 left-0 right-0">
                            <p class="leading-[22px]">12:15</p>
                        </div>
                    </div>
                    <div class="absolute right-[26.339px] top-[19.333px] w-[27.328px] h-[13px]">
                        <img alt="Battery" class="block max-w-none w-full h-full" src="./src/assets/c0c091687c62d7337bf318e17f3769ffc34d3a72.svg" />
                    </div>
                    <div class="absolute right-[61px] top-5 w-[17px] h-3">
                        <img alt="Wifi" class="block max-w-none w-full h-full" src="./src/assets/94bdfe1a8077b65bf75e0473782ae3df50cd473f.svg" />
                    </div>
                    <div class="absolute right-[85.4px] top-5 w-[19.2px] h-3">
                        <img alt="Cellular" class="block max-w-none w-full h-full" src="./src/assets/a883d1003c9c8d00c12b4d64e84ed02fcbbf9603.svg" />
                    </div>
                </div>
            </div>
            
            <!-- Background Museum Image -->
            <div class="bg-image absolute h-[852px] left-[-133px] top-0 w-[642px]"></div>
            
            <!-- Home Indicator -->
            <div class="absolute bottom-0 left-0 w-full h-[34px] flex items-center justify-center">
                <div class="w-[134px] h-[5px] bg-[#919191] rounded-[2.5px]"></div>
            </div>
            
            <!-- Gradient Overlay -->
            <div class="absolute h-[679px] left-0 top-0 w-[393px]">
                <div class="absolute inset-0 transform scale-110">
                    <img alt="" class="block max-w-none w-full h-full" src="./src/assets/dfe86cdbd174503d7f6537ed4fda64d4e43bd67e.svg" />
                </div>
            </div>
        </div>

        <!-- Second Page - Transition Animation -->
        <div id="page2" class="page-2 absolute inset-0 w-full h-full">
            <!-- Status bar -->
            <div class="absolute top-0 left-1/2 transform -translate-x-1/2 w-[393px] z-10">
                <div class="h-11 relative w-full">
                    <div class="absolute h-[22px] left-[26px] top-[15px] w-[54px]">
                        <div class="absolute font-semibold text-white text-[17px] text-center top-1/2 transform -translate-y-1/2 left-0 right-0">
                            <p class="leading-[22px]">12:15</p>
                        </div>
                    </div>
                    <div class="absolute right-[26.339px] top-[19.333px] w-[27.328px] h-[13px]">
                        <img alt="Battery" class="block max-w-none w-full h-full" src="./src/assets/c0c091687c62d7337bf318e17f3769ffc34d3a72.svg" />
                    </div>
                    <div class="absolute right-[61px] top-5 w-[17px] h-3">
                        <img alt="Wifi" class="block max-w-none w-full h-full" src="./src/assets/94bdfe1a8077b65bf75e0473782ae3df50cd473f.svg" />
                    </div>
                    <div class="absolute right-[85.4px] top-5 w-[19.2px] h-3">
                        <img alt="Cellular" class="block max-w-none w-full h-full" src="./src/assets/a883d1003c9c8d00c12b4d64e84ed02fcbbf9603.svg" />
                    </div>
                </div>
            </div>
            
            <!-- Background Museum Image -->
            <div class="bg-image absolute h-[852px] left-[-133px] top-0 w-[642px]"></div>
            
            <!-- CURIO Title -->
            <div class="absolute left-1/2 top-[185px] transform -translate-x-1/2 curio-title">
                <h1 class="text-white text-[48px] font-black leading-[50px] text-center whitespace-nowrap" style="font-family: 'ABC Ginto Nord Unlicensed Trial', sans-serif; font-weight: 900;">CURIO</h1>
            </div>
            
            <!-- Home Indicator -->
            <div class="absolute bottom-0 left-0 w-full h-[34px] flex items-center justify-center">
                <div class="w-[134px] h-[5px] bg-[#919191] rounded-[2.5px]"></div>
            </div>
        </div>

        <!-- Third Page - Opening Page (Interactive) -->
        <div id="page3" class="page-3 absolute inset-0 w-full h-full">
            <!-- Status bar -->
            <div class="absolute top-0 left-1/2 transform -translate-x-1/2 w-[393px] z-10">
                <div class="h-11 relative w-full">
                    <div class="absolute h-[22px] left-[26px] top-[15px] w-[54px]">
                        <div class="absolute font-semibold text-white text-[17px] text-center top-1/2 transform -translate-y-1/2 left-0 right-0">
                            <p class="leading-[22px]">12:15</p>
                        </div>
                    </div>
                    <div class="absolute right-[26.339px] top-[19.333px] w-[27.328px] h-[13px]">
                        <img alt="Battery" class="block max-w-none w-full h-full" src="./src/assets/c0c091687c62d7337bf318e17f3769ffc34d3a72.svg" />
                    </div>
                    <div class="absolute right-[61px] top-5 w-[17px] h-3">
                        <img alt="Wifi" class="block max-w-none w-full h-full" src="./src/assets/94bdfe1a8077b65bf75e0473782ae3df50cd473f.svg" />
                    </div>
                    <div class="absolute right-[85.4px] top-5 w-[19.2px] h-3">
                        <img alt="Cellular" class="block max-w-none w-full h-full" src="./src/assets/a883d1003c9c8d00c12b4d64e84ed02fcbbf9603.svg" />
                    </div>
                </div>
            </div>

            <!-- Home Indicator -->
            <div class="absolute bottom-0 left-0 w-full h-[34px] flex items-center justify-center">
                <div class="w-[134px] h-[5px] bg-[#919191] rounded-[2.5px]"></div>
            </div>

            <!-- Upload Button -->
            <div id="uploadButton" class="absolute top-[649px] left-1/2 transform -translate-x-1/2 w-[222px] h-[55px] flex items-center justify-center px-[23px] rounded-[20px] cursor-pointer upload-button transition-all duration-200" style="z-index: 100;">
                <p class="text-white text-[20px] font-medium text-center whitespace-nowrap">Upload an image</p>
            </div>

            <!-- Picture Frames -->
            <div class="absolute left-14 top-[158px] flex flex-row gap-[23px] items-center">
                <!-- Main Frame -->
                <div class="frame-176 bg-center bg-cover bg-no-repeat w-[281px] h-[421px] frame-hover transition-transform duration-300 cursor-pointer shadow-2xl"></div>
                <!-- Secondary Frame -->
                <div class="frame-179 bg-center bg-cover bg-no-repeat w-[262px] h-[339px] opacity-70 opacity-hover transition-opacity duration-300 cursor-pointer shadow-2xl" style="background-size: 119.54% 130.58%; background-position: 66.1% 51.25%;"></div>
            </div>

            <!-- Settings Icon -->
            <div id="settingsIcon" class="absolute left-[341px] top-[58px] w-[26px] h-[26px] cursor-pointer settings-hover transition-transform duration-200" style="z-index: 100;" onclick="console.log('Settings clicked on page 3!'); handleSettings(); event.stopPropagation();">
                <div class="relative w-full h-full">
                    <div class="absolute bottom-[5.313%] left-[2.812%] right-[2.713%] top-[5.312%]">
                        <img alt="Settings" class="block max-w-none w-full h-full" src="./src/assets/1009f07f9dd6944bb263d745bad2a94943c5a897.svg" />
                    </div>
                </div>
            </div>
        </div>

        <!-- Fourth Page - Detail View (Swipe right from opening page) -->
        <div id="page4" class="page-4 absolute inset-0 w-full h-full swipe-container">
            <!-- Status bar -->
            <div class="absolute top-0 left-1/2 transform -translate-x-1/2 w-[393px] z-10">
                <div class="h-11 relative w-full">
                    <div class="absolute h-[22px] left-[26px] top-[15px] w-[54px]">
                        <div class="absolute font-semibold text-white text-[17px] text-center top-1/2 transform -translate-y-1/2 left-0 right-0">
                            <p class="leading-[22px]">12:15</p>
                        </div>
                    </div>
                    <div class="absolute right-[26.339px] top-[19.333px] w-[27.328px] h-[13px]">
                        <img alt="Battery" class="block max-w-none w-full h-full" src="./src/assets/c0c091687c62d7337bf318e17f3769ffc34d3a72.svg" />
                    </div>
                    <div class="absolute right-[61px] top-5 w-[17px] h-3">
                        <img alt="Wifi" class="block max-w-none w-full h-full" src="./src/assets/94bdfe1a8077b65bf75e0473782ae3df50cd473f.svg" />
                    </div>
                    <div class="absolute right-[85.4px] top-5 w-[19.2px] h-3">
                        <img alt="Cellular" class="block max-w-none w-full h-full" src="./src/assets/a883d1003c9c8d00c12b4d64e84ed02fcbbf9603.svg" />
                    </div>
                </div>
            </div>

            <!-- Gradient Overlay -->
            <div class="absolute h-[295px] left-0 top-[557px] w-[393px] gradient-overlay"></div>

            <!-- Clickable Picture Frame Area (for live room) -->
            <div id="pictureFrameClick" class="absolute left-[50px] top-[120px] w-[293px] h-[400px] cursor-pointer z-20" onclick="showLiveRoom(); event.stopPropagation();">
                <!-- Invisible clickable area over the picture frame -->
            </div>

            <!-- Content Text -->
            <div class="absolute left-1/2 top-[592px] transform -translate-x-1/2 w-[393px] flex flex-col items-center justify-start p-0">
                <div class="flex flex-col gap-2 items-center justify-start w-[313px] text-center">
                    <!-- Title -->
                    <div class="text-white text-[20px] font-black leading-[1.6] w-full" style="font-family: 'ABC Ginto Normal Unlicensed Trial', sans-serif;">
                        <p>The Enigmatic Aristocat</p>
                    </div>
                    <!-- Date -->
                    <div class="text-[#b9b9b9] text-[16px] font-medium leading-[1.6] w-full" style="font-family: 'Avenir LT Std', sans-serif;">
                        <p>July 8, 3:42PM</p>
                    </div>
                    <!-- Description -->
                    <div class="text-white text-[14px] italic leading-[1.6] w-full" style="font-family: 'Avenir LT Std', sans-serif;">
                        <p>This Persian might featured in Tissot's 1866 portrait of the Marquise de Miramon epitomizes Victorian aristocratic cats, its gemstone eyes echoing the luxury of Empress Eugénie's court pets....</p>
                    </div>
                </div>
            </div>

            <!-- Settings Icon -->
            <div class="absolute left-[341px] top-[58px] w-[26px] h-[26px] cursor-pointer settings-hover transition-transform duration-200" style="z-index: 100;" onclick="console.log('Settings clicked on page 4!'); handleSettings(); event.stopPropagation();">
                <img alt="Settings" class="block max-w-none w-full h-full" src="./src/assets/93a02d26a502971a89c3344708fc357ec3d89403.svg" />
            </div>

            <!-- Home Indicator -->
            <div class="absolute bottom-0 left-0 w-full h-[34px] flex items-center justify-center">
                <div class="w-[134px] h-[5px] bg-[#919191] rounded-[2.5px]"></div>
            </div>
        </div>

        <!-- Fifth Page - Settings Modal -->
        <div id="page5" class="page-5 absolute inset-0 w-full h-full hidden">
            <!-- Background with overlay -->
            <div class="absolute inset-0 bg-[rgba(0,0,0,0.3)] backdrop-blur-[2.5px]"></div>
            
            <!-- Blurred background content -->
            <div class="absolute inset-0" style="filter: blur(2px);">
                <!-- Status bar -->
                <div class="absolute top-0 left-1/2 transform -translate-x-1/2 w-[393px] z-10">
                    <div class="h-11 relative w-full">
                        <div class="absolute h-[22px] left-[26px] top-[15px] w-[54px]">
                            <div class="absolute font-semibold text-white text-[17px] text-center top-1/2 transform -translate-y-1/2 left-0 right-0" style="font-family: 'SF Pro Text', sans-serif;">
                                <p class="leading-[22px]">12:15</p>
                            </div>
                        </div>
                        <div class="absolute right-[26.339px] top-[19.333px] w-[27.328px] h-[13px]">
                            <img alt="Battery" class="block max-w-none w-full h-full" src="./src/assets/c0c091687c62d7337bf318e17f3769ffc34d3a72.svg" />
                        </div>
                        <div class="absolute right-[61px] top-5 w-[17px] h-3">
                            <img alt="Wifi" class="block max-w-none w-full h-full" src="./src/assets/94bdfe1a8077b65bf75e0473782ae3df50cd473f.svg" />
                        </div>
                        <div class="absolute right-[85.4px] top-5 w-[19.2px] h-3">
                            <img alt="Cellular" class="block max-w-none w-full h-full" src="./src/assets/a883d1003c9c8d00c12b4d64e84ed02fcbbf9603.svg" />
                        </div>
                    </div>
                </div>

                <!-- Background Museum Image -->
                <div class="absolute w-[479px] h-[852px] top-0 left-[-41px] opacity-70" style="background-image: url('./src/assets/cc8c0a6205dd7253e86ab080322dec689122ecb2.png'); background-size: cover; background-position: center;"></div>

                <!-- Upload Button -->
                <div class="absolute top-[649px] left-1/2 transform -translate-x-1/2 w-[222px] h-[55px] bg-[rgba(255,255,255,0.3)] backdrop-blur-[2.5px] border border-[#c5c5c5] rounded-[20px] flex items-center justify-center px-[23px]">
                    <p class="text-white text-[20px] font-medium text-center whitespace-nowrap" style="font-family: 'ABC Ginto Plus Variable', sans-serif;">Upload an image</p>
                </div>

                <!-- Picture Frames -->
                <div class="absolute left-14 top-[158px] flex flex-row gap-[23px] items-center">
                    <div class="bg-center bg-cover bg-no-repeat w-[281px] h-[421px]" style="background-image: url('./src/assets/dff6fe23fdbc66a95b73bccee1330324b70d1957.png'); box-shadow: 82px 201px 61px 0px rgba(0,0,0,0.01), 53px 128px 56px 0px rgba(0,0,0,0.06), 30px 72px 47px 0px rgba(0,0,0,0.2), 13px 32px 35px 0px rgba(0,0,0,0.34), 3px 8px 19px 0px rgba(0,0,0,0.39);"></div>
                    <div class="bg-[12.08%_51.25%] bg-no-repeat bg-size-[949.05%_130.58%] w-[33px] h-[339px] opacity-70" style="background-image: url('./src/assets/e956d03147a1ec74c8563980180fa452db51f275.png'); box-shadow: 82px 201px 61px 0px rgba(0,0,0,0.01), 53px 128px 56px 0px rgba(0,0,0,0.06), 30px 72px 47px 0px rgba(0,0,0,0.2), 13px 32px 35px 0px rgba(0,0,0,0.34), 3px 8px 19px 0px rgba(0,0,0,0.39);"></div>
                </div>

                <!-- Settings Icon -->
                <div class="absolute left-[341px] top-[58px] w-[26px] h-[26px]">
                    <img alt="Settings" class="block max-w-none w-full h-full" src="./src/assets/93a02d26a502971a89c3344708fc357ec3d89403.svg" />
                </div>

                <!-- Home Indicator -->
                <div class="absolute bottom-0 left-0 w-full h-[34px] flex items-center justify-center">
                    <div class="w-[134px] h-[5px] bg-[#919191] rounded-[2.5px]"></div>
                </div>
            </div>

            <!-- Settings Modal -->
            <div class="absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 w-[306px] h-[310px] bg-[#fffaf4] rounded-[20px] z-20">
                <!-- Back Button -->
                <div class="absolute left-[9px] top-[9px] w-9 h-9 cursor-pointer" onclick="handleBackFromSettings()">
                    <img alt="Back" class="block max-w-none w-full h-full" src="./src/assets/d23e0c72b637adf4346f1d26038aa38e3d04555c.svg" />
                </div>

                <!-- User Profile -->
                <div class="absolute left-[25px] top-[52px] w-[67px] h-[67px]">
                    <img alt="User Avatar" class="block max-w-none w-full h-full rounded-full" src="./src/assets/fb5cbc298c5f876217f162c4522b076b5a9b5e05.png" />
                </div>

                <!-- User Info -->
                <div class="absolute left-[109px] top-[63px] w-[123px]">
                    <div class="text-[#232323] text-[18px] font-medium opacity-90 min-w-full" style="font-family: 'Avenir LT Std', sans-serif; width: min-content;">
                        <p class="leading-[1.45]">Stellar</p>
                    </div>
                    <div class="text-[#868686] text-[12px] opacity-90 w-[123px] mt-1" style="font-family: 'Avenir LT Std', sans-serif;">
                        <p class="leading-[1.45]">yixin_xia@outlook.com</p>
                    </div>
                </div>

                <!-- Edit Profile Icon -->
                <div class="absolute right-[31px] top-[74px] w-5 h-5 cursor-pointer">
                    <img alt="Edit" class="block max-w-none w-full h-full" src="./src/assets/7faef64d7c5e8cef9ffa7a192c5547d519f1ccda.svg" />
                </div>

                <!-- Language Setting -->
                <div class="absolute left-[30px] top-[141px] w-[248px] flex justify-between items-center">
                    <div class="text-[#232323] text-[15px] opacity-90" style="font-family: 'Avenir LT Std', sans-serif;">
                        <p class="leading-[1.45]">Language</p>
                    </div>
                    <button id="languageToggle" class="text-[#474747] text-[15px] opacity-90 cursor-pointer h-[22px] w-[49px]" style="font-family: 'Avenir LT Std', sans-serif;" onclick="handleLanguageChange()">
                        <p class="leading-[1.45] text-left">English</p>
                    </button>
                </div>

                <!-- Character Preferences Label -->
                <div class="absolute left-[30px] top-[185px]">
                    <div class="text-[#232323] text-[15px] opacity-90 cursor-pointer" style="font-family: 'Avenir LT Std', sans-serif;" onclick="showCharacterPreferences()">
                        <p class="leading-[1.45]">Character preferences</p>
                    </div>
                </div>

                <!-- Character Options -->
                <div class="absolute left-[30px] top-[223px] flex gap-4 justify-start">
                    <!-- Persistent Character -->
                    <div class="flex flex-col items-center gap-[3px] w-[52px] cursor-pointer" onclick="selectCharacter('persistent')">
                        <div class="w-[34px] h-[34px]">
                            <img alt="Persistent Character" class="block max-w-none w-full h-full" src="./src/assets/b1dd7f79b12cdc736f7de02e2fb9af5799c2c6aa.png" />
                        </div>
                        <div class="text-[#9d9c9b] text-[12px] opacity-90 text-center w-[53px]" style="font-family: 'Avenir LT Std', sans-serif;">
                            <p class="leading-[1.45]">Persistent</p>
                        </div>
                    </div>

                    <!-- Random Characters -->
                    <div class="flex flex-col items-center gap-[3px] w-[45px] cursor-pointer" onclick="selectCharacter('random1')">
                        <div class="w-[34px] h-[34px] bg-[#d9d9d9] rounded-[17px] flex items-center justify-center p-[10px]">
                            <div class="w-3.5 h-3.5">
                                <img alt="Edit" class="block max-w-none w-full h-full" src="./src/assets/8841b1f2c088840aaa77a574202015e5db962382.svg" />
                            </div>
                        </div>
                        <div class="text-[#9d9c9b] text-[12px] opacity-90 text-center min-w-full" style="font-family: 'Avenir LT Std', sans-serif; width: min-content;">
                            <p class="leading-[1.45]">Random</p>
                        </div>
                    </div>

                    <div class="flex flex-col items-center gap-[3px] w-[45px] cursor-pointer" onclick="selectCharacter('random2')">
                        <div class="w-[34px] h-[34px] bg-[#d9d9d9] rounded-[17px] flex items-center justify-center p-[10px]">
                            <div class="w-3.5 h-3.5">
                                <img alt="Edit" class="block max-w-none w-full h-full" src="./src/assets/8841b1f2c088840aaa77a574202015e5db962382.svg" />
                            </div>
                        </div>
                        <div class="text-[#9d9c9b] text-[12px] opacity-90 text-center min-w-full" style="font-family: 'Avenir LT Std', sans-serif; width: min-content;">
                            <p class="leading-[1.45]">Random</p>
                        </div>
                    </div>

                    <div class="flex flex-col items-center gap-[3px] w-[45px] cursor-pointer" onclick="selectCharacter('random3')">
                        <div class="w-[34px] h-[34px] bg-[#d9d9d9] rounded-[17px] flex items-center justify-center p-[10px]">
                            <div class="w-3.5 h-3.5">
                                <img alt="Edit" class="block max-w-none w-full h-full" src="./src/assets/8841b1f2c088840aaa77a574202015e5db962382.svg" />
                            </div>
                        </div>
                        <div class="text-[#9d9c9b] text-[12px] opacity-90 text-center min-w-full" style="font-family: 'Avenir LT Std', sans-serif; width: min-content;">
                            <p class="leading-[1.45]">Random</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

        <!-- Sixth Page - Character Preferences (Modal overlay over Page 5 Settings) -->
        <div id="page6" class="character-preferences-modal absolute inset-0 w-full h-full z-50 hidden">
            <!-- Background with overlay -->
            <div class="absolute inset-0 bg-[rgba(0,0,0,0.3)] backdrop-blur-[2.5px]"></div>
            
            <!-- Blurred background content -->
            <div class="absolute inset-0" style="filter: blur(2px);">
                <!-- Status bar -->
                <div class="absolute top-0 left-1/2 transform -translate-x-1/2 w-[393px] z-10">
                    <div class="h-11 relative w-full">
                        <div class="absolute h-[22px] left-[26px] top-[15px] w-[54px]">
                            <div class="absolute font-semibold text-white text-[17px] text-center top-1/2 transform -translate-y-1/2 left-0 right-0" style="font-family: 'SF Pro Text', sans-serif;">
                                <p class="leading-[22px]">12:15</p>
                            </div>
                        </div>
                        <div class="absolute right-[26.339px] top-[19.333px] w-[27.328px] h-[13px]">
                            <img alt="Battery" class="block max-w-none w-full h-full" src="./src/assets/c0c091687c62d7337bf318e17f3769ffc34d3a72.svg" />
                        </div>
                        <div class="absolute right-[61px] top-5 w-[17px] h-3">
                            <img alt="Wifi" class="block max-w-none w-full h-full" src="./src/assets/94bdfe1a8077b65bf75e0473782ae3df50cd473f.svg" />
                        </div>
                        <div class="absolute right-[85.4px] top-5 w-[19.2px] h-3">
                            <img alt="Cellular" class="block max-w-none w-full h-full" src="./src/assets/a883d1003c9c8d00c12b4d64e84ed02fcbbf9603.svg" />
                        </div>
                    </div>
                </div>

                <!-- Background Museum Image -->
                <div class="absolute w-[479px] h-[852px] top-0 left-[-41px] opacity-70" style="background-image: url('./src/assets/cc8c0a6205dd7253e86ab080322dec689122ecb2.png'); background-size: cover; background-position: center;"></div>

                <!-- Upload Button -->
                <div class="absolute top-[649px] left-1/2 transform -translate-x-1/2 w-[222px] h-[55px] bg-[rgba(255,255,255,0.3)] backdrop-blur-[2.5px] border border-[#c5c5c5] rounded-[20px] flex items-center justify-center px-[23px]">
                    <p class="text-white text-[20px] font-medium text-center whitespace-nowrap" style="font-family: 'ABC Ginto Plus Variable', sans-serif;">Upload an image</p>
                </div>

                <!-- Picture Frames -->
                <div class="absolute left-14 top-[158px] flex flex-row gap-[23px] items-center">
                    <div class="bg-center bg-cover bg-no-repeat w-[281px] h-[421px]" style="background-image: url('./src/assets/dff6fe23fdbc66a95b73bccee1330324b70d1957.png'); box-shadow: 82px 201px 61px 0px rgba(0,0,0,0.01), 53px 128px 56px 0px rgba(0,0,0,0.06), 30px 72px 47px 0px rgba(0,0,0,0.2), 13px 32px 35px 0px rgba(0,0,0,0.34), 3px 8px 19px 0px rgba(0,0,0,0.39);"></div>
                    <div class="bg-[66.1%_51.25%] bg-no-repeat bg-size-[119.54%_130.58%] w-[262px] h-[339px] opacity-70" style="background-image: url('./src/assets/e956d03147a1ec74c8563980180fa452db51f275.png'); box-shadow: 82px 201px 61px 0px rgba(0,0,0,0.01), 53px 128px 56px 0px rgba(0,0,0,0.06), 30px 72px 47px 0px rgba(0,0,0,0.2), 13px 32px 35px 0px rgba(0,0,0,0.34), 3px 8px 19px 0px rgba(0,0,0,0.39);"></div>
                </div>

                <!-- Settings Icon -->
                <div class="absolute left-[341px] top-[58px] w-[26px] h-[26px]">
                    <img alt="Settings" class="block max-w-none w-full h-full" src="./src/assets/93a02d26a502971a89c3344708fc357ec3d89403.svg" />
                </div>

                <!-- Home Indicator -->
                <div class="absolute bottom-0 left-0 w-full h-[34px] flex items-center justify-center">
                    <div class="w-[134px] h-[5px] bg-[#919191] rounded-[2.5px]"></div>
                </div>
            </div>
            
            <!-- Character Preferences Modal -->
            <div class="absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 w-[306px] h-[363px] bg-[#fffaf4] rounded-[20px] overflow-hidden z-20">
                <!-- Back button -->
                <div class="absolute left-2.5 top-2 w-9 h-9 cursor-pointer" onclick="handleBackFromCharacterPreferences()">
                    <img alt="Back" class="block max-w-none w-full h-full" src="./src/assets/2621e254e3919decc1af055e547ebfde75047248.svg" />
                </div>

                <!-- Character List -->
                <div class="absolute left-1/2 top-[58px] transform -translate-x-1/2 w-[264px]">
                    <!-- Qianlong - Persistent -->
                    <div class="flex flex-row items-center justify-between w-full h-[35px] mb-[21px]">
                        <div class="flex flex-row gap-[17px] items-center">
                            <div class="w-[35px] h-[35px]">
                                <img alt="Qianlong" class="block max-w-none w-full h-full" src="./src/assets/9e8da1aaa67380d9c1c0e5906f5b79026ff3167a.png" />
                            </div>
                            <div class="text-[#232323] text-[15px] opacity-90" style="font-family: 'Avenir LT Std', sans-serif;">
                                <p class="leading-[1.45]">Qianlong</p>
                            </div>
                        </div>
                        <button class="character-preference-btn text-[#414141] text-[14px] opacity-90 cursor-pointer persistent h-5 w-[62px]" style="font-family: 'Avenir LT Std', sans-serif;" data-character="qianlong" data-state="persistent" onclick="toggleCharacterPreference(this)">
                            <p class="leading-[1.45] text-left">Persistent</p>
                        </button>
                    </div>

                    <!-- Lu Guimeng - Non-Persistent -->
                    <div class="flex flex-row items-center justify-between w-full h-[35px] mb-[21px]">
                        <div class="flex flex-row gap-[17px] items-center">
                            <div class="w-[35px] h-[35px]">
                                <img alt="Lu Guimeng" class="block max-w-none w-full h-full" src="./src/assets/f38ee0e627dac5be13c6dd369debb8d215e09e11.png" />
                            </div>
                            <div class="text-[#232323] text-[15px] opacity-90" style="font-family: 'Avenir LT Std', sans-serif;">
                                <p class="leading-[1.45]">Lu Guimeng</p>
                            </div>
                        </div>
                        <button class="character-preference-btn text-[#9d9c9b] text-[14px] opacity-90 cursor-pointer non-persistent h-5 w-[94px]" style="font-family: 'Avenir LT Std', sans-serif;" data-character="luguimeng" data-state="non-persistent" onclick="toggleCharacterPreference(this)">
                            <p class="leading-[1.45] text-left">Non-Persistent</p>
                        </button>
                    </div>

                    <!-- Random Character 1 -->
                    <div class="flex flex-row items-center justify-between w-full h-[35px] mb-[21px]">
                        <div class="flex flex-row gap-[17px] items-center">
                            <div class="w-[35px] h-[35px]">
                                <img alt="Random" class="block max-w-none w-full h-full" src="./src/assets/dbafd500e525fe7968cbb10e87c566d74c7cf348.svg" />
                            </div>
                            <div class="text-[#232323] text-[15px] opacity-90" style="font-family: 'Avenir LT Std', sans-serif;">
                                <p class="leading-[1.45]">Random</p>
                            </div>
                        </div>
                        <button class="character-preference-btn text-[#9d9c9b] text-[14px] opacity-90 cursor-pointer non-persistent h-5 w-[94px]" style="font-family: 'Avenir LT Std', sans-serif;" data-character="random1" data-state="non-persistent" onclick="toggleCharacterPreference(this)">
                            <p class="leading-[1.45] text-left">Non-Persistent</p>
                        </button>
                    </div>

                    <!-- Random Character 2 -->
                    <div class="flex flex-row items-center justify-between w-full h-[35px] mb-[21px]">
                        <div class="flex flex-row gap-[17px] items-center">
                            <div class="w-[35px] h-[35px]">
                                <img alt="Random" class="block max-w-none w-full h-full" src="./src/assets/dbafd500e525fe7968cbb10e87c566d74c7cf348.svg" />
                            </div>
                            <div class="text-[#232323] text-[15px] opacity-90" style="font-family: 'Avenir LT Std', sans-serif;">
                                <p class="leading-[1.45]">Random</p>
                            </div>
                        </div>
                        <button class="character-preference-btn text-[#9d9c9b] text-[14px] opacity-90 cursor-pointer non-persistent h-5 w-[94px]" style="font-family: 'Avenir LT Std', sans-serif;" data-character="random2" data-state="non-persistent" onclick="toggleCharacterPreference(this)">
                            <p class="leading-[1.45] text-left">Non-Persistent</p>
                        </button>
                    </div>

                    <!-- Random Character 3 -->
                    <div class="flex flex-row items-center justify-between w-full h-[35px] mb-[21px]">
                        <div class="flex flex-row gap-[17px] items-center">
                            <div class="w-[35px] h-[35px]">
                                <img alt="Random" class="block max-w-none w-full h-full" src="./src/assets/dbafd500e525fe7968cbb10e87c566d74c7cf348.svg" />
                            </div>
                            <div class="text-[#232323] text-[15px] opacity-90" style="font-family: 'Avenir LT Std', sans-serif;">
                                <p class="leading-[1.45]">Random</p>
                            </div>
                        </div>
                        <button class="character-preference-btn text-[#9d9c9b] text-[14px] opacity-90 cursor-pointer non-persistent h-5 w-[94px]" style="font-family: 'Avenir LT Std', sans-serif;" data-character="random3" data-state="non-persistent" onclick="toggleCharacterPreference(this)">
                            <p class="leading-[1.45] text-left">Non-Persistent</p>
                        </button>
                    </div>

                    <!-- Random Character 4 -->
                    <div class="flex flex-row items-center justify-between w-full h-[35px]">
                        <div class="flex flex-row gap-[17px] items-center">
                            <div class="w-[35px] h-[35px]">
                                <img alt="Random" class="block max-w-none w-full h-full" src="./src/assets/dbafd500e525fe7968cbb10e87c566d74c7cf348.svg" />
                            </div>
                            <div class="text-[#232323] text-[15px] opacity-90" style="font-family: 'Avenir LT Std', sans-serif;">
                                <p class="leading-[1.45]">Random</p>
                            </div>
                        </div>
                        <button class="character-preference-btn text-[#9d9c9b] text-[14px] opacity-90 cursor-pointer non-persistent h-5 w-[94px]" style="font-family: 'Avenir LT Std', sans-serif;" data-character="random4" data-state="non-persistent" onclick="toggleCharacterPreference(this)">
                            <p class="leading-[1.45] text-left">Non-Persistent</p>
                        </button>
                    </div>
                </div>
            </div>
        </div>    <!-- Seventh Page - Image Upload Options (Mobile Scale 393x852px) -->
    <div id="page7" class="mobile-container absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 z-50 hidden" style="width: 393px; height: 852px;">
        <!-- Dark overlay background -->
        <div class="absolute inset-0 z-10" style="background-image: url('./src/assets/9b6dc444b0feeb650edd472c766d9b00af5ddbb8.svg'); background-size: cover; background-position: center;"></div>
        
        <!-- Blurred background content -->
        <div class="absolute inset-0 z-0" style="filter: blur(2px);">
            <!-- Status bar -->
            <div class="absolute top-0 left-1/2 transform -translate-x-1/2 w-[393px] z-10">
                <div class="h-11 relative w-full">
                    <div class="absolute h-[22px] left-[26px] top-[15px] w-[54px]">
                        <div class="absolute font-semibold text-white text-[17px] text-center top-1/2 transform -translate-y-1/2 left-0 right-0" style="font-family: 'SF Pro Text', sans-serif;">
                            <p class="leading-[22px]">12:15</p>
                        </div>
                    </div>
                    <div class="absolute right-[26.339px] top-[19.333px] w-[27.328px] h-[13px]">
                        <img alt="Battery" class="block max-w-none w-full h-full" src="./src/assets/c0c091687c62d7337bf318e17f3769ffc34d3a72.svg" />
                    </div>
                    <div class="absolute right-[61px] top-5 w-[17px] h-3">
                        <img alt="Wifi" class="block max-w-none w-full h-full" src="./src/assets/94bdfe1a8077b65bf75e0473782ae3df50cd473f.svg" />
                    </div>
                    <div class="absolute right-[85.4px] top-5 w-[19.2px] h-3">
                        <img alt="Cellular" class="block max-w-none w-full h-full" src="./src/assets/a883d1003c9c8d00c12b4d64e84ed02fcbbf9603.svg" />
                    </div>
                </div>
            </div>

            <!-- Background Museum Image with exact Figma specifications -->
            <div class="absolute w-[393px] h-[852px] top-0 left-0 opacity-70" style="background-image: url('./src/assets/cc8c0a6205dd7253e86ab080322dec689122ecb2.png'); background-size: 121.99% 100%; background-position: 47.69% 0%; background-repeat: no-repeat;"></div>

            <!-- Picture Frames -->
            <div class="absolute left-14 top-[158px] flex flex-row gap-[23px] items-center">
                <div class="bg-center bg-cover bg-no-repeat w-[281px] h-[421px]" style="background-image: url('./src/assets/dff6fe23fdbc66a95b73bccee1330324b70d1957.png'); box-shadow: 82px 201px 61px 0px rgba(0,0,0,0.01), 53px 128px 56px 0px rgba(0,0,0,0.06), 30px 72px 47px 0px rgba(0,0,0,0.2), 13px 32px 35px 0px rgba(0,0,0,0.34), 3px 8px 19px 0px rgba(0,0,0,0.39);"></div>
                <div class="bg-center bg-cover bg-no-repeat w-[33px] h-[339px] opacity-70" style="background-image: url('./src/assets/e956d03147a1ec74c8563980180fa452db51f275.png'); background-size: 949.05% 130.58%; background-position: 12.08% 51.25%; box-shadow: 82px 201px 61px 0px rgba(0,0,0,0.01), 53px 128px 56px 0px rgba(0,0,0,0.06), 30px 72px 47px 0px rgba(0,0,0,0.2), 13px 32px 35px 0px rgba(0,0,0,0.34), 3px 8px 19px 0px rgba(0,0,0,0.39);"></div>
            </div>

            <!-- Settings Icon -->
            <div class="absolute left-[341px] top-[58px] w-[26px] h-[26px]">
                <img alt="Settings" class="block max-w-none w-full h-full" src="./src/assets/93a02d26a502971a89c3344708fc357ec3d89403.svg" />
            </div>

            <!-- Home Indicator -->
            <div class="absolute bottom-0 left-0 w-full h-[34px] flex items-center justify-center">
                <div class="w-[134px] h-[5px] bg-[#919191] rounded-[2.5px]"></div>
            </div>
        </div>

        <!-- Upload Options Modal - Following exact Figma specifications -->
        <div class="absolute left-5 top-[642px] w-[353px] z-50">
            <!-- Main Options Container (Choose from Album + Camera) -->
            <div class="bg-[rgba(179,179,179,0.82)] backdrop-blur-[25px] rounded-[14px] overflow-hidden h-28">
                <!-- Choose from Album Button -->
                <button class="w-full h-14 flex items-center justify-center border-b border-gray-400 border-opacity-30 text-[#007aff] text-[17px] cursor-pointer hover:bg-gray-200 hover:bg-opacity-20 transition-colors" style="font-family: 'SF Pro', sans-serif; font-weight: 590; line-height: 22px; letter-spacing: -0.43px;" onclick="handleChooseFromAlbum()">
                    Choose from Album
                </button>
                
                <!-- Camera Button -->
                <button class="w-full h-14 flex items-center justify-center text-[#007aff] text-[17px] cursor-pointer hover:bg-gray-200 hover:bg-opacity-20 transition-colors" style="font-family: 'SF Pro', sans-serif; font-weight: 590; line-height: 22px; letter-spacing: -0.43px;" onclick="handleCamera()">
                    Camera
                </button>
            </div>
            
            <!-- Cancel Button (Separate container with exact Figma spacing) -->
            <div class="mt-2">
                <button class="w-full h-14 bg-[rgba(153,153,153,0.97)] backdrop-blur-[25px] rounded-[14px] text-[#007aff] text-[17px] cursor-pointer hover:bg-gray-300 hover:bg-opacity-97 transition-colors flex items-center justify-center" style="font-family: 'SF Pro', sans-serif; font-weight: 590; line-height: 22px; letter-spacing: -0.43px;" onclick="handleCancelUpload()">
                    Cancel
                </button>
            </div>
        </div>
    </div>

    <!-- Eighth Page - Camera - Position artwork in frame -->
    <div id="page8" class="mobile-container absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 z-50 hidden" style="width: 393px; height: 852px;">
        <!-- Background - Solid color initially, camera feed will be inserted here -->
        <div class="absolute inset-0 bg-[#1a1a1a]">
            <!-- Camera feed will be dynamically inserted here -->
        </div>
        
        <!-- Status bar -->
        <div class="absolute top-0 left-1/2 transform -translate-x-1/2 w-[393px] z-10">
            <div class="h-11 relative w-full">
                <div class="absolute h-[22px] left-[26px] top-[15px] w-[54px]">
                    <div class="absolute font-semibold text-white text-[17px] text-center top-1/2 transform -translate-y-1/2 left-0 right-0" style="font-family: 'SF Pro Text', sans-serif;">
                        <p class="leading-[22px]">12:15</p>
                    </div>
                </div>
                <div class="absolute right-[26.339px] top-[19.333px] w-[27.328px] h-[13px]">
                    <img alt="Battery" class="block max-w-none w-full h-full" src="./src/assets/c0c091687c62d7337bf318e17f3769ffc34d3a72.svg" />
                </div>
                <div class="absolute right-[61px] top-5 w-[17px] h-3">
                    <img alt="Wifi" class="block max-w-none w-full h-full" src="./src/assets/94bdfe1a8077b65bf75e0473782ae3df50cd473f.svg" />
                </div>
                <div class="absolute right-[85.4px] top-5 w-[19.2px] h-3">
                    <img alt="Cellular" class="block max-w-none w-full h-full" src="./src/assets/a883d1003c9c8d00c12b4d64e84ed02fcbbf9603.svg" />
                </div>
            </div>
        </div>

        <!-- Back Button -->
        <div id="cameraBackButton" class="absolute left-5 top-[53px] w-[42px] h-[42px] cursor-pointer z-20" onclick="handleBackFromCamera()">
            <img alt="Back" class="block max-w-none w-full h-full" src="./src/assets/40807933db102c5ddfe145202e96cb747d9662c5.svg" />
        </div>

        <!-- Camera Switch Button (Front/Back) - REMOVED per user request -->

        <!-- Frame Overlay with exact Figma positioning -->
        <div class="absolute left-[47px] top-[217px] w-[299px] h-[336px] z-30 pointer-events-none">
            <div class="absolute bottom-[-0.744%] left-[-0.836%] right-[-0.836%] top-[-0.744%]">
                <img alt="Frame" class="block max-w-none w-full h-full" src="./src/assets/a50b78e69bd84e986612b63ceaef3914b979e32f.svg" />
            </div>
            <!-- Fallback border if image fails to load -->
            <div class="absolute inset-0 border-4 border-white rounded-lg opacity-20" style="border-color: rgba(255,255,255,0.3);"></div>
        </div>

        <!-- Position artwork in frame text with exact Figma specifications -->
        <div class="absolute left-1/2 transform -translate-x-1/2 translate-y-[-50%] w-[163px] h-8 z-20" style="top: calc(50% + 200px);">
            <div class="bg-[rgba(0,0,0,0.5)] rounded-[20px] px-[19px] py-[3px] flex items-center justify-center h-full">
                <p class="text-white text-[16px] opacity-90 text-center" style="font-family: 'Avenir LT Std', sans-serif; font-weight: 500; line-height: 1.6; width: 125px;">Position in frame</p>
            </div>
        </div>

        <!-- Initializing camera text (shown during initialization) -->
        <div id="initializingText" class="absolute left-1/2 top-[426px] transform -translate-x-1/2 z-40 hidden">
            <div class="bg-black bg-opacity-50 rounded-[20px] px-7 py-[5px]">
                <p class="text-white text-[16px] font-medium opacity-90 text-center whitespace-nowrap" style="font-family: 'Avenir LT Std', sans-serif; line-height: 1.6;">Initializing camera...</p>
            </div>
        </div>

        <!-- Camera Capture Button (White Dot) -->
        <div id="captureButton" class="absolute left-[164px] top-[715px] w-[66px] h-[66px] cursor-pointer z-20" onclick="handleCameraCapture()">
            <div class="absolute bottom-[-37.879%] left-[-10.606%] right-[-10.606%] top-[-1.515%]">
                <img alt="Capture" class="block max-w-none w-full h-full" src="./src/assets/3a56d57eec3f941a5df78a985a87aa7235c2181a.svg" />
            </div>
        </div>

        <!-- Gallery Button with exact Figma specifications and album functionality -->
        <div class="absolute left-[290px] top-[727px] w-[42px] h-[42px] bg-[rgba(0,0,0,0.3)] backdrop-blur-[0.778px] rounded-[7.778px] z-20 cursor-pointer transition-all duration-200 hover:bg-opacity-40 active:scale-95" onclick="handleChooseFromAlbum()">
            <div class="absolute left-[18.518%] top-[20.374%] right-[18.519%] bottom-[20.374%]">
                <img alt="Gallery" class="block max-w-none w-full h-full" src="./src/assets/01e1d6ae9f47430674fe0f46b61392a43f9c8519.svg" />
            </div>
        </div>

        <!-- Home Indicator with exact Figma specifications -->
        <div class="absolute left-0 top-[826px] w-[393px] flex items-center justify-center">
            <div class="h-[26px] w-[375px] relative flex items-center justify-center">
                <div class="absolute bottom-2 flex h-[5px] items-center justify-center left-1/2 transform -translate-x-1/2 w-36">
                    <div class="bg-black h-[5px] rounded-[100px] w-36"></div>
                </div>
            </div>
        </div>
    </div>

    <!-- Ninth Page - Taking picture with animation -->
    <div id="page9" class="mobile-container absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 z-50 hidden" style="width: 393px; height: 852px;">
        <!-- Flash Effect Background -->
        <div id="flashEffect" class="absolute inset-0 bg-white opacity-0 z-30 transition-opacity duration-150"></div>
        
        <!-- Background with blur effect -->
        <div class="absolute inset-0 bg-[#221400]">
            <!-- Full Screen Camera Image (Blurred) -->
            <div class="absolute w-[710px] h-[852px] top-0 left-1/2 transform -translate-x-1/2" style="background-image: url('./src/assets/7a0726d52319e67424c6d0a3e78491d8db70935a.png'); background-size: cover; background-position: center;"></div>
            
            <!-- Camera Overlay (Normal Camera View) -->
            <div class="absolute inset-0 bg-[#221400] overflow-hidden">
                <!-- Camera Background Image -->
                <div class="absolute w-[1251px] h-[852px] top-0 left-[-340px]" style="background-image: url('./src/assets/4cfe7919ebce84e71fd1ea6e26cf431e62f5d972.png'); background-size: cover; background-position: center;"></div>
                
                <!-- Status bar -->
                <div class="absolute top-0 left-1/2 transform -translate-x-1/2 w-[393px] z-10">
                    <div class="h-11 relative w-full">
                        <div class="absolute h-[22px] left-[26px] top-[15px] w-[54px]">
                            <div class="absolute font-semibold text-white text-[17px] text-center top-1/2 transform -translate-y-1/2 left-0 right-0" style="font-family: 'SF Pro Text', sans-serif;">
                                <p class="leading-[22px]">12:15</p>
                            </div>
                        </div>
                        <div class="absolute right-[26.339px] top-[19.333px] w-[27.328px] h-[13px]">
                            <img alt="Battery" class="block max-w-none w-full h-full" src="./src/assets/c0c091687c62d7337bf318e17f3769ffc34d3a72.svg" />
                        </div>
                        <div class="absolute right-[61px] top-5 w-[17px] h-3">
                            <img alt="Wifi" class="block max-w-none w-full h-full" src="./src/assets/94bdfe1a8077b65bf75e0473782ae3df50cd473f.svg" />
                        </div>
                        <div class="absolute right-[85.4px] top-5 w-[19.2px] h-3">
                            <img alt="Cellular" class="block max-w-none w-full h-full" src="./src/assets/a883d1003c9c8d00c12b4d64e84ed02fcbbf9603.svg" />
                        </div>
                    </div>
                </div>

                <!-- Back Button -->
                <div class="absolute left-5 top-[53px] w-[42px] h-[42px] cursor-pointer z-20">
                    <img alt="Back" class="block max-w-none w-full h-full" src="./src/assets/40807933db102c5ddfe145202e96cb747d9662c5.svg" />
                </div>

                <!-- Frame Overlay -->
                <div class="absolute left-[47px] top-[217px] w-[299px] h-[336px] z-30 pointer-events-none">
                    <img alt="Frame" class="block max-w-none w-full h-full" src="./src/assets/7f7f4e9c0ff1336f239a058ecfbcb93598e33f94.svg" />
                    <!-- Fallback border if image fails to load -->
                    <div class="absolute inset-0 border-4 border-white rounded-lg opacity-20" style="border-color: rgba(255,255,255,0.3);"></div>
                </div>

                <!-- Camera Capture Button (Disabled State) -->
                <div class="absolute left-[164px] top-[715px] w-[66px] h-[66px] z-20">
                    <div class="absolute bottom-[-37.879%] left-[-10.606%] right-[-10.606%] top-[-1.515%]">
                        <img alt="Capture Disabled" class="block max-w-none w-full h-full" src="./src/assets/5b05d68c3eb2bca3a02f5a3824a8ff08166d4c40.svg" />
                    </div>
                </div>

                <!-- Gallery Button -->
                <div class="absolute left-[290px] top-[727px] w-[42px] h-[42px] bg-black bg-opacity-30 backdrop-blur-sm rounded-[7.778px] z-20">
                    <div class="absolute left-[18.518%] top-[20.374%] right-[18.519%] bottom-[20.374%]">
                        <img alt="Gallery" class="block max-w-none w-full h-full" src="./src/assets/01e1d6ae9f47430674fe0f46b61392a43f9c8519.svg" />
                    </div>
                </div>

                <!-- Home Indicator -->
                <div class="absolute bottom-0 left-0 w-full h-[26px] flex items-center justify-center">
                    <div class="w-[134px] h-[5px] bg-black rounded-[100px]"></div>
                </div>
            </div>
        </div>

        <!-- Loading Spinner -->
        <div id="loadingSpinner" class="absolute left-[140px] top-[291px] w-[114px] h-[116px] z-40">
            <!-- Animated Spinner Component -->
            <div class="relative w-full h-full">
                <!-- Center bar -->
                <div class="absolute left-[45.595%] top-0 right-[45.595%] bottom-[69.163%] bg-[rgba(173,173,173,0.4)] rounded-[20px]"></div>
                <!-- Top-left diagonal -->
                <div class="absolute left-[11.529%] top-[11.53%] right-[60.435%] bottom-[60.435%] flex items-center justify-center">
                    <div class="w-5 h-[70px] bg-[rgba(173,173,173,0.2)] rounded-[20px] rotate-[315deg]"></div>
                </div>
                <!-- Top-right diagonal -->
                <div class="absolute left-[60.435%] top-[11.529%] right-[11.53%] bottom-[60.435%] flex items-center justify-center">
                    <div class="w-5 h-[70px] bg-[rgba(173,173,173,0.6)] rounded-[20px] rotate-[45deg]"></div>
                </div>
                <!-- Right bar -->
                <div class="absolute left-[69.163%] top-[45.595%] right-0 bottom-[45.595%] flex items-center justify-center">
                    <div class="w-5 h-[70px] bg-[rgba(173,173,173,0.8)] rounded-[20px] rotate-[90deg]"></div>
                </div>
                <!-- Bottom bar -->
                <div class="absolute left-[45.595%] top-[69.163%] right-[45.595%] bottom-0 bg-[#adadad] rounded-[20px]"></div>
                <!-- Bottom-right diagonal -->
                <div class="absolute left-[60.435%] top-[60.435%] right-[11.529%] bottom-[11.53%] flex items-center justify-center">
                    <div class="w-5 h-[70px] bg-[#adadad] rounded-[20px] rotate-[315deg]"></div>
                </div>
                <!-- Bottom-left diagonal -->
                <div class="absolute left-[11.53%] top-[60.435%] right-[60.435%] bottom-[11.529%] flex items-center justify-center">
                    <div class="w-5 h-[70px] bg-[rgba(173,173,173,0)] rounded-[20px] rotate-[45deg]"></div>
                </div>
                <!-- Left bar -->
                <div class="absolute left-0 top-[45.595%] right-[69.163%] bottom-[45.595%] flex items-center justify-center">
                    <div class="w-5 h-[70px] bg-[rgba(173,173,173,0.1)] rounded-[20px] rotate-[90deg]"></div>
                </div>
            </div>
        </div>

        <!-- Taking picture text -->
        <div class="absolute left-1/2 top-[426px] transform -translate-x-1/2 z-40">
            <div class="bg-black bg-opacity-50 rounded-[20px] px-7 py-[5px]">
                <p class="text-white text-[16px] font-medium opacity-90 text-center whitespace-nowrap" style="font-family: 'Avenir LT Std', sans-serif; line-height: 1.6;">Taking picture...</p>
            </div>
        </div>
    </div>

    <!-- Tenth Page - Analyzing picture -->
    <div id="page10" class="mobile-container absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 z-50 hidden" style="width: 393px; height: 852px;">
        <!-- Background -->
        <div class="absolute inset-0 bg-[#221400] overflow-hidden">
            <!-- Camera Background Image -->
            <div class="absolute w-[393px] h-[852px] top-0 left-0" style="background-image: url('./src/assets/4cfe7919ebce84e71fd1ea6e26cf431e62f5d972.png'); background-size: 318.51% 100%; background-position: 39.33% 0%; background-repeat: no-repeat;"></div>
        </div>
        
        <!-- Status bar -->
        <div class="absolute top-0 left-1/2 transform -translate-x-1/2 w-[393px] z-10">
            <div class="h-11 relative w-full">
                <div class="absolute h-[22px] left-[26px] top-[15px] w-[54px]">
                    <div class="absolute font-semibold text-white text-[17px] text-center top-1/2 transform -translate-y-1/2 left-0 right-0" style="font-family: 'SF Pro Text', sans-serif;">
                        <p class="leading-[22px]">12:15</p>
                    </div>
                </div>
                <div class="absolute right-[26.339px] top-[19.333px] w-[27.328px] h-[13px]">
                    <img alt="Battery" class="block max-w-none w-full h-full" src="./src/assets/c0c091687c62d7337bf318e17f3769ffc34d3a72.svg" />
                </div>
                <div class="absolute right-[61px] top-5 w-[17px] h-3">
                    <img alt="Wifi" class="block max-w-none w-full h-full" src="./src/assets/94bdfe1a8077b65bf75e0473782ae3df50cd473f.svg" />
                </div>
                <div class="absolute right-[85.4px] top-5 w-[19.2px] h-3">
                    <img alt="Cellular" class="block max-w-none w-full h-full" src="./src/assets/a883d1003c9c8d00c12b4d64e84ed02fcbbf9603.svg" />
                </div>
            </div>
        </div>

        <!-- Back Button -->
        <div class="absolute left-5 top-[53px] w-[42px] h-[42px] cursor-pointer z-20">
            <img alt="Back" class="block max-w-none w-full h-full" src="./src/assets/40807933db102c5ddfe145202e96cb747d9662c5.svg" />
        </div>

        <!-- Frame Overlay -->
        <div class="absolute left-[47px] top-[217px] w-[299px] h-[336px] z-30 pointer-events-none">
            <img alt="Frame" class="block max-w-none w-full h-full" src="./src/assets/7f7f4e9c0ff1336f239a058ecfbcb93598e33f94.svg" />
            <!-- Fallback border if image fails to load -->
            <div class="absolute inset-0 border-4 border-white rounded-lg opacity-20" style="border-color: rgba(255,255,255,0.3);"></div>
        </div>

        <!-- Camera Capture Button (Analyzed State) -->
        <div class="absolute left-[164px] top-[715px] w-[66px] h-[66px] z-20">
            <div class="absolute bottom-[-37.879%] left-[-10.606%] right-[-10.606%] top-[-1.515%]">
                <img alt="Analyzed" class="block max-w-none w-full h-full" src="./src/assets/2314863aa5b98c3561bbba15a029ce5d6b01faa6.svg" />
            </div>
        </div>

        <!-- Gallery Button -->
        <div class="absolute left-[290px] top-[727px] w-[42px] h-[42px] bg-black bg-opacity-30 backdrop-blur-sm rounded-[7.778px] z-20">
            <div class="absolute left-[18.518%] top-[20.374%] right-[18.519%] bottom-[20.374%]">
                <img alt="Gallery" class="block max-w-none w-full h-full" src="./src/assets/01e1d6ae9f47430674fe0f46b61392a43f9c8519.svg" />
            </div>
        </div>

        <!-- Loading Spinner (for analyzing) -->
        <div id="analyzingSpinner" class="absolute left-[140px] top-[291px] w-[114px] h-[116px] z-40">
            <!-- Animated Spinner Component -->
            <div class="relative w-full h-full">
                <!-- Center bar -->
                <div class="absolute left-[45.595%] top-0 right-[45.595%] bottom-[69.163%] bg-[rgba(173,173,173,0.4)] rounded-[20px]"></div>
                <!-- Top-left diagonal -->
                <div class="absolute left-[11.529%] top-[11.53%] right-[60.435%] bottom-[60.435%] flex items-center justify-center">
                    <div class="w-5 h-[70px] bg-[rgba(173,173,173,0.2)] rounded-[20px] rotate-[315deg]"></div>
                </div>
                <!-- Top-right diagonal -->
                <div class="absolute left-[60.435%] top-[11.529%] right-[11.53%] bottom-[60.435%] flex items-center justify-center">
                    <div class="w-5 h-[70px] bg-[rgba(173,173,173,0.6)] rounded-[20px] rotate-[45deg]"></div>
                </div>
                <!-- Right bar -->
                <div class="absolute left-[69.163%] top-[45.595%] right-0 bottom-[45.595%] flex items-center justify-center">
                    <div class="w-5 h-[70px] bg-[rgba(173,173,173,0.8)] rounded-[20px] rotate-[90deg]"></div>
                </div>
                <!-- Bottom bar -->
                <div class="absolute left-[45.595%] top-[69.163%] right-[45.595%] bottom-0 bg-[#adadad] rounded-[20px]"></div>
                <!-- Bottom-right diagonal -->
                <div class="absolute left-[60.435%] top-[60.435%] right-[11.529%] bottom-[11.53%] flex items-center justify-center">
                    <div class="w-5 h-[70px] bg-[#adadad] rounded-[20px] rotate-[315deg]"></div>
                </div>
                <!-- Bottom-left diagonal -->
                <div class="absolute left-[11.53%] top-[60.435%] right-[60.435%] bottom-[11.529%] flex items-center justify-center">
                    <div class="w-5 h-[70px] bg-[rgba(173,173,173,0)] rounded-[20px] rotate-[45deg]"></div>
                </div>
                <!-- Left bar -->
                <div class="absolute left-0 top-[45.595%] right-[69.163%] bottom-[45.595%] flex items-center justify-center">
                    <div class="w-5 h-[70px] bg-[rgba(173,173,173,0.1)] rounded-[20px] rotate-[90deg]"></div>
                </div>
            </div>
        </div>

        <!-- Analyzing picture text -->
        <div class="absolute left-1/2 top-[426px] transform -translate-x-1/2 z-40">
            <div class="bg-black bg-opacity-50 rounded-[20px] px-7 py-[5px]">
                <p class="text-white text-[16px] font-medium opacity-90 text-center whitespace-nowrap" style="font-family: 'Avenir LT Std', sans-serif; line-height: 1.6;">Analyzing picture...</p>
            </div>
        </div>

        <!-- Home Indicator -->
        <div class="absolute bottom-0 left-0 w-full h-[26px] flex items-center justify-center">
            <div class="w-[134px] h-[5px] bg-black rounded-[100px]"></div>
        </div>
    </div>

    <!-- Eleventh Page - Preparing the Gallery -->
    <div id="page11" class="mobile-container absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 z-50 hidden" style="width: 393px; height: 852px;">
        <!-- Background with museum pattern -->
        <div class="absolute inset-0" style="background-image: url('./src/assets/d8253cac2e39f67fcc735a3c279bbb3caac59cc5.png'); background-size: cover; background-position: center; background-repeat: no-repeat;"></div>
        
        <!-- Status bar -->
        <div class="absolute top-0 left-1/2 transform -translate-x-1/2 w-[393px] z-10">
            <div class="h-11 relative w-full">
                <div class="absolute h-[22px] left-[26px] top-[15px] w-[54px]">
                    <div class="absolute font-semibold text-white text-[17px] text-center top-1/2 transform -translate-y-1/2 left-0 right-0" style="font-family: 'SF Pro Text', sans-serif;">
                        <p class="leading-[22px]">12:15</p>
                    </div>
                </div>
                <div class="absolute right-[26.339px] top-[19.333px] w-[27.328px] h-[13px]">
                    <img alt="Battery" class="block max-w-none w-full h-full" src="./src/assets/c0c091687c62d7337bf318e17f3769ffc34d3a72.svg" />
                </div>
                <div class="absolute right-[61px] top-5 w-[17px] h-3">
                    <img alt="Wifi" class="block max-w-none w-full h-full" src="./src/assets/94bdfe1a8077b65bf75e0473782ae3df50cd473f.svg" />
                </div>
                <div class="absolute right-[85.4px] top-5 w-[19.2px] h-3">
                    <img alt="Cellular" class="block max-w-none w-full h-full" src="./src/assets/a883d1003c9c8d00c12b4d64e84ed02fcbbf9603.svg" />
                </div>
            </div>
        </div>

        <!-- Back Button -->
        <div class="absolute left-5 top-[53px] w-[42px] h-[42px] cursor-pointer z-20">
            <img alt="Back" class="block max-w-none w-full h-full" src="./src/assets/40807933db102c5ddfe145202e96cb747d9662c5.svg" />
        </div>

        <!-- Center Content -->
        <div class="absolute left-1/2 top-1/2 transform -translate-x-1/2 -translate-y-1/2 flex flex-col items-center gap-7 z-30">
            <!-- Large Loading Spinner -->
            <div id="gallerySpinner" class="w-[141px] h-[143px]">
                <!-- Animated Spinner Component (Larger) -->
                <div class="relative w-full h-full">
                    <!-- Center bar -->
                    <div class="absolute left-[45.595%] top-0 right-[45.595%] bottom-[69.163%] bg-[rgba(173,173,173,0.4)] rounded-[20px]"></div>
                    <!-- Top-left diagonal -->
                    <div class="absolute left-[11.529%] top-[11.53%] right-[60.435%] bottom-[60.435%] flex items-center justify-center">
                        <div class="w-5 h-[70px] bg-[rgba(173,173,173,0.2)] rounded-[20px] rotate-[315deg]"></div>
                    </div>
                    <!-- Top-right diagonal -->
                    <div class="absolute left-[60.435%] top-[11.529%] right-[11.53%] bottom-[60.435%] flex items-center justify-center">
                        <div class="w-5 h-[70px] bg-[rgba(173,173,173,0.6)] rounded-[20px] rotate-[45deg]"></div>
                    </div>
                    <!-- Right bar -->
                    <div class="absolute left-[69.163%] top-[45.595%] right-0 bottom-[45.595%] flex items-center justify-center">
                        <div class="w-5 h-[70px] bg-[rgba(173,173,173,0.8)] rounded-[20px] rotate-[90deg]"></div>
                    </div>
                    <!-- Bottom bar -->
                    <div class="absolute left-[45.595%] top-[69.163%] right-[45.595%] bottom-0 bg-[#adadad] rounded-[20px]"></div>
                    <!-- Bottom-right diagonal -->
                    <div class="absolute left-[60.435%] top-[60.435%] right-[11.529%] bottom-[11.53%] flex items-center justify-center">
                        <div class="w-5 h-[70px] bg-[#adadad] rounded-[20px] rotate-[315deg]"></div>
                    </div>
                    <!-- Bottom-left diagonal -->
                    <div class="absolute left-[11.53%] top-[60.435%] right-[60.435%] bottom-[11.529%] flex items-center justify-center">
                        <div class="w-5 h-[70px] bg-[rgba(173,173,173,0)] rounded-[20px] rotate-[45deg]"></div>
                    </div>
                    <!-- Left bar -->
                    <div class="absolute left-0 top-[45.595%] right-[69.163%] bottom-[45.595%] flex items-center justify-center">
                        <div class="w-5 h-[70px] bg-[rgba(173,173,173,0.1)] rounded-[20px] rotate-[90deg]"></div>
                    </div>
                </div>
            </div>

            <!-- Preparing text -->
            <div>
                <p class="text-white text-[16px] font-medium opacity-90 text-center whitespace-nowrap" style="font-family: 'Avenir LT Std', sans-serif; line-height: 1.6;">Preparing the Gallery...</p>
            </div>
        </div>
    </div>

    <!-- Thirteenth Page - Live Broadcast Room -->
    <div id="page13" class="mobile-container absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 z-50 hidden" style="width: 393px; height: 852px;">
        <!-- Background with museum artwork -->
        <div class="absolute inset-0 bg-center bg-cover bg-no-repeat" style="background-image: url('./src/assets/2339a82e4b6020c219c18a48dca73ef3ba006ffe.png');"></div>
        
        <!-- Status bar V2 -->
        <div class="absolute box-border content-stretch flex flex-col items-start justify-start left-1/2 p-0 top-0 translate-x-[-50%] w-[393px] z-30" data-name="Status bar V2" style="background: rgba(0,0,0,0.1); backdrop-filter: blur(1px);">
            <div class="h-11 relative w-full" data-name="Status Bar">
                <div class="absolute h-[22px] left-[26px] top-[15px] w-[54px]" data-name="Time">
                    <div class="absolute font-semibold leading-[0] left-0 not-italic right-0 text-[#ffffff] text-[17px] text-center" style="top: calc(50% - 11px); font-family: 'SF Pro Text', sans-serif; text-shadow: 1px 1px 2px rgba(0,0,0,0.5);">
                        <p class="block leading-[22px]">12:15</p>
                    </div>
                </div>
                <div class="absolute h-[13px] right-[26.339px] top-[19.333px] w-[27.328px]" data-name="Battery">
                    <img alt="Battery" class="block max-w-none w-full h-full" src="./src/assets/c0c091687c62d7337bf318e17f3769ffc34d3a72.svg" style="filter: drop-shadow(1px 1px 2px rgba(0,0,0,0.5));" />
                </div>
                <div class="absolute h-3 right-[61px] top-5 w-[17px]" data-name="Wifi">
                    <img alt="Wifi" class="block max-w-none w-full h-full" src="./src/assets/94bdfe1a8077b65bf75e0473782ae3df50cd473f.svg" style="filter: drop-shadow(1px 1px 2px rgba(0,0,0,0.5));" />
                </div>
                <div class="absolute h-3 right-[85.4px] top-5 w-[19.2px]" data-name="Cellular Connection">
                    <div class="absolute bottom-0 left-0 right-[-0.001%] top-0">
                        <img alt="Cellular" class="block max-w-none w-full h-full" src="./src/assets/a883d1003c9c8d00c12b4d64e84ed02fcbbf9603.svg" style="filter: drop-shadow(1px 1px 2px rgba(0,0,0,0.5));" />
                    </div>
                </div>
            </div>
        </div>

        <!-- Back Button (返回 2) -->
        <div id="liveRoomBackButton" class="absolute backdrop-blur-[1px] backdrop-filter bg-[rgba(0,0,0,0.3)] left-[26px] overflow-clip rounded-[10px] size-[42px] top-[52px] cursor-pointer z-30" data-name="back icon" style="box-shadow: 0 2px 8px rgba(0,0,0,0.3);">
            <div class="absolute h-[17px] left-2.5 top-[12.5px] w-[22px]" data-name="Vector">
                <img alt="Back" class="block max-w-none w-full h-full" src="./src/assets/02a9c17137ed17e4e423e148f47a120c213111eb.svg" style="filter: brightness(0) invert(1);" />
            </div>
        </div>

        <!-- Top Right Icons (Settings and More) -->
        <div class="absolute h-6 left-[303px] top-[58px] w-16 z-30" data-name="Component 28" style="filter: drop-shadow(1px 1px 2px rgba(0,0,0,0.5));">
            <div class="absolute aspect-[200/200] left-0 overflow-clip right-[62.5%] top-0" data-name="setting icon">
                <div class="absolute bottom-[5.313%] left-[2.813%] right-[2.713%] top-[5.312%]" data-name="Vector">
                    <img alt="Settings" class="block max-w-none w-full h-full" src="./src/assets/897f897fc1bc39bd5029b1c130459a892fd38f31.svg" style="filter: brightness(0) invert(1);" />
                </div>
            </div>
            <div class="absolute bottom-[8.333%] left-[68.75%] right-0 top-[8.333%]" data-name="Vector">
                <div class="absolute bottom-[-1.568%] left-[-1.568%] right-[-1.568%] top-[-1.568%]">
                    <img alt="More" class="block max-w-none w-full h-full" src="./src/assets/5477b83fa49bc1086b66f6e98ea33e17d7a7dcde.svg" style="filter: brightness(0) invert(1);" />
                </div>
            </div>
        </div>

        <!-- Enhanced Chat Messages Area (Left side, improved auto-scrolling barrage) -->
        <div id="chatContainer" class="absolute left-5 top-[551px] w-[282px] h-[164px] overflow-hidden z-30 barrage-scroll-container">
            <div id="chatMessages" class="flex flex-col gap-2 pb-4 barrage-scroll-content smooth-message-flow">
                <!-- Initial chat messages - duplicated for seamless scrolling -->
                <div class="chat-message backdrop-blur-[1px] backdrop-filter bg-[rgba(0,0,0,0.3)] flex flex-row gap-2 items-center p-[7px] rounded-2xl cursor-pointer" onclick="showIntro()">
                    <img alt="User" class="w-7 h-7 rounded-full" src="./src/assets/d4d2ca48cd435cf039ebac7d781a1bb460198b85.png" />
                    <div class="text-white text-[13px] leading-[16px]" style="font-family: 'Avenir LT Std', sans-serif;">
                        Who else thinks this belonged to a rich kid showing off at court?
                    </div>
                </div>
                <div class="chat-message backdrop-blur-[1px] backdrop-filter bg-[rgba(0,0,0,0.3)] flex flex-row gap-2 items-center p-[7px] rounded-2xl cursor-pointer" onclick="showIntro()">
                    <img alt="User" class="w-7 h-7 rounded-full" src="./src/assets/d4d2ca48cd435cf039ebac7d781a1bb460198b85.png" />
                    <div class="text-white text-[13px] leading-[16px]" style="font-family: 'Avenir LT Std', sans-serif;">
                        Hold on, I just found a 17th-century receipt about this thing!
                    </div>
                </div>
                <div class="chat-message backdrop-blur-[1px] backdrop-filter bg-[rgba(0,0,0,0.3)] flex flex-row gap-2 items-center p-[7px] rounded-[43px] cursor-pointer" onclick="showIntro()">
                    <img alt="User" class="w-7 h-7 rounded-full" src="./src/assets/e3ade9aa46c847d649f3684414fe999679b41c1d.png" />
                    <div class="text-white text-[13px] leading-[22px] whitespace-nowrap cursor-pointer character-message" style="font-family: 'Avenir LT Std', sans-serif;" data-character="van-gogh">
                        Qianlong: I shall stamp it!
                    </div>
                </div>
                <div class="chat-message backdrop-blur-[1px] backdrop-filter bg-[rgba(0,0,0,0.3)] flex flex-row gap-2 items-center p-[7px] rounded-[43px] cursor-pointer" onclick="showIntro()">
                    <img alt="User" class="w-7 h-7 rounded-full" src="./src/assets/d4d2ca48cd435cf039ebac7d781a1bb460198b85.png" />
                    <div class="text-white text-[13px] leading-[22px] whitespace-nowrap" style="font-family: 'Avenir LT Std', sans-serif;">
                        Unpacking centuries of opinions.
                    </div>
                </div>
                <div class="chat-message backdrop-blur-[1px] backdrop-filter bg-[rgba(0,0,0,0.3)] flex flex-row gap-2 items-center p-[7px] rounded-2xl cursor-pointer" onclick="showIntro()">
                    <img alt="User" class="w-7 h-7 rounded-full" src="./src/assets/d4d2ca48cd435cf039ebac7d781a1bb460198b85.png" />
                    <div class="text-white text-[13px] leading-[16px]" style="font-family: 'Avenir LT Std', sans-serif;">
                        This cat is probably judging all our historical debates 😸
                    </div>
                </div>
                <div class="chat-message backdrop-blur-[1px] backdrop-filter bg-[rgba(0,0,0,0.3)] flex flex-row gap-2 items-center p-[7px] rounded-2xl cursor-pointer" onclick="showIntro()">
                    <img alt="User" class="w-7 h-7 rounded-full" src="./src/assets/e3ade9aa46c847d649f3684414fe999679b41c1d.png" />
                    <div class="text-white text-[13px] leading-[16px]" style="font-family: 'Avenir LT Std', sans-serif;">
                        The frame is worth more than my house!
                    </div>
                </div>
                <!-- Additional messages for continuous flow -->
                <div class="chat-message backdrop-blur-[1px] backdrop-filter bg-[rgba(0,0,0,0.3)] flex flex-row gap-2 items-center p-[7px] rounded-2xl cursor-pointer" onclick="showIntro()">
                    <img alt="User" class="w-7 h-7 rounded-full" src="./src/assets/d4d2ca48cd435cf039ebac7d781a1bb460198b85.png" />
                    <div class="text-white text-[13px] leading-[16px]" style="font-family: 'Avenir LT Std', sans-serif;">
                        I wonder what Vincent would think of all this chatter 🎨
                    </div>
                </div>
                <div class="chat-message backdrop-blur-[1px] backdrop-filter bg-[rgba(0,0,0,0.3)] flex flex-row gap-2 items-center p-[7px] rounded-2xl cursor-pointer" onclick="showIntro()">
                    <img alt="User" class="w-7 h-7 rounded-full" src="./src/assets/e3ade9aa46c847d649f3684414fe999679b41c1d.png" />
                    <div class="text-white text-[13px] leading-[16px]" style="font-family: 'Avenir LT Std', sans-serif;">
                        Anyone else getting museum vibes right now? ✨
                    </div>
                </div>
                <!-- Duplicate messages for seamless loop -->
                <div class="chat-message backdrop-blur-[1px] backdrop-filter bg-[rgba(0,0,0,0.3)] flex flex-row gap-2 items-center p-[7px] rounded-2xl cursor-pointer" onclick="showIntro()">
                    <img alt="User" class="w-7 h-7 rounded-full" src="./src/assets/d4d2ca48cd435cf039ebac7d781a1bb460198b85.png" />
                    <div class="text-white text-[13px] leading-[16px]" style="font-family: 'Avenir LT Std', sans-serif;">
                        Who else thinks this belonged to a rich kid showing off at court?
                    </div>
                </div>
                <div class="chat-message backdrop-blur-[1px] backdrop-filter bg-[rgba(0,0,0,0.3)] flex flex-row gap-2 items-center p-[7px] rounded-2xl cursor-pointer" onclick="showIntro()">
                    <img alt="User" class="w-7 h-7 rounded-full" src="./src/assets/d4d2ca48cd435cf039ebac7d781a1bb460198b85.png" />
                    <div class="text-white text-[13px] leading-[16px]" style="font-family: 'Avenir LT Std', sans-serif;">
                        Hold on, I just found a 17th-century receipt about this thing!
                    </div>
                </div>
                <div class="chat-message backdrop-blur-[1px] backdrop-filter bg-[rgba(0,0,0,0.3)] flex flex-row gap-2 items-center p-[7px] rounded-[43px] cursor-pointer" onclick="showIntro()">
                    <img alt="User" class="w-7 h-7 rounded-full" src="./src/assets/e3ade9aa46c847d649f3684414fe999679b41c1d.png" />
                    <div class="text-white text-[13px] leading-[22px] whitespace-nowrap cursor-pointer character-message" style="font-family: 'Avenir LT Std', sans-serif;" data-character="van-gogh">
                        Qianlong: I shall stamp it!
                    </div>
                </div>
            </div>
            
            <!-- Subtle fade effects for smooth message transitions (matching page 18) -->
            <div class="absolute top-0 left-0 right-0 h-[25px] bg-gradient-to-b from-black/30 to-transparent z-10 pointer-events-none"></div>
            <div class="absolute bottom-0 left-0 right-0 h-[25px] bg-gradient-to-t from-black/30 to-transparent z-10 pointer-events-none"></div>
        </div>

        <!-- Floating Emojis Area (Right side) -->
        <div id="emojiContainer" class="absolute left-80 top-[584px] w-[61px] h-[201px] overflow-hidden z-30">
            <!-- Floating emojis will be dynamically added here -->
        </div>

        <!-- Bottom Control Panel -->
        <div class="absolute left-5 bottom-[67px] flex flex-row gap-3 items-center z-40">
            <!-- Hold to Talk Button -->
            <div id="holdToTalkBtn" class="backdrop-blur-[1px] backdrop-filter bg-[rgba(0,0,0,0.3)] flex flex-row gap-4 items-center justify-start px-3 py-2 rounded-[100px] cursor-pointer" onclick="navigateToVoicePage()">
                <div class="w-[22px] h-[22px]">
                    <img alt="Microphone" class="block max-w-none w-full h-full" src="./src/assets/076ad16a88cfddb5f6212dc8a0e121d73f2c0b24.svg" />
                </div>
                <div class="text-[#e5e0dc] text-[13px] leading-[1.5] w-[141px]" style="font-family: 'Avenir LT Std', sans-serif;">
                    Press and hold to speak
                </div>
            </div>

            <!-- Type Message Button -->
            <div id="typeMessageBtn" class="backdrop-blur-[1px] backdrop-filter bg-[rgba(0,0,0,0.3)] flex items-center justify-center p-[8px] rounded-[100px] w-[38px] h-[38px] cursor-pointer" onclick="showMessageInput()">
                <div class="w-[22px] h-[22px]">
                    <img alt="Keyboard" class="block max-w-none w-full h-full" src="./src/assets/f0ca8d23de930dde65471ef8f667466d5bf4c10a.svg" />
                </div>
            </div>

            <!-- Reroll Character Button -->
            <div id="rerollCharacterBtn" class="backdrop-blur-[1px] backdrop-filter bg-[rgba(0,0,0,0.3)] flex items-center justify-center p-[8px] rounded-[100px] w-[38px] h-[38px] cursor-pointer">
                <div class="w-[22px] h-[22px]">
                    <img alt="Reroll" class="block max-w-none w-full h-full" src="./src/assets/15be4f7c5adf58b331f84aeb133ea7c7eb2eef70.svg" />
                </div>
            </div>

            <!-- Like Button -->
            <div id="likeBtn" class="backdrop-blur-[1px] backdrop-filter bg-[rgba(0,0,0,0.3)] flex items-center justify-center p-[8px] rounded-[100px] w-[38px] h-[38px] cursor-pointer">
                <div class="w-[22px] h-[22px]">
                    <img alt="Like" class="block max-w-none w-full h-full" src="./src/assets/a996fbaf85b7c9f17c8f104ff2ba4feb228e993b.svg" />
                </div>
            </div>
        </div>

        <!-- Home Indicator -->
        <div class="absolute bottom-0 left-0 w-full h-[34px] flex items-center justify-center">
            <div class="w-[141px] h-[5px] bg-[#919191] rounded-[2.5px]"></div>
        </div>
    </div>

    <!-- Fourteenth Page - Message Input Page -->
    <div id="page14" class="mobile-container absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 z-50 hidden" style="width: 393px; height: 852px;">
        <!-- Background with museum artwork -->
        <div class="absolute inset-0 bg-center bg-cover bg-no-repeat" style="background-image: url('./src/assets/2339a82e4b6020c219c18a48dca73ef3ba006ffe.png');"></div>
        
        <!-- Status bar V2 -->
        <div class="absolute box-border content-stretch flex flex-col items-start justify-start left-1/2 p-0 top-0 translate-x-[-50%] w-[393px] z-30">
            <div class="h-11 relative w-full">
                <div class="absolute h-[22px] left-[26px] top-[15px] w-[54px]">
                    <div class="absolute font-semibold leading-[0] left-0 not-italic right-0 text-[#ffffff] text-[17px] text-center" style="top: calc(50% - 11px); font-family: 'SF Pro Text', sans-serif;">
                        <p class="block leading-[22px]">12:15</p>
                    </div>
                </div>
                <div class="absolute h-[13px] right-[26.339px] top-[19.333px] w-[27.328px]">
                    <img alt="Battery" class="block max-w-none w-full h-full" src="./src/assets/c0c091687c62d7337bf318e17f3769ffc34d3a72.svg" />
                </div>
                <div class="absolute h-3 right-[61px] top-5 w-[17px]">
                    <img alt="Wifi" class="block max-w-none w-full h-full" src="./src/assets/94bdfe1a8077b65bf75e0473782ae3df50cd473f.svg" />
                </div>
                <div class="absolute h-3 right-[85.4px] top-5 w-[19.2px]">
                    <div class="absolute bottom-0 left-0 right-[-0.001%] top-0">
                        <img alt="Cellular" class="block max-w-none w-full h-full" src="./src/assets/a883d1003c9c8d00c12b4d64e84ed02fcbbf9603.svg" />
                    </div>
                </div>
            </div>
        </div>

        <!-- Back Button -->
        <div id="messageInputBackButton" class="absolute left-[26px] size-[42px] top-[52px] cursor-pointer z-30" onclick="backToLiveRoom()">
            <img alt="Back" class="block max-w-none w-full h-full" src="./src/assets/40807933db102c5ddfe145202e96cb747d9662c5.svg" />
        </div>

        <!-- Top Right Icons -->
        <div class="absolute h-6 left-[303px] top-[58px] w-16 z-30">
            <div id="page14SettingsIcon" class="absolute aspect-[200/200] left-0 overflow-clip right-[62.5%] top-0 cursor-pointer" onclick="showVolumeSettings()">
                <div class="absolute bottom-[5.313%] left-[2.813%] right-[2.713%] top-[5.312%]">
                    <img alt="Settings" class="block max-w-none w-full h-full" src="./src/assets/897f897fc1bc39bd5029b1c130459a892fd38f31.svg" style="filter: brightness(0) invert(1);" />
                </div>
            </div>
            <div class="absolute bottom-[8.333%] left-[68.75%] right-0 top-[8.333%]">
                <div class="absolute bottom-[-1.568%] left-[-1.568%] right-[-1.568%] top-[-1.568%]">
                    <img alt="More" class="block max-w-none w-full h-full" src="./src/assets/5477b83fa49bc1086b66f6e98ea33e17d7a7dcde.svg" style="filter: brightness(0) invert(1);" />
                </div>
            </div>
        </div>

        <!-- Chat Messages Area (Continuous Bullet Screen like Page 13) -->
        <div id="page14ChatContainer" class="absolute left-5 top-[229px] w-[282px] h-[234px] overflow-hidden z-30 barrage-scroll-container">
            <div id="page14ChatMessages" class="flex flex-col gap-2 pb-4 barrage-scroll-content">
                <!-- Initial chat messages - duplicated for seamless scrolling like page 13 -->
                <div class="chat-message backdrop-blur-[1px] backdrop-filter bg-[rgba(0,0,0,0.3)] flex flex-row gap-2 items-center p-[7px] rounded-2xl cursor-pointer" onclick="showIntro()">
                    <img alt="User" class="w-7 h-7 rounded-full" src="./src/assets/d4d2ca48cd435cf039ebac7d781a1bb460198b85.png" />
                    <div class="text-white text-[13px] leading-[16px]" style="font-family: 'Avenir LT Std', sans-serif;">
                        Who else thinks this belonged to a rich kid showing off at court?
                    </div>
                </div>
                
                <div class="chat-message backdrop-blur-[1px] backdrop-filter bg-[rgba(0,0,0,0.3)] flex flex-row gap-2 items-center p-[7px] rounded-2xl cursor-pointer" onclick="showIntro()">
                    <img alt="User" class="w-7 h-7 rounded-full" src="./src/assets/d4d2ca48cd435cf039ebac7d781a1bb460198b85.png" />
                    <div class="text-white text-[13px] leading-[16px]" style="font-family: 'Avenir LT Std', sans-serif;">
                        Hold on, I just found a 17th-century receipt about this thing!
                    </div>
                </div>

                <div class="chat-message backdrop-blur-[1px] backdrop-filter bg-[rgba(0,0,0,0.3)] flex flex-row gap-2 items-center p-[7px] rounded-[43px] cursor-pointer" onclick="showIntro()">
                    <img alt="User" class="w-7 h-7 rounded-full" src="./src/assets/e3ade9aa46c847d649f3684414fe999679b41c1d.png" />
                    <div class="text-white text-[13px] leading-[22px] whitespace-nowrap cursor-pointer character-message" style="font-family: 'Avenir LT Std', sans-serif;" data-character="van-gogh">
                        Qianlong: I shall stamp it!
                    </div>
                </div>

                <div class="chat-message backdrop-blur-[1px] backdrop-filter bg-[rgba(0,0,0,0.3)] flex flex-row gap-2 items-center p-[7px] rounded-[43px] cursor-pointer" onclick="showIntro()">
                    <img alt="User" class="w-7 h-7 rounded-full" src="./src/assets/d4d2ca48cd435cf039ebac7d781a1bb460198b85.png" />
                    <div class="text-white text-[13px] leading-[22px] whitespace-nowrap" style="font-family: 'Avenir LT Std', sans-serif;">
                        Unpacking centuries of opinions.
                    </div>
                </div>

                <div class="chat-message backdrop-blur-[1px] backdrop-filter bg-[rgba(0,0,0,0.3)] flex flex-row gap-2 items-center p-[7px] rounded-2xl cursor-pointer" onclick="showIntro()">
                    <img alt="User" class="w-7 h-7 rounded-full" src="./src/assets/d4d2ca48cd435cf039ebac7d781a1bb460198b85.png" />
                    <div class="text-white text-[13px] leading-[16px]" style="font-family: 'Avenir LT Std', sans-serif;">
                        This cat is probably judging all our historical debates 😸
                    </div>
                </div>

                <div class="chat-message backdrop-blur-[1px] backdrop-filter bg-[rgba(0,0,0,0.3)] flex flex-row gap-2 items-center p-[7px] rounded-2xl cursor-pointer" onclick="showIntro()">
                    <img alt="User" class="w-7 h-7 rounded-full" src="./src/assets/e3ade9aa46c847d649f3684414fe999679b41c1d.png" />
                    <div class="text-white text-[13px] leading-[16px]" style="font-family: 'Avenir LT Std', sans-serif;">
                        The frame is worth more than my house!
                    </div>
                </div>

                <div class="chat-message backdrop-blur-[1px] backdrop-filter bg-[rgba(0,0,0,0.3)] flex flex-row gap-2 items-center p-[7px] rounded-2xl cursor-pointer" onclick="showIntro()">
                    <img alt="User" class="w-7 h-7 rounded-full" src="./src/assets/d4d2ca48cd435cf039ebac7d781a1bb460198b85.png" />
                    <div class="text-white text-[13px] leading-[16px]" style="font-family: 'Avenir LT Std', sans-serif;">
                        I wonder what Vincent would think of all this chatter 🎨
                    </div>
                </div>

                <div class="chat-message backdrop-blur-[1px] backdrop-filter bg-[rgba(0,0,0,0.3)] flex flex-row gap-2 items-center p-[7px] rounded-2xl cursor-pointer" onclick="showIntro()">
                    <img alt="User" class="w-7 h-7 rounded-full" src="./src/assets/e3ade9aa46c847d649f3684414fe999679b41c1d.png" />
                    <div class="text-white text-[13px] leading-[16px]" style="font-family: 'Avenir LT Std', sans-serif;">
                        Anyone else getting museum vibes right now? ✨
                    </div>
                </div>

                <!-- Duplicate messages for seamless loop -->
                <div class="chat-message backdrop-blur-[1px] backdrop-filter bg-[rgba(0,0,0,0.3)] flex flex-row gap-2 items-center p-[7px] rounded-2xl cursor-pointer" onclick="showIntro()">
                    <img alt="User" class="w-7 h-7 rounded-full" src="./src/assets/d4d2ca48cd435cf039ebac7d781a1bb460198b85.png" />
                    <div class="text-white text-[13px] leading-[16px]" style="font-family: 'Avenir LT Std', sans-serif;">
                        Who else thinks this belonged to a rich kid showing off at court?
                    </div>
                </div>

                <div class="chat-message backdrop-blur-[1px] backdrop-filter bg-[rgba(0,0,0,0.3)] flex flex-row gap-2 items-center p-[7px] rounded-2xl cursor-pointer" onclick="showIntro()">
                    <img alt="User" class="w-7 h-7 rounded-full" src="./src/assets/d4d2ca48cd435cf039ebac7d781a1bb460198b85.png" />
                    <div class="text-white text-[13px] leading-[16px]" style="font-family: 'Avenir LT Std', sans-serif;">
                        Hold on, I just found a 17th-century receipt about this thing!
                    </div>
                </div>

                <div class="chat-message backdrop-blur-[1px] backdrop-filter bg-[rgba(0,0,0,0.3)] flex flex-row gap-2 items-center p-[7px] rounded-[43px] cursor-pointer" onclick="showIntro()">
                    <img alt="User" class="w-7 h-7 rounded-full" src="./src/assets/e3ade9aa46c847d649f3684414fe999679b41c1d.png" />
                    <div class="text-white text-[13px] leading-[22px] whitespace-nowrap cursor-pointer character-message" style="font-family: 'Avenir LT Std', sans-serif;" data-character="van-gogh">
                        Qianlong: I shall stamp it!
                    </div>
                </div>
            </div>
            
            <!-- Subtle fade effects for smooth message transitions (matching page 18) -->
            <div class="absolute top-0 left-0 right-0 h-[25px] bg-gradient-to-b from-black/30 to-transparent z-10 pointer-events-none"></div>
            <div class="absolute bottom-0 left-0 right-0 h-[25px] bg-gradient-to-t from-black/30 to-transparent z-10 pointer-events-none"></div>
        </div>

        <!-- Message Input Area (Bottom Bar) -->
        <div class="absolute bg-[rgba(255,255,255,0)] box-border content-stretch flex flex-col gap-2.5 items-start justify-start left-0 overflow-clip px-6 py-3 top-[463px] w-[392px] z-30">
            <div class="backdrop-blur-[1px] backdrop-filter bg-[rgba(0,0,0,0.3)] box-border content-stretch flex flex-row h-11 items-center justify-between pl-[18px] pr-[5px] py-[5px] relative rounded-[100px] shrink-0 w-full">
                <input 
                    id="messageInput" 
                    type="text" 
                    placeholder="Type here" 
                    class="flex-1 bg-transparent font-['Avenir_LT_Std:55_Roman',_sans-serif] text-[14px] text-white placeholder-[rgba(255,255,255,0.5)] border-none outline-none w-[258px]"
                    onkeypress="handleMessageInputKeyPress(event)"
                />
                <div id="sendMessageBtn" class="bg-[rgba(98,74,54,0.8)] box-border content-stretch flex flex-row gap-2.5 items-center justify-center p-[10px] relative rounded-[22px] shrink-0 size-[34px] cursor-pointer" onclick="sendMessage()">
                    <div class="relative shrink-0 size-8">
                        <img alt="Send" class="block max-w-none w-full h-full" src="./src/assets/c421a92614399189497f7478f0d85ba46a8fb766.svg" />
                    </div>
                </div>
            </div>
        </div>

        <!-- iPhone Keyboard -->
        <div class="absolute backdrop-blur-[47.71px] backdrop-filter bg-[#d0d3da] bottom-0 box-border content-stretch flex flex-col h-[321px] items-center justify-end left-[-1px] min-w-[357.824px] pb-0 pt-[2.863px] px-0 w-[394px] z-30">
            <!-- Autocorrection Bar -->
            <div class="box-border content-stretch flex flex-row items-start justify-start overflow-clip px-0 py-[2.863px] relative shrink-0 w-full">
                <div class="basis-0 box-border content-stretch flex flex-row gap-[1.908px] grow h-[39px] items-center justify-start min-h-px min-w-px px-[0.954px] py-0 relative shrink-0">
                    <div class="basis-0 grow h-full min-h-px min-w-px relative rounded-[4.6px] shrink-0">
                        <div class="absolute flex flex-col font-['SF_Pro:Regular',_sans-serif] font-normal inset-0 justify-center leading-[0] overflow-ellipsis overflow-hidden text-[#000000] text-[16.22px] text-center text-nowrap tracking-[-0.3817px]">
                            <p class="block leading-[20.992px] overflow-inherit">"The"</p>
                        </div>
                    </div>
                    <div class="box-border content-stretch flex flex-row h-[23.855px] items-center justify-center px-[1.908px] py-0 relative shrink-0">
                        <div class="bg-[#000000] h-full opacity-10 shrink-0 w-[0.954px]"></div>
                    </div>
                    <div class="basis-0 grow h-full min-h-px min-w-px relative rounded-[4.6px] shrink-0">
                        <div class="absolute flex flex-col font-['SF_Pro:Regular',_sans-serif] font-normal inset-0 justify-center leading-[0] overflow-ellipsis overflow-hidden text-[#000000] text-[16.22px] text-center text-nowrap tracking-[-0.3817px]">
                            <p class="block leading-[20.992px] overflow-inherit">the</p>
                        </div>
                    </div>
                    <div class="box-border content-stretch flex flex-row h-[23.855px] items-center justify-center px-[1.908px] py-0 relative shrink-0">
                        <div class="bg-[#000000] h-full opacity-10 shrink-0 w-[0.954px]"></div>
                    </div>
                    <div class="basis-0 grow h-full min-h-px min-w-px relative rounded-[4.6px] shrink-0">
                        <div class="absolute flex flex-col font-['SF_Pro:Regular',_sans-serif] font-normal inset-0 justify-center leading-[0] overflow-ellipsis overflow-hidden text-[#000000] text-[16.22px] text-center text-nowrap tracking-[-0.3817px]">
                            <p class="block leading-[20.992px] overflow-inherit">to</p>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Keyboard Separator -->
            <div class="flex items-center justify-center relative shrink-0 w-full">
                <div class="flex-none scale-y-[-100%] w-full">
                    <div class="h-[4.771px] opacity-60 w-full"></div>
                </div>
            </div>
            
            <!-- Keyboard Layout -->
            <div class="h-[204px] relative shrink-0 w-full">
                <!-- Space and Send Row -->
                <div class="absolute bottom-0 h-[40.076px] left-[25.7%] right-[25.7%]">
                    <div class="absolute h-[42px] left-0 right-0 rounded-[4.389px] shadow-[0px_0.954px_0px_0px_#898a8d] top-0 cursor-pointer" onclick="addToInput(' ')">
                        <div class="absolute bg-[#fcfcfe] bottom-0 h-[40.076px] left-0 right-0 rounded-[4.389px] shadow-[0px_0.954px_0px_0px_#898a8d]">
                            <div class="absolute flex flex-col font-['SF_Pro:Regular',_sans-serif] font-normal h-[40.076px] justify-center leading-[0] left-0 right-0 text-[#000000] text-[15.27px] text-center top-1/2 tracking-[-0.3817px] translate-y-[-50%]">
                                <p class="block leading-[20.038px]">space</p>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Send Button -->
                <div class="absolute bg-[#007aff] bottom-0 h-[42px] left-[75.827%] right-[0.763%] rounded-[4.389px] shadow-[0px_0.954px_0px_0px_#898a8d] cursor-pointer" onclick="sendMessage()">
                    <div class="absolute flex flex-col font-['SF_Pro:Regular',_sans-serif] font-normal h-[40.076px] justify-center leading-[0] left-0 right-0 text-[#ffffff] text-[15.27px] text-center top-1/2 tracking-[-0.3817px] translate-y-[-50%]">
                        <p class="block leading-[20.038px]">send</p>
                    </div>
                </div>
                
                <!-- ABC Switch Button -->
                <div class="absolute bg-[#abb0ba] bottom-0 h-[42px] left-[0.763%] right-[75.827%] rounded-[4.389px] shadow-[0px_0.954px_0px_0px_#898a8d]">
                    <div class="absolute flex flex-col font-['SF_Pro:Regular',_sans-serif] font-normal h-[40.076px] justify-center leading-[0] left-0 right-0 text-[#000000] text-[15.27px] text-center top-1/2 tracking-[-0.3817px] translate-y-[-50%]">
                        <p class="block leading-[20.038px]">ABC</p>
                    </div>
                </div>
                
                <!-- Third Row (ZXCVBNM) -->
                <div class="absolute bottom-[51.527px] box-border content-stretch flex flex-row gap-[5.725px] items-start justify-start left-[15.776%] p-0 right-[15.776%]">
                    <div class="basis-0 bg-[#fcfcfe] grow h-[42px] min-h-px min-w-px relative rounded-[4.389px] shadow-[0px_0.954px_0px_0px_#898a8d] shrink-0 cursor-pointer" onclick="addToInput('z')">
                        <div class="absolute flex flex-col font-['SF_Pro:Regular',_sans-serif] font-normal h-[45.801px] justify-center leading-[0] left-0 right-0 text-[#000000] text-[23.85px] text-center translate-y-[-50%]" style="top: calc(50% - 2.863px);">
                            <p class="block leading-[26.718px]">z</p>
                        </div>
                    </div>
                    <div class="basis-0 bg-[#fcfcfe] grow h-[42px] min-h-px min-w-px relative rounded-[4.389px] shadow-[0px_0.954px_0px_0px_#898a8d] shrink-0 cursor-pointer" onclick="addToInput('x')">
                        <div class="absolute flex flex-col font-['SF_Pro:Regular',_sans-serif] font-normal h-[45.801px] justify-center leading-[0] left-0 right-0 text-[#000000] text-[23.85px] text-center translate-y-[-50%]" style="top: calc(50% - 2.863px);">
                            <p class="block leading-[26.718px]">x</p>
                        </div>
                    </div>
                    <div class="basis-0 bg-[#fcfcfe] grow h-[42px] min-h-px min-w-px relative rounded-[4.389px] shadow-[0px_0.954px_0px_0px_#898a8d] shrink-0 cursor-pointer" onclick="addToInput('c')">
                        <div class="absolute flex flex-col font-['SF_Pro:Regular',_sans-serif] font-normal h-[45.801px] justify-center leading-[0] left-0 right-0 text-[#000000] text-[23.85px] text-center translate-y-[-50%]" style="top: calc(50% - 2.863px);">
                            <p class="block leading-[26.718px]">c</p>
                        </div>
                    </div>
                    <div class="basis-0 bg-[#fcfcfe] grow h-[42px] min-h-px min-w-px relative rounded-[4.389px] shadow-[0px_0.954px_0px_0px_#898a8d] shrink-0 cursor-pointer" onclick="addToInput('v')">
                        <div class="absolute flex flex-col font-['SF_Pro:Regular',_sans-serif] font-normal h-[45.801px] justify-center leading-[0] left-0 right-0 text-[#000000] text-[23.85px] text-center translate-y-[-50%]" style="top: calc(50% - 2.863px);">
                            <p class="block leading-[26.718px]">v</p>
                        </div>
                    </div>
                    <div class="basis-0 bg-[#fcfcfe] grow h-[42px] min-h-px min-w-px relative rounded-[4.389px] shadow-[0px_0.954px_0px_0px_#898a8d] shrink-0 cursor-pointer" onclick="addToInput('b')">
                        <div class="absolute flex flex-col font-['SF_Pro:Regular',_sans-serif] font-normal h-[45.801px] justify-center leading-[0] left-0 right-0 text-[#000000] text-[23.85px] text-center translate-y-[-50%]" style="top: calc(50% - 2.863px);">
                            <p class="block leading-[26.718px]">b</p>
                        </div>
                    </div>
                    <div class="basis-0 bg-[#fcfcfe] grow h-[42px] min-h-px min-w-px relative rounded-[4.389px] shadow-[0px_0.954px_0px_0px_#898a8d] shrink-0 cursor-pointer" onclick="addToInput('n')">
                        <div class="absolute flex flex-col font-['SF_Pro:Regular',_sans-serif] font-normal h-[45.801px] justify-center leading-[0] left-0 right-0 text-[#000000] text-[23.85px] text-center translate-y-[-50%]" style="top: calc(50% - 2.863px);">
                            <p class="block leading-[26.718px]">n</p>
                        </div>
                    </div>
                    <div class="basis-0 bg-[#fcfcfe] grow h-[42px] min-h-px min-w-px relative rounded-[4.389px] shadow-[0px_0.954px_0px_0px_#898a8d] shrink-0 cursor-pointer" onclick="addToInput('m')">
                        <div class="absolute flex flex-col font-['SF_Pro:Regular',_sans-serif] font-normal h-[45.801px] justify-center leading-[0] left-0 right-0 text-[#000000] text-[23.85px] text-center translate-y-[-50%]" style="top: calc(50% - 2.863px);">
                            <p class="block leading-[26.718px]">m</p>
                        </div>
                    </div>
                </div>
                
                <!-- Delete and Shift Keys for third row -->
                <div class="absolute bg-[#abb0ba] bottom-[51.527px] h-[42px] left-[88.041%] right-[0.763%] rounded-[4.389px] shadow-[0px_0.954px_0px_0px_#898a8d] cursor-pointer" onclick="deleteLastChar()">
                    <div class="absolute flex flex-col font-['SF_Pro:Regular',_sans-serif] font-normal justify-center leading-[0] left-1/2 text-[#000000] text-[19.08px] text-center text-nowrap top-1/2 translate-x-[-50%] translate-y-[-50%]">
                        <p class="block leading-[26.718px] whitespace-pre">⌫</p>
                    </div>
                </div>
                
                <div class="absolute bg-[#abb0ba] bottom-[51.527px] h-[42px] left-[0.763%] right-[88.041%] rounded-[4.389px] shadow-[0px_0.954px_0px_0px_#898a8d]">
                    <div class="absolute flex flex-col font-['SF_Pro:Regular',_sans-serif] font-normal justify-center leading-[0] text-[#000000] text-[19.08px] text-center text-nowrap top-1/2 translate-x-[-50%] translate-y-[-50%]" style="left: calc(50% + 0.477px);">
                        <p class="block leading-[26.718px] whitespace-pre">⇧</p>
                    </div>
                </div>
                
                <!-- Second Row (ASDFGHJKL) -->
                <div class="absolute bottom-[103.053px] box-border content-stretch flex flex-row gap-[5.725px] items-start justify-start left-[5.852%] p-0 right-[5.852%]">
                    <div class="basis-0 bg-[#fcfcfe] grow h-[42px] min-h-px min-w-px relative rounded-[4.389px] shadow-[0px_0.954px_0px_0px_#898a8d] shrink-0 cursor-pointer" onclick="addToInput('a')">
                        <div class="absolute flex flex-col font-['SF_Pro:Regular',_sans-serif] font-normal h-[45.801px] justify-center leading-[0] left-0 right-0 text-[#000000] text-[23.85px] text-center translate-y-[-50%]" style="top: calc(50% - 2.863px);">
                            <p class="block leading-[26.718px]">a</p>
                        </div>
                    </div>
                    <div class="basis-0 bg-[#fcfcfe] grow h-[42px] min-h-px min-w-px relative rounded-[4.389px] shadow-[0px_0.954px_0px_0px_#898a8d] shrink-0 cursor-pointer" onclick="addToInput('s')">
                        <div class="absolute flex flex-col font-['SF_Pro:Regular',_sans-serif] font-normal h-[45.801px] justify-center leading-[0] left-0 right-0 text-[#000000] text-[23.85px] text-center translate-y-[-50%]" style="top: calc(50% - 2.863px);">
                            <p class="block leading-[26.718px]">s</p>
                        </div>
                    </div>
                    <div class="basis-0 bg-[#fcfcfe] grow h-[42px] min-h-px min-w-px relative rounded-[4.389px] shadow-[0px_0.954px_0px_0px_#898a8d] shrink-0 cursor-pointer" onclick="addToInput('d')">
                        <div class="absolute flex flex-col font-['SF_Pro:Regular',_sans-serif] font-normal h-[45.801px] justify-center leading-[0] left-0 right-0 text-[#000000] text-[23.85px] text-center translate-y-[-50%]" style="top: calc(50% - 2.863px);">
                            <p class="block leading-[26.718px]">d</p>
                        </div>
                    </div>
                    <div class="basis-0 bg-[#fcfcfe] grow h-[42px] min-h-px min-w-px relative rounded-[4.389px] shadow-[0px_0.954px_0px_0px_#898a8d] shrink-0 cursor-pointer" onclick="addToInput('f')">
                        <div class="absolute flex flex-col font-['SF_Pro:Regular',_sans-serif] font-normal h-[45.801px] justify-center leading-[0] left-0 right-0 text-[#000000] text-[23.85px] text-center translate-y-[-50%]" style="top: calc(50% - 2.863px);">
                            <p class="block leading-[26.718px]">f</p>
                        </div>
                    </div>
                    <div class="basis-0 bg-[#fcfcfe] grow h-[42px] min-h-px min-w-px relative rounded-[4.389px] shadow-[0px_0.954px_0px_0px_#898a8d] shrink-0 cursor-pointer" onclick="addToInput('g')">
                        <div class="absolute flex flex-col font-['SF_Pro:Regular',_sans-serif] font-normal h-[45.801px] justify-center leading-[0] left-0 right-0 text-[#000000] text-[23.85px] text-center translate-y-[-50%]" style="top: calc(50% - 2.863px);">
                            <p class="block leading-[26.718px]">g</p>
                        </div>
                    </div>
                    <div class="basis-0 bg-[#fcfcfe] grow h-[42px] min-h-px min-w-px relative rounded-[4.389px] shadow-[0px_0.954px_0px_0px_#898a8d] shrink-0 cursor-pointer" onclick="addToInput('h')">
                        <div class="absolute flex flex-col font-['SF_Pro:Regular',_sans-serif] font-normal h-[45.801px] justify-center leading-[0] left-0 right-0 text-[#000000] text-[23.85px] text-center translate-y-[-50%]" style="top: calc(50% - 2.863px);">
                            <p class="block leading-[26.718px]">h</p>
                        </div>
                    </div>
                    <div class="basis-0 bg-[#fcfcfe] grow h-[42px] min-h-px min-w-px relative rounded-[4.389px] shadow-[0px_0.954px_0px_0px_#898a8d] shrink-0 cursor-pointer" onclick="addToInput('j')">
                        <div class="absolute flex flex-col font-['SF_Pro:Regular',_sans-serif] font-normal h-[45.801px] justify-center leading-[0] left-0 right-0 text-[#000000] text-[23.85px] text-center translate-y-[-50%]" style="top: calc(50% - 2.863px);">
                            <p class="block leading-[26.718px]">j</p>
                        </div>
                    </div>
                    <div class="basis-0 bg-[#fcfcfe] grow h-[42px] min-h-px min-w-px relative rounded-[4.389px] shadow-[0px_0.954px_0px_0px_#898a8d] shrink-0 cursor-pointer" onclick="addToInput('k')">
                        <div class="absolute flex flex-col font-['SF_Pro:Regular',_sans-serif] font-normal h-[45.801px] justify-center leading-[0] left-0 right-0 text-[#000000] text-[23.85px] text-center translate-y-[-50%]" style="top: calc(50% - 2.863px);">
                            <p class="block leading-[26.718px]">k</p>
                        </div>
                    </div>
                    <div class="basis-0 bg-[#fcfcfe] grow h-[42px] min-h-px min-w-px relative rounded-[4.389px] shadow-[0px_0.954px_0px_0px_#898a8d] shrink-0 cursor-pointer" onclick="addToInput('l')">
                        <div class="absolute flex flex-col font-['SF_Pro:Regular',_sans-serif] font-normal h-[45.801px] justify-center leading-[0] left-0 right-0 text-[#000000] text-[23.85px] text-center translate-y-[-50%]" style="top: calc(50% - 2.863px);">
                            <p class="block leading-[26.718px]">l</p>
                        </div>
                    </div>
                </div>
                
                <!-- First Row (QWERTYUIOP) -->
                <div class="absolute bottom-[154.58px] box-border content-stretch flex flex-row gap-[5.725px] items-start justify-start left-[0.763%] p-0 right-[0.763%]">
                    <div class="basis-0 bg-[#fcfcfe] grow h-[42px] min-h-px min-w-px relative rounded-[4.389px] shadow-[0px_0.954px_0px_0px_#898a8d] shrink-0 cursor-pointer" onclick="addToInput('q')">
                        <div class="absolute flex flex-col font-['SF_Pro:Regular',_sans-serif] font-normal h-[45.801px] justify-center leading-[0] left-0 right-0 text-[#000000] text-[23.85px] text-center translate-y-[-50%]" style="top: calc(50% - 2.863px);">
                            <p class="block leading-[26.718px]">q</p>
                        </div>
                    </div>
                    <div class="basis-0 bg-[#fcfcfe] grow h-[42px] min-h-px min-w-px relative rounded-[4.389px] shadow-[0px_0.954px_0px_0px_#898a8d] shrink-0 cursor-pointer" onclick="addToInput('w')">
                        <div class="absolute flex flex-col font-['SF_Pro:Regular',_sans-serif] font-normal h-[45.801px] justify-center leading-[0] left-0 right-0 text-[#000000] text-[23.85px] text-center translate-y-[-50%]" style="top: calc(50% - 2.863px);">
                            <p class="block leading-[26.718px]">w</p>
                        </div>
                    </div>
                    <div class="basis-0 bg-[#fcfcfe] grow h-[42px] min-h-px min-w-px relative rounded-[4.389px] shadow-[0px_0.954px_0px_0px_#898a8d] shrink-0 cursor-pointer" onclick="addToInput('e')">
                        <div class="absolute flex flex-col font-['SF_Pro:Regular',_sans-serif] font-normal h-[45.801px] justify-center leading-[0] left-0 right-0 text-[#000000] text-[23.85px] text-center translate-y-[-50%]" style="top: calc(50% - 2.863px);">
                            <p class="block leading-[26.718px]">e</p>
                        </div>
                    </div>
                    <div class="basis-0 bg-[#fcfcfe] grow h-[42px] min-h-px min-w-px relative rounded-[4.389px] shadow-[0px_0.954px_0px_0px_#898a8d] shrink-0 cursor-pointer" onclick="addToInput('r')">
                        <div class="absolute flex flex-col font-['SF_Pro:Regular',_sans-serif] font-normal h-[45.801px] justify-center leading-[0] left-0 right-0 text-[#000000] text-[23.85px] text-center translate-y-[-50%]" style="top: calc(50% - 2.863px);">
                            <p class="block leading-[26.718px]">r</p>
                        </div>
                    </div>
                    <div class="basis-0 bg-[#fcfcfe] grow h-[42px] min-h-px min-w-px relative rounded-[4.389px] shadow-[0px_0.954px_0px_0px_#898a8d] shrink-0 cursor-pointer" onclick="addToInput('t')">
                        <div class="absolute flex flex-col font-['SF_Pro:Regular',_sans-serif] font-normal h-[45.801px] justify-center leading-[0] left-0 right-0 text-[#000000] text-[23.85px] text-center translate-y-[-50%]" style="top: calc(50% - 2.863px);">
                            <p class="block leading-[26.718px]">t</p>
                        </div>
                    </div>
                    <div class="basis-0 bg-[#fcfcfe] grow h-[42px] min-h-px min-w-px relative rounded-[4.389px] shadow-[0px_0.954px_0px_0px_#898a8d] shrink-0 cursor-pointer" onclick="addToInput('y')">
                        <div class="absolute flex flex-col font-['SF_Pro:Regular',_sans-serif] font-normal h-[45.801px] justify-center leading-[0] left-0 right-0 text-[#000000] text-[23.85px] text-center translate-y-[-50%]" style="top: calc(50% - 2.863px);">
                            <p class="block leading-[26.718px]">y</p>
                        </div>
                    </div>
                    <div class="basis-0 bg-[#fcfcfe] grow h-[42px] min-h-px min-w-px relative rounded-[4.389px] shadow-[0px_0.954px_0px_0px_#898a8d] shrink-0 cursor-pointer" onclick="addToInput('u')">
                        <div class="absolute flex flex-col font-['SF_Pro:Regular',_sans-serif] font-normal h-[45.801px] justify-center leading-[0] left-0 right-0 text-[#000000] text-[23.85px] text-center translate-y-[-50%]" style="top: calc(50% - 2.863px);">
                            <p class="block leading-[26.718px]">u</p>
                        </div>
                    </div>
                    <div class="basis-0 bg-[#fcfcfe] grow h-[42px] min-h-px min-w-px relative rounded-[4.389px] shadow-[0px_0.954px_0px_0px_#898a8d] shrink-0 cursor-pointer" onclick="addToInput('i')">
                        <div class="absolute flex flex-col font-['SF_Pro:Regular',_sans-serif] font-normal h-[45.801px] justify-center leading-[0] left-0 right-0 text-[#000000] text-[23.85px] text-center translate-y-[-50%]" style="top: calc(50% - 2.863px);">
                            <p class="block leading-[26.718px]">i</p>
                        </div>
                    </div>
                    <div class="basis-0 bg-[#fcfcfe] grow h-[42px] min-h-px min-w-px relative rounded-[4.389px] shadow-[0px_0.954px_0px_0px_#898a8d] shrink-0 cursor-pointer" onclick="addToInput('o')">
                        <div class="absolute flex flex-col font-['SF_Pro:Regular',_sans-serif] font-normal h-[45.801px] justify-center leading-[0] left-0 right-0 text-[#000000] text-[23.85px] text-center translate-y-[-50%]" style="top: calc(50% - 2.863px);">
                            <p class="block leading-[26.718px]">o</p>
                        </div>
                    </div>
                    <div class="basis-0 bg-[#fcfcfe] grow h-[42px] min-h-px min-w-px relative rounded-[4.389px] shadow-[0px_0.954px_0px_0px_#898a8d] shrink-0 cursor-pointer" onclick="addToInput('p')">
                        <div class="absolute flex flex-col font-['SF_Pro:Regular',_sans-serif] font-normal h-[45.801px] justify-center leading-[0] left-0 right-0 text-[#000000] text-[23.85px] text-center translate-y-[-50%]" style="top: calc(50% - 2.863px);">
                            <p class="block leading-[26.718px]">p</p>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Emoji and Mic Row -->
            <div class="box-border content-stretch flex flex-row h-[55.343px] items-start justify-between pb-0 pt-[23.855px] px-[19.084px] relative shrink-0 w-full">
                <div class="relative shrink-0 size-[25.687px]">
                    <img alt="Emoji" class="block max-w-none w-full h-full" src="./src/assets/6e3b7133b49aa49e38c0aed341b74a9fa7638f82.svg" />
                </div>
                <div class="flex flex-col font-['SF_Pro:Regular',_sans-serif] font-normal justify-center leading-[0] relative shrink-0 text-[25.76px] text-[rgba(60,60,67,0.8)] text-center text-nowrap">
                    <p class="block leading-[normal] whitespace-pre">🎤</p>
                </div>
            </div>
            
            <!-- Home Indicator -->
            <div class="h-[21px] relative shrink-0 w-full">
                <div class="absolute bg-[#000000] bottom-[7.634px] h-[4.771px] left-1/2 rounded-[100px] translate-x-[-50%] w-[127.863px]"></div>
            </div>
        </div>
    </div>

    <!-- Eighteenth Page - Live Page with Voice Input -->
    <div id="page18" class="mobile-container absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 z-50 hidden" style="width: 393px; height: 852px;">
        <!-- Background -->
        <div class="absolute inset-0" style="background-image: url('./src/assets/2339a82e4b6020c219c18a48dca73ef3ba006ffe.png'); background-size: cover; background-position: center; background-repeat: no-repeat;"></div>
        
        <!-- Status bar -->
        <div class="absolute top-0 left-1/2 transform -translate-x-1/2 w-[393px] z-10">
            <div class="h-11 relative w-full">
                <div class="absolute h-[22px] left-[26px] top-[15px] w-[54px]">
                    <div class="absolute font-semibold text-white text-[17px] text-center top-1/2 transform -translate-y-1/2 left-0 right-0" style="font-family: 'SF Pro Text', sans-serif;">
                        <p class="leading-[22px]">12:15</p>
                    </div>
                </div>
                <div class="absolute right-[26.339px] top-[19.333px] w-[27.328px] h-[13px]">
                    <img alt="Battery" class="block max-w-none w-full h-full" src="./src/assets/c0c091687c62d7337bf318e17f3769ffc34d3a72.svg" />
                </div>
                <div class="absolute right-[61px] top-5 w-[17px] h-3">
                    <img alt="Wifi" class="block max-w-none w-full h-full" src="./src/assets/94bdfe1a8077b65bf75e0473782ae3df50cd473f.svg" />
                </div>
                <div class="absolute right-[85.4px] top-5 w-[19.2px] h-3">
                    <img alt="Cellular" class="block max-w-none w-full h-full" src="./src/assets/a883d1003c9c8d00c12b4d64e84ed02fcbbf9603.svg" />
                </div>
            </div>
        </div>

        <!-- Back Button -->
        <div id="voiceBackButton" class="absolute left-[26px] top-[52px] w-[42px] h-[42px] cursor-pointer z-20" onclick="handleBackFromVoice()">
            <img alt="Back" class="block max-w-none w-full h-full" src="./src/assets/40807933db102c5ddfe145202e96cb747d9662c5.svg" />
        </div>

        <!-- Top Right Icons -->
        <div id="page18SettingsIcon" class="absolute right-[26px] top-[59px] w-16 h-6 z-20 cursor-pointer" onclick="showVolumeSettings(); showDebugInfo('Opened volume settings from page 18');">
            <img alt="Top Icons" class="block max-w-none w-full h-full" src="./src/assets/f7086b5338a837441ddce3dd9489cf4097df2155.svg" />
        </div>

        <!-- Chat Messages Area (Continuing from Page 13) -->
        <div id="voiceChatContainer" class="absolute left-5 top-[457px] w-[282px] h-[234px] overflow-hidden z-30">
            <div id="voiceChatMessages" class="flex flex-col gap-2 pb-4">
                <!-- Messages will be copied from page 13 and continue scrolling -->
            </div>
            
            <!-- Subtle fade effect for messages at top and bottom -->
            <div class="absolute top-0 left-0 right-0 h-[25px] bg-gradient-to-b from-black/30 to-transparent z-10 pointer-events-none"></div>
            <div class="absolute bottom-0 left-0 right-0 h-[25px] bg-gradient-to-t from-black/30 to-transparent z-10 pointer-events-none"></div>
        </div>

        <!-- Floating Emojis Area (Right side) - Continue from Page 13 -->
        <div id="voiceEmojiContainer" class="absolute left-80 top-[584px] w-[61px] h-[201px] overflow-hidden z-30">
            <!-- Floating emojis will continue from page 13 -->
        </div>

        <!-- Voice Input UI (Centered Bottom Position) -->
        <div class="absolute left-1/2 transform -translate-x-1/2 bottom-[50px] w-[203px] flex flex-col gap-[15px] items-center justify-end z-40">
            <!-- Timer and Wave Animation Container -->
            <div id="voiceInputStatus" class="bg-[#ffe0c4] rounded-2xl shadow-[0px_2px_10px_0px_rgba(0,0,0,0.15)] w-full h-[60px] flex items-center justify-center gap-5 px-4 py-5 hidden voice-status-active">
                <!-- Timer Display -->
                <div id="voiceTimer" class="text-[#252529] text-[15px] font-normal timer-active" style="font-family: 'SF Pro Display', sans-serif; line-height: 28px; font-weight: 400;">1"</div>
                
                <!-- Enhanced Wave Animation with Multiple Bars -->
                <div id="voiceWaveAnimation" class="h-10 w-[61px] flex items-center justify-center gap-1">
                    <!-- Original wave as base -->
                    <div class="voice-wave-active flex-1 h-full">
                        <img alt="Sound Wave" class="block max-w-none w-full h-full" src="./src/assets/e2cb2d02a93d1090460b886397b20327d18658e9.svg" />
                    </div>
                    
                    <!-- Additional animated bars for enhanced effect -->
                    <div class="flex items-center justify-center gap-0.5 absolute inset-0 opacity-60">
                        <div class="voice-wave-bar-1 w-1 bg-[#252529] rounded-full" style="height: 20px;"></div>
                        <div class="voice-wave-bar-2 w-1 bg-[#252529] rounded-full" style="height: 24px;"></div>
                        <div class="voice-wave-bar-3 w-1 bg-[#252529] rounded-full" style="height: 16px;"></div>
                        <div class="voice-wave-bar-1 w-1 bg-[#252529] rounded-full" style="height: 28px;"></div>
                        <div class="voice-wave-bar-2 w-1 bg-[#252529] rounded-full" style="height: 20px;"></div>
                    </div>
                </div>
            </div>

            <!-- Enhanced Mic Button with Better Interaction -->
            <div id="voiceMicButton" class="bg-[#564230] border-[1.849px] border-[#564230] border-solid rounded-[123.256px] w-[53px] h-[53px] flex items-center justify-center cursor-pointer transition-all duration-200 hover:bg-[#6b5340] active:scale-95 hover:shadow-lg">
                <div class="w-[28.349px] h-[28.349px]">
                    <img alt="Microphone" class="block max-w-none w-full h-full" src="./src/assets/30a7eb0eedb289b59c214e801d3992f7d92dddc6.svg" />
                </div>
            </div>
        </div>

        <!-- Home Indicator -->
        <div class="absolute left-0 top-[818px] w-[393px] flex items-center justify-center">
            <div class="h-[34px] w-full relative flex items-center justify-center">
                <div class="bg-[#919191] rounded-[2.5px] w-[134px] h-[5px]"></div>
            </div>
        </div>
    </div>

    <!-- Page 15: Character Detail Page 1 (intro) -->
    <div id="page15" class="mobile-container absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 z-50 hidden" style="width: 393px; height: 852px;">
        <!-- Background with museum artwork -->
        <div class="absolute inset-0 bg-center bg-cover bg-no-repeat" style="background-image: url('./src/assets/2339a82e4b6020c219c18a48dca73ef3ba006ffe.png');"></div>
        
        <!-- Full screen overlay -->
        <div class="absolute inset-0 bg-black/30 backdrop-blur-sm"></div>
        
        <!-- Status bar V2 -->
        <div class="absolute box-border content-stretch flex flex-col items-start justify-start left-1/2 p-0 top-0 translate-x-[-50%] w-[393px] z-30" data-name="Status bar V2">
            <div class="h-11 relative w-full" data-name="Status Bar">
                <div class="absolute h-[22px] left-[26px] top-[15px] w-[54px]" data-name="Time">
                    <div class="absolute font-semibold leading-[0] left-0 not-italic right-0 text-[#ffffff] text-[17px] text-center" style="top: calc(50% - 11px); font-family: 'SF Pro Text', sans-serif;">
                        <p class="block leading-[22px]">12:15</p>
                    </div>
                </div>
                <div class="absolute h-[13px] right-[26.339px] top-[19.333px] w-[27.328px]" data-name="Battery">
                    <img alt="Battery" class="block max-w-none w-full h-full" src="./src/assets/c0c091687c62d7337bf318e17f3769ffc34d3a72.svg" />
                </div>
                <div class="absolute h-3 right-[61px] top-5 w-[17px]" data-name="Wifi">
                    <img alt="Wifi" class="block max-w-none w-full h-full" src="./src/assets/94bdfe1a8077b65bf75e0473782ae3df50cd473f.svg" />
                </div>
                <div class="absolute h-3 right-[85.4px] top-5 w-[19.2px]" data-name="Cellular Connection">
                    <div class="absolute bottom-0 left-0 right-[-0.001%] top-0">
                        <img alt="Cellular" class="block max-w-none w-full h-full" src="./src/assets/a883d1003c9c8d00c12b4d64e84ed02fcbbf9603.svg" />
                    </div>
                </div>
            </div>
        </div>

        <!-- Back Button -->
        <div id="page15BackButton" class="absolute left-[26px] size-[42px] top-[52px] cursor-pointer z-30">
            <img alt="Back" class="block max-w-none w-full h-full" src="./src/assets/40807933db102c5ddfe145202e96cb747d9662c5.svg" />
        </div>

        <!-- Character Intro Modal -->
        <div class="absolute bg-[#fffaf4] h-[538px] rounded-[20px] top-1/2 translate-x-[-50%] translate-y-[-50%] w-[306px] z-40" style="left: calc(50% + 0.5px);">
            <!-- Character Image -->
            <div class="absolute h-[175px] left-[22px] top-11 w-[262px]">
                <div class="absolute bg-no-repeat h-[175.174px] left-[5px] rounded-[26px] top-0 w-[252.333px]" style="background-image: url('./src/assets/d84d1463db2967ad16c63a138581a4d524675326.png'); background-size: 100% 182.05%; background-position: 0% 33.43%;"></div>
            </div>
            
            <!-- Zoom Icon -->
            <div id="zoomIcon" class="absolute box-border content-stretch flex flex-row gap-3.5 items-center justify-start left-[272px] p-0 top-[11px] cursor-pointer z-50">
                <div class="relative shrink-0 size-[23px]">
                    <img alt="Zoom" class="block max-w-none w-full h-full" src="./src/assets/9403ffd15bd9a95db6a8488382897cc71b7212f7.svg" />
                </div>
            </div>
            
            <!-- Close Icon -->
            <div id="page15CloseButton" class="absolute left-1.5 size-9 top-1 cursor-pointer">
                <img alt="Close" class="block max-w-none w-full h-full" src="./src/assets/d23e0c72b637adf4346f1d26038aa38e3d04555c.svg" />
            </div>
            
            <!-- Character Info (Scrollable) -->
            <div class="absolute box-border content-stretch flex flex-col gap-3.5 items-center justify-start p-0 top-[236px] translate-x-[-50%] w-[271px] max-h-[280px] overflow-y-auto overflow-x-hidden" style="left: calc(50% + 0.5px); scrollbar-width: thin; scrollbar-color: rgba(0,0,0,0.2) transparent;">
                <div class="font-bold leading-[0] not-italic opacity-90 relative shrink-0 text-[#232323] text-[18px] text-center w-full" style="font-family: 'ABC Ginto Normal Variable Unlicensed Trial', sans-serif;">
                    <p class="block leading-[1.4]">Vincent van Gogh</p>
                </div>
                <div class="italic leading-[0] not-italic opacity-90 relative shrink-0 text-[#232323] text-[14px] text-left w-full" style="font-family: 'Avenir LT Std', sans-serif;">
                    <p class="block leading-[1.45]">"I painted not what I saw, but what I felt in that night of madness."</p>
                </div>
                <div class="leading-[0] not-italic opacity-90 relative shrink-0 text-[#0051ae] text-[14px] text-left w-full" style="font-family: 'Avenir LT Std', sans-serif;">
                    <p class="block leading-[1.6]">#LonelyGenius #PostImpressionist #NightOfTheMind</p>
                </div>
                <div class="box-border content-stretch flex flex-col gap-0.5 items-start justify-start leading-[0] not-italic p-0 relative shrink-0 text-[#232323] text-left w-full">
                    <div class="font-bold opacity-90 relative shrink-0 text-[15px] w-full" style="font-family: 'Avenir LT Std', sans-serif;">
                        <p class="block leading-[1.6]">Identity</p>
                    </div>
                    <div class="opacity-90 relative shrink-0 text-[14px] w-full" style="font-family: 'Avenir LT Std', sans-serif;">
                        <p class="block leading-[1.6]">19th-century Dutch painter, creator of The Starry Night</p>
                    </div>
                </div>
                <div class="box-border content-stretch flex flex-col gap-0.5 items-start justify-start leading-[0] not-italic p-0 relative shrink-0 text-[#232323] text-left w-full">
                    <div class="font-bold opacity-90 relative shrink-0 text-[15px] w-full" style="font-family: 'Avenir LT Std', sans-serif;">
                        <p class="block leading-[1.6]">Artistic Traits</p>
                    </div>
                    <div class="opacity-90 relative shrink-0 text-[14px] w-full" style="font-family: 'Avenir LT Std', sans-serif;">
                        <p class="block leading-[1.6]">Frequently quoted from personal letters; deeply sensitive to the emotional power of color</p>
                    </div>
                </div>
                
                <!-- Additional Content (to demonstrate scrolling) -->
                <div class="box-border content-stretch flex flex-col gap-0.5 items-start justify-start leading-[0] not-italic p-0 relative shrink-0 text-[#232323] text-left w-full">
                    <div class="font-bold opacity-90 relative shrink-0 text-[15px] w-full" style="font-family: 'Avenir LT Std', sans-serif;">
                        <p class="block leading-[1.6]">Historical Context</p>
                    </div>
                    <div class="opacity-90 relative shrink-0 text-[14px] w-full" style="font-family: 'Avenir LT Std', sans-serif;">
                        <p class="block leading-[1.6]">Born in 1853 in the Netherlands, Van Gogh struggled with mental illness throughout his life but created some of the most influential works in Western art history. His bold use of color and distinctive brushwork became hallmarks of Post-Impressionism.</p>
                    </div>
                </div>
                
                <div class="box-border content-stretch flex flex-col gap-0.5 items-start justify-start leading-[0] not-italic p-0 relative shrink-0 text-[#232323] text-left w-full">
                    <div class="font-bold opacity-90 relative shrink-0 text-[15px] w-full" style="font-family: 'Avenir LT Std', sans-serif;">
                        <p class="block leading-[1.6]">Famous Works</p>
                    </div>
                    <div class="opacity-90 relative shrink-0 text-[14px] w-full" style="font-family: 'Avenir LT Std', sans-serif;">
                        <p class="block leading-[1.6]">The Starry Night, Sunflowers, The Bedroom, Café Terrace at Night, and over 2,000 artworks including around 900 paintings and 1,100 drawings and sketches.</p>
                    </div>
                </div>
                
                <!-- Scroll padding at bottom -->
                <div class="h-4 w-full"></div>
            </div>
        </div>

        <!-- Home Indicator -->
        <div class="absolute box-border content-stretch flex flex-col items-center justify-start left-0 p-0 top-[818px] w-[393px]">
            <div class="h-[34px] relative shrink-0 w-full">
                <div class="absolute bg-[#919191] bottom-[23.529%] left-[32.267%] right-[32%] rounded-[2.5px] top-[61.765%]"></div>
            </div>
        </div>
    </div>

    <!-- Page 16: Character Detail Page 2 (expanded view) -->
    <div id="page16" class="mobile-container absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 z-50 hidden" style="width: 393px; height: 852px;">
        <!-- Background -->
        <div class="absolute inset-0 bg-[#fffaf4]"></div>
        
        <!-- Status bar V2 -->
        <div class="absolute box-border content-stretch flex flex-col items-start justify-start left-1/2 p-0 top-0 translate-x-[-50%] w-[375px] z-30">
            <div class="h-11 relative w-full">
                <div class="absolute h-[22px] left-[26px] top-[15px] w-[54px]">
                    <div class="absolute font-semibold leading-[0] left-0 not-italic right-0 text-[#000000] text-[17px] text-center" style="top: calc(50% - 11px); font-family: 'SF Pro Text', sans-serif;">
                        <p class="block leading-[22px]">12:15</p>
                    </div>
                </div>
                <div class="absolute h-[13px] right-[26.339px] top-[19.333px] w-[27.328px]">
                    <img alt="Battery" class="block max-w-none w-full h-full" src="./src/assets/b939cc1b874d195c26939816cd53400a2e8b4c87.svg" />
                </div>
                <div class="absolute h-3 right-[61px] top-5 w-[17px]">
                    <img alt="Wifi" class="block max-w-none w-full h-full" src="./src/assets/9e9c3b3e9690915df33d6e0de894f1c5141290b1.svg" />
                </div>
                <div class="absolute h-3 right-[85.4px] top-5 w-[19.2px]">
                    <img alt="Cellular" class="block max-w-none w-full h-full" src="./src/assets/c5f03e2be0e817b2af3b2b51903f13f82eb6050b.svg" />
                </div>
            </div>
        </div>

        <!-- Back Button -->
        <div id="page16BackButton" class="absolute left-6 size-[42px] top-[52px] cursor-pointer z-30">
            <img alt="Back" class="block max-w-none w-full h-full" src="./src/assets/8d8cbe981109a48150a98003a8693f5fbd8569a0.svg" />
        </div>

        <!-- Character Image (Larger) -->
        <div class="absolute h-[210px] top-[106px] translate-x-[-50%] w-[314.4px]" style="left: calc(50% - 0.3px);">
            <div class="absolute bg-no-repeat h-[210.208px] left-1.5 rounded-[31.2px] top-0 w-[302.8px]" style="background-image: url('./src/assets/d84d1463db2967ad16c63a138581a4d524675326.png'); background-size: 100% 182.05%; background-position: 0% 33.43%;"></div>
        </div>

        <!-- Character Info (Expanded) -->
        <div class="absolute box-border content-stretch flex flex-col gap-6 items-center justify-start p-0 top-[334px] translate-x-[-50%] w-[346px]" style="left: calc(50% + 0.5px);">
            <div class="font-black leading-[0] not-italic opacity-90 relative shrink-0 text-[#232323] text-[22px] text-center w-full" style="font-family: 'ABC Ginto Normal Variable Unlicensed Trial', sans-serif;">
                <p class="block leading-[1.4]">Vincent van Gogh</p>
            </div>
            <div class="italic leading-[0] not-italic opacity-90 relative shrink-0 text-[#232323] text-[16px] text-left w-full" style="font-family: 'Avenir LT Std', sans-serif;">
                <p class="block leading-[1.45]">"I painted not what I saw, but what I felt in that night of madness."</p>
            </div>
            <div class="leading-[0] not-italic opacity-90 relative shrink-0 text-[#0051ae] text-[16px] text-left w-full" style="font-family: 'Avenir LT Std', sans-serif;">
                <p class="block leading-[1.6]">#LonelyGenius #PostImpressionist #NightOfTheMind</p>
            </div>
            <div class="box-border content-stretch flex flex-col gap-0.5 items-start justify-start leading-[0] not-italic p-0 relative shrink-0 text-[#232323] text-left w-full">
                <div class="font-bold opacity-90 relative shrink-0 text-[16px] w-full" style="font-family: 'Avenir LT Std', sans-serif;">
                    <p class="block leading-[1.6]">Identity</p>
                </div>
                <div class="opacity-90 relative shrink-0 text-[14px] w-full" style="font-family: 'Avenir LT Std', sans-serif;">
                    <p class="block leading-[1.6]">19th-century Dutch painter, creator of The Starry Night</p>
                </div>
            </div>
            <div class="box-border content-stretch flex flex-col gap-0.5 items-start justify-start leading-[0] not-italic p-0 relative shrink-0 text-[#232323] text-left w-full">
                <div class="font-bold opacity-90 relative shrink-0 text-[16px] w-full" style="font-family: 'Avenir LT Std', sans-serif;">
                    <p class="block leading-[1.6]">Artistic Traits</p>
                </div>
                <div class="opacity-90 relative shrink-0 text-[14px] w-full" style="font-family: 'Avenir LT Std', sans-serif;">
                    <p class="block leading-[1.6]">Frequently quoted from personal letters; deeply sensitive to the emotional power of color</p>
                </div>
            </div>
            <div class="box-border content-stretch flex flex-col gap-0.5 items-start justify-start leading-[0] not-italic p-0 relative shrink-0 text-[#232323] text-left w-full">
                <div class="font-bold opacity-90 relative shrink-0 text-[16px] w-full" style="font-family: 'Avenir LT Std', sans-serif;">
                    <p class="block leading-[1.6]">Perspective</p>
                </div>
                <div class="opacity-90 relative shrink-0 text-[14px] w-full" style="font-family: 'Avenir LT Std', sans-serif;">
                    <p class="block leading-[1.6]">Interprets the swirling sky, cypress trees, and dreamlike village through a lens of self-healing</p>
                </div>
            </div>
        </div>

        <!-- Home Indicator -->
        <div class="absolute box-border content-stretch flex flex-col items-center justify-start left-0 p-0 top-[826px] w-[393px]">
            <div class="h-[26px] relative shrink-0 w-[375px]">
                <div class="absolute bottom-2 flex h-[5px] items-center justify-center left-1/2 translate-x-[-50%] w-36">
                    <div class="bg-[#000000] h-[5px] rounded-[100px] w-36"></div>
                </div>
            </div>
        </div>
    </div>

    <!-- Page 17: Volume Settings -->
    <div id="page17" class="mobile-container absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 z-50 hidden" style="width: 393px; height: 852px;">
        <!-- Background with museum artwork -->
        <div class="absolute inset-0 bg-center bg-cover bg-no-repeat" style="background-image: url('./src/assets/2339a82e4b6020c219c18a48dca73ef3ba006ffe.png');"></div>
        
        <!-- Full screen overlay -->
        <div class="absolute inset-0 bg-black/30 backdrop-blur-sm"></div>
        
        <!-- Status bar V2 -->
        <div class="absolute box-border content-stretch flex flex-col items-start justify-start left-1/2 p-0 top-0 translate-x-[-50%] w-[393px] z-30">
            <div class="h-11 relative w-full">
                <div class="absolute h-[22px] left-[26px] top-[15px] w-[54px]">
                    <div class="absolute font-semibold leading-[0] left-0 not-italic right-0 text-[#ffffff] text-[17px] text-center" style="top: calc(50% - 11px); font-family: 'SF Pro Text', sans-serif;">
                        <p class="block leading-[22px]">12:15</p>
                    </div>
                </div>
                <div class="absolute h-[13px] right-[26.339px] top-[19.333px] w-[27.328px]">
                    <img alt="Battery" class="block max-w-none w-full h-full" src="./src/assets/c0c091687c62d7337bf318e17f3769ffc34d3a72.svg" />
                </div>
                <div class="absolute h-3 right-[61px] top-5 w-[17px]">
                    <img alt="Wifi" class="block max-w-none w-full h-full" src="./src/assets/94bdfe1a8077b65bf75e0473782ae3df50cd473f.svg" />
                </div>
                <div class="absolute h-3 right-[85.4px] top-5 w-[19.2px]">
                    <img alt="Cellular" class="block max-w-none w-full h-full" src="./src/assets/a883d1003c9c8d00c12b4d64e84ed02fcbbf9603.svg" />
                </div>
            </div>
        </div>

        <!-- Back Button -->
        <div id="page17BackButton" class="absolute left-[26px] size-[42px] top-[52px] cursor-pointer z-30">
            <img alt="Back" class="block max-w-none w-full h-full" src="./src/assets/40807933db102c5ddfe145202e96cb747d9662c5.svg" />
        </div>

        <!-- Volume Settings Modal -->
        <div class="absolute bg-[#fffaf4] h-[146px] rounded-[20px] top-1/2 translate-x-[-50%] translate-y-[-50%] w-[306px] z-40" style="left: calc(50% + 0.5px);">
            <!-- Close Icon -->
            <div id="page17CloseButton" class="absolute left-[9px] size-9 top-[9px] cursor-pointer">
                <img alt="Close" class="block max-w-none w-full h-full" src="./src/assets/d23e0c72b637adf4346f1d26038aa38e3d04555c.svg" />
            </div>
            
            <!-- Volume Settings Content -->
            <div class="absolute box-border content-stretch flex flex-col gap-3 items-start justify-start left-[29px] p-0 top-[67px] w-[248px]">
                <div class="box-border content-stretch flex flex-row items-center justify-between p-0 relative shrink-0 w-full">
                    <div class="font-medium leading-[0] not-italic opacity-90 relative shrink-0 text-[#232323] text-[15px] text-left text-nowrap" style="font-family: 'Avenir LT Std', sans-serif;">
                        <p class="block leading-[1.45] whitespace-pre">Background music volume</p>
                    </div>
                </div>
                <!-- Volume Slider -->
                <div class="h-4 relative shrink-0 w-[248px]">
                    <!-- Slider Track -->
                    <div class="absolute bg-[#d9d9d9] bottom-[37.5%] left-0 right-0 rounded-[10px] top-[37.5%]"></div>
                    <!-- Slider Progress -->
                    <div id="volumeProgress" class="absolute bg-[#fbbb5d] bottom-0 left-0 rounded-[10px] top-0 border border-[#a4720e] border-solid shadow-[0px_8px_2px_0px_rgba(0,0,0,0),0px_5px_2px_0px_rgba(0,0,0,0.01),0px_3px_2px_0px_rgba(0,0,0,0.05),0px_1px_1px_0px_rgba(0,0,0,0.09),0px_0px_1px_0px_rgba(0,0,0,0.1)]" style="width: 16px;"></div>
                    <!-- Slider Handle -->
                    <div id="volumeHandle" class="absolute w-4 h-4 bg-[#fbbb5d] border-2 border-[#a4720e] rounded-full cursor-grab active:cursor-grabbing shadow-md transform -translate-y-1/2" style="left: 8px; top: 50%;"></div>
                    <!-- Invisible clickable area for easier interaction -->
                    <div id="volumeSlider" class="absolute inset-0 cursor-pointer"></div>
                </div>
            </div>
        </div>

        <!-- Home Indicator -->
        <div class="absolute box-border content-stretch flex flex-col items-center justify-start left-0 p-0 top-[818px] w-[393px]">
            <div class="h-[34px] relative shrink-0 w-full">
                <div class="absolute bg-[#919191] bottom-[23.529%] left-[32.267%] right-[32%] rounded-[2.5px] top-[61.765%]"></div>
            </div>
        </div>
    </div>

    <script>
        let currentPage = 1;
        let startX = 0;
        let currentX = 0;
        let isSweping = false;

        // Add debug indicator
        function showDebugInfo(message) {
            // Check if we're currently on camera pages (8, 9, 10) or if any camera pages are visible
            const cameraPages = ['page8', 'page9', 'page10'];
            const isCameraPageActive = cameraPages.some(pageId => {
                const page = document.getElementById(pageId);
                return page && !page.classList.contains('hidden');
            });
            
            // Don't show debug info on camera pages per user request
            if (isCameraPageActive) {
                return;
            }
            
            let debugDiv = document.getElementById('debug-info');
            if (!debugDiv) {
                debugDiv = document.createElement('div');
                debugDiv.id = 'debug-info';
                debugDiv.style.cssText = 'position: fixed; top: 10px; right: 10px; background: rgba(0,0,0,0.8); color: white; padding: 10px; border-radius: 5px; z-index: 1000; font-size: 12px; max-width: 200px;';
                document.body.appendChild(debugDiv);
            }
            debugDiv.innerHTML = `
                <div>Page: ${currentPage}/7</div>
                <div>${message}</div>
                <div style="margin-top: 5px; font-size: 10px;">
                    • Page 3: Swipe right → Page 4 / Settings ⚙️ / Upload 📷<br>
                    • Page 4: Swipe left ← Page 3 / Settings ⚙️<br>
                    • Settings: Back button ← / Random → Char Prefs<br>
                    • Character Prefs: Click to toggle / Back ←<br>
                    • Upload: Choose Album / Camera / Cancel<br>
                    • Camera: White dot 📸 to capture / Back ←<br>
                    • Desktop: Arrow keys, 5=Settings, 7=Upload, 8=Camera, 9=Capture, Esc=Close<br>
                    • Navigation: SWIPE ONLY between pages 3-4!
                </div>
            `;
        }

        function showPage(pageNumber) {
            console.log(`🔄 showPage called: switching to page ${pageNumber} from page ${currentPage}`);
            
            // Add stack trace to see what called this function
            console.trace('showPage call stack:');
            
            // Hide all main pages
            document.getElementById('page1').classList.remove('page-active');
            document.getElementById('page1').classList.add('page-hidden');
            document.getElementById('page2').classList.remove('page-active');
            document.getElementById('page2').classList.add('page-hidden');
            document.getElementById('page3').classList.remove('page-active');
            document.getElementById('page3').classList.add('page-hidden');
            document.getElementById('page4').classList.remove('page-active');
            document.getElementById('page4').classList.add('page-hidden');
            document.getElementById('page5').classList.remove('page-active');
            document.getElementById('page5').classList.add('page-hidden');

            // Hide modal pages
            const characterModal = document.getElementById('page6');
            if (characterModal && !characterModal.classList.contains('hidden')) {
                characterModal.classList.add('hidden');
                characterModal.classList.remove('show');
            }
            
            const uploadModal = document.getElementById('page7');
            if (uploadModal && !uploadModal.classList.contains('hidden')) {
                uploadModal.classList.add('hidden');
                uploadModal.classList.remove('show');
            }

            // Hide live room and related pages
            const liveRoom = document.getElementById('page13');
            if (liveRoom && !liveRoom.classList.contains('hidden')) {
                // Only hide live room if not going to related overlay pages
                if (pageNumber !== 15 && pageNumber !== 17) {
                    liveRoom.classList.add('hidden');
                    liveRoom.classList.remove('show');
                    // Stop live animations and clean up barrage intervals when completely leaving live room
                    clearBarrageIntervals();
                    stopLiveRoomAnimations();
                } else {
                    // Keep live room visible but in background for overlay pages
                    liveRoom.style.zIndex = '10';
                }
            }
            
            // Hide character detail pages
            const page15 = document.getElementById('page15');
            if (page15 && !page15.classList.contains('hidden')) {
                page15.classList.add('hidden');
                page15.classList.remove('show');
            }
            
            const page16 = document.getElementById('page16');
            if (page16 && !page16.classList.contains('hidden')) {
                page16.classList.add('hidden');
                page16.classList.remove('show');
            }
            
            const page17 = document.getElementById('page17');
            if (page17 && !page17.classList.contains('hidden')) {
                page17.classList.add('hidden');
                page17.classList.remove('show');
            }

            // Show target page
            if (pageNumber <= 5) {
                console.log(`📄 Showing page${pageNumber} element`);
                const targetPage = document.getElementById('page' + pageNumber);
                if (targetPage) {
                    targetPage.classList.remove('page-hidden');
                    targetPage.classList.add('page-active');
                    console.log(`✅ Successfully showed page ${pageNumber}`);
                } else {
                    console.error(`❌ Could not find page${pageNumber} element!`);
                }
            } else if (pageNumber === 13) {
                // Show live room
                const liveRoom = document.getElementById('page13');
                if (liveRoom) {
                    liveRoom.classList.remove('hidden');
                    liveRoom.classList.add('show');
                    liveRoom.style.zIndex = '50';
                    startLiveRoomAnimations();
                    console.log(`✅ Successfully showed live room (page 13)`);
                }
            } else if (pageNumber === 15) {
                // Show character intro page as overlay
                const page15 = document.getElementById('page15');
                if (page15) {
                    page15.classList.remove('hidden');
                    page15.classList.add('show');
                    page15.style.zIndex = '60'; // Above live room
                    // Ensure live room stays visible in background
                    const liveRoom = document.getElementById('page13');
                    if (liveRoom) {
                        liveRoom.classList.remove('hidden');
                        liveRoom.classList.add('show');
                        liveRoom.style.zIndex = '50';
                    }
                    console.log(`✅ Successfully showed character intro (page 15)`);
                }
            } else if (pageNumber === 16) {
                // Show expanded character page
                const page16 = document.getElementById('page16');
                if (page16) {
                    page16.classList.remove('hidden');
                    page16.classList.add('show');
                    page16.style.zIndex = '60';
                    console.log(`✅ Successfully showed expanded character (page 16)`);
                }
            } else if (pageNumber === 17) {
                // Show volume settings page as overlay
                const page17 = document.getElementById('page17');
                if (page17) {
                    page17.classList.remove('hidden');
                    page17.classList.add('show');
                    page17.style.zIndex = '60'; // Above live room
                    // Ensure live room stays visible in background
                    const liveRoom = document.getElementById('page13');
                    if (liveRoom) {
                        liveRoom.classList.remove('hidden');
                        liveRoom.classList.add('show');
                        liveRoom.style.zIndex = '50';
                    }
                    console.log(`✅ Successfully showed volume settings (page 17)`);
                }
            }
            
            currentPage = pageNumber;
            
            // Update debug info
            showDebugInfo(`Showing page ${pageNumber}`);
        }

        function startOpeningSequence() {
            console.log('🚀 Starting opening sequence...');
            // Start with page 1
            showPage(1);

            // After 200ms, transition to page 2
            setTimeout(() => {
                console.log('📱 Moving to page 2...');
                showPage(2);
                
                // After another 1000ms, transition to page 3 (final opening page)
                setTimeout(() => {
                    console.log('🎯 Moving to page 3 (Opening page) - Ready for interaction!');
                    showPage(3);
                    showDebugInfo('Ready! You can now click the settings gear ⚙️');
                }, 1000);
            }, 200);
        }

        function handleUpload() {
            console.log('📤 handleUpload function called, currentPage:', currentPage);
            
            // Add debugging for page state
            const page3 = document.getElementById('page3');
            const page3Classes = page3.classList.toString();
            console.log('Page 3 classes:', page3Classes);
            console.log('Page 3 visible?', page3.classList.contains('page-active'));
            
            if (currentPage !== 3) {
                console.log('❌ Upload not allowed on page', currentPage);
                showDebugInfo(`Upload blocked - currently on page ${currentPage}`);
                return; // Only allow upload on opening page
            }
            
            console.log('✅ Upload button clicked - navigating to page 7');
            // Hide current page and show Page 7 (image upload modal) centered
            document.getElementById('page3').classList.remove('page-active');
            document.getElementById('page3').classList.add('page-hidden');
            
            const modal = document.getElementById('page7');
            if (modal) {
                modal.classList.remove('hidden');
                modal.classList.add('show');
                console.log('📄 Successfully showed page 7 upload modal centered');
                showDebugInfo(`Navigated to image upload page (Page 7)! 📷`);
            } else {
                console.error('❌ Could not find page7 element!');
                showDebugInfo(`Error: Could not find upload page`);
            }
        }

        function handleSettings() {
            console.log('🔧 handleSettings function called, currentPage:', currentPage);
            
            // Show Page 5 (Settings modal)
            const page5 = document.getElementById('page5');
            if (page5) {
                page5.classList.remove('hidden');
                page5.classList.add('show');
                console.log('✅ Successfully opened Settings page (Page 5)');
                
                // Add click handler to close modal when clicking outside
                setTimeout(() => {
                    const modalBackground = page5.querySelector('.absolute.inset-0.bg-\\[rgba\\(0\\,0\\,0\\,0\\.3\\)\\]');
                    if (modalBackground) {
                        modalBackground.addEventListener('click', handleBackFromSettings);
                    }
                }, 100);
            } else {
                console.error('❌ Could not find page5 element!');
            }
        }

        // Make functions available globally
        window.handleUpload = handleUpload;
        window.handleSettings = handleSettings;

        function handleBackFromSettings() {
            console.log('handleBackFromSettings called');
            // Hide Page 5 (Settings modal)
            const page5 = document.getElementById('page5');
            if (page5) {
                page5.classList.add('hidden');
                page5.classList.remove('show');
                console.log('✅ Successfully closed Settings page (Page 5)');
            }
        }

        // Make back function globally available
        window.handleBackFromSettings = handleBackFromSettings;

        function handleLanguageChange() {
            console.log('Language button clicked');
            const languageToggle = document.getElementById('languageToggle');
            if (languageToggle) {
                const currentText = languageToggle.querySelector('p').textContent;
                const newText = currentText === 'English' ? '中文' : 'English';
                languageToggle.querySelector('p').textContent = newText;
                
                // Store language preference
                localStorage.setItem('selectedLanguage', newText);
                
                showDebugInfo(`Language changed to: ${newText}`);
                console.log('Language changed to:', newText);
            }
        }

        function selectCharacter(characterType) {
            console.log('Character selected:', characterType);
            
            // If it's a random character, show character preferences modal
            if (characterType.includes('random')) {
                showCharacterPreferences();
                showDebugInfo(`Opening character preferences for ${characterType}`);
            } else {
                showDebugInfo(`Selected character: ${characterType}`);
            }
        }

        function showCharacterPreferences() {
            console.log('showCharacterPreferences called');
            // Show Page 6 (Character Preferences modal)
            const page6 = document.getElementById('page6');
            if (page6) {
                page6.classList.remove('hidden');
                page6.classList.add('show');
                console.log('✅ Successfully opened Character Preferences page (Page 6)');
            } else {
                console.error('❌ Could not find page6 element!');
            }
        }

        function handleBackFromCharacterPreferences() {
            console.log('handleBackFromCharacterPreferences called');
            // Hide Page 6 (Character Preferences modal)
            const page6 = document.getElementById('page6');
            if (page6) {
                page6.classList.add('hidden');
                page6.classList.remove('show');
                console.log('✅ Successfully closed Character Preferences page (Page 6)');
            }
        }

        function toggleCharacterPreference(button) {
            console.log('toggleCharacterPreference called');
            const character = button.dataset.character;
            const currentState = button.dataset.state;
            const newState = currentState === 'persistent' ? 'non-persistent' : 'persistent';
            
            // Update button state
            button.dataset.state = newState;
            
            // Update button text and styling
            const textElement = button.querySelector('p');
            if (newState === 'persistent') {
                textElement.textContent = 'Persistent';
                button.classList.remove('non-persistent');
                button.classList.add('persistent');
            } else {
                textElement.textContent = 'Non-Persistent';
                button.classList.remove('persistent');
                button.classList.add('non-persistent');
            }
            
            showDebugInfo(`${character}: ${currentState} → ${newState}`);
            console.log(`Character ${character} preference changed from ${currentState} to ${newState}`);
        }

        function showImageUploadModal() {
            console.log('📤 showImageUploadModal called');
            const modal = document.getElementById('page7');
            
            if (!modal) {
                console.error('❌ Could not find page7 modal element!');
                return;
            }
            
            console.log('📄 Modal element found, showing upload modal');
            modal.classList.remove('hidden');
            modal.classList.add('show');
            console.log('✅ Upload modal classes updated');
            showDebugInfo(`Image upload options opened`);
        }

        function handleChooseFromAlbum() {
            console.log('Choose from Album clicked');
            
            // Create file input and trigger file browser
            const input = document.createElement('input');
            input.type = 'file';
            input.accept = 'image/*';
            input.onchange = (e) => {
                const file = e.target.files[0];
                if (file) {
                    // Validate file type
                    const validTypes = ['image/jpeg', 'image/jpg', 'image/png', 'image/gif', 'image/webp'];
                    if (!validTypes.includes(file.type)) {
                        showDebugInfo('⚠️ Please select a valid image file (JPG, PNG, GIF, WebP)');
                        return;
                    }
                    
                    // Validate file size (max 10MB)
                    const maxSize = 10 * 1024 * 1024; // 10MB in bytes
                    if (file.size > maxSize) {
                        showDebugInfo('⚠️ Image file too large. Please select an image smaller than 10MB');
                        return;
                    }
                    
                    console.log('Selected file:', file.name, 'Size:', (file.size / 1024 / 1024).toFixed(2), 'MB');
                    showDebugInfo(`File selected: ${file.name} (${(file.size / 1024 / 1024).toFixed(2)}MB)`);
                    
                    // Close the upload modal
                    handleCancelUpload();
                    
                    // Automatically redirect to Page 11 (loading screen) then to Page 4
                    handleFileUploadFlow(file);
                }
            };
            input.click();
        }

        function handleFileUploadFlow(file) {
            console.log('🚀 Starting file upload flow for:', file.name);
            
            // Store the uploaded file for potential later use
            uploadedFile = file;
            
            // Create a preview URL for the uploaded image (optional for future use)
            if (file) {
                const reader = new FileReader();
                reader.onload = (e) => {
                    uploadedImagePreview = e.target.result;
                    console.log('✅ Image preview generated for:', file.name);
                };
                reader.readAsDataURL(file);
            }
            
            // Clean up camera resources if coming from camera page
            const cameraPage = document.getElementById('page8');
            if (cameraPage && !cameraPage.classList.contains('hidden')) {
                console.log('🧹 Cleaning up camera resources before file upload flow');
                stopCamera();
                cleanupCameraElements();
                cameraPage.classList.add('hidden');
                cameraPage.classList.remove('show');
            }
            
            // Ensure all other pages are hidden
            const allPages = ['page3', 'page4', 'page7', 'page8', 'page9', 'page10'];
            console.log('🧹 Hiding all pages:', allPages);
            allPages.forEach(pageId => {
                const page = document.getElementById(pageId);
                if (page) {
                    page.classList.remove('page-active', 'show');
                    page.classList.add('page-hidden', 'hidden');
                    console.log(`  - Hidden ${pageId}`);
                }
            });
            
            // Show Page 11 (loading screen) immediately
            console.log('📋 Attempting to show Page 11...');
            const galleryPage = document.getElementById('page11');
            if (galleryPage) {
                galleryPage.classList.remove('hidden');
                galleryPage.classList.add('show');
                
                // Start the gallery loading spinner
                const gallerySpinner = document.getElementById('gallerySpinner');
                if (gallerySpinner) {
                    gallerySpinner.style.animation = 'spin 1s linear infinite';
                    console.log('🌀 Gallery spinner started');
                }
                
                console.log('✅ Page 11 (Gallery Loading) shown successfully');
                showDebugInfo(`Processing uploaded image: ${file.name} 📸`);
            } else {
                console.error('❌ Could not find Page 11 element!');
            }
            
            // Simulate processing time (2-3 seconds) then redirect to Page 4
            setTimeout(() => {
                console.log('⏰ Timeout completed, transitioning to Page 4...');
                
                // Hide Page 11
                if (galleryPage) {
                    galleryPage.classList.add('hidden');
                    galleryPage.classList.remove('show');
                    console.log('✅ Page 11 hidden');
                }
                
                // Ensure all pages are properly hidden first
                document.querySelectorAll('[id^="page"]').forEach(page => {
                    if (page.id !== 'page4') {
                        page.classList.remove('page-active', 'show');
                        page.classList.add('page-hidden', 'hidden');
                    }
                });
                
                // Show Page 4 (Detail View) with proper classes
                const page4 = document.getElementById('page4');
                if (page4) {
                    // Remove all hiding classes
                    page4.classList.remove('page-hidden', 'hidden');
                    // Add showing classes  
                    page4.classList.add('page-active');
                    // Force visibility with inline styles as backup
                    page4.style.opacity = '1';
                    page4.style.visibility = 'visible';
                    page4.style.display = 'block';
                    page4.style.zIndex = '10';
                    
                    console.log('✅ Page 4 classes:', page4.className);
                    console.log('✅ Page 4 computed style opacity:', window.getComputedStyle(page4).opacity);
                    console.log('✅ Page 4 computed style visibility:', window.getComputedStyle(page4).visibility);
                    
                    // Double check that it's actually visible
                    setTimeout(() => {
                        const isVisible = page4.offsetWidth > 0 && page4.offsetHeight > 0;
                        console.log('✅ Page 4 is actually visible:', isVisible);
                        if (!isVisible) {
                            console.error('❌ Page 4 is still not visible! Checking all elements...');
                            console.error('Page 4 dimensions:', page4.offsetWidth, 'x', page4.offsetHeight);
                        }
                    }, 100);
                } else {
                    console.error('❌ Could not find Page 4 element!');
                }
                
                currentPage = 4;
                
                console.log('📄 Successfully transitioned to Page 4 (Detail View)');
                showDebugInfo(`Image uploaded successfully! Now viewing detail page 🎉`);
                
            }, 2500); // 2.5 seconds loading time
        }

        // Camera functionality variables
        let stream = null;
        let capturedPhoto = null;
        let currentFacingMode = 'environment'; // 'environment' for back camera, 'user' for front camera
        
        // File upload variables
        let uploadedFile = null;
        let uploadedImagePreview = null;

        async function handleCamera() {
            console.log('Camera clicked');
            
            // Hide Page 7 modal and show Page 8 (Camera)
            const modal = document.getElementById('page7');
            if (modal) {
                modal.classList.add('hidden');
                modal.classList.remove('show');
            }
            
            // Show Page 8 (Camera) and start camera
            const cameraPage = document.getElementById('page8');
            if (cameraPage) {
                cameraPage.classList.remove('hidden');
                cameraPage.classList.add('show');
                console.log('📷 Successfully showed Page 8 (Camera)');
                // Opened Camera page - debug info removed per user request
                
                // Initialize camera
                await initializeCamera();
            }
        }

        async function initializeCamera() {
            // Show loading indicator and initializing text
            showCameraLoading(true);
            showInitializingText(true);
            
            try {
                // Request camera permission and access
                const constraints = {
                    video: {
                        facingMode: currentFacingMode,
                        width: { ideal: 393 },
                        height: { ideal: 852 }
                    }
                };

                stream = await navigator.mediaDevices.getUserMedia(constraints);
                
                // Get the video element or create one if it doesn't exist
                let videoElement = document.getElementById('cameraVideo');
                if (!videoElement) {
                    videoElement = document.createElement('video');
                    videoElement.id = 'cameraVideo';
                    videoElement.autoplay = true;
                    videoElement.playsInline = true;
                    videoElement.muted = true;
                    videoElement.style.cssText = `
                        position: absolute;
                        top: 0;
                        left: 0;
                        width: 100%;
                        height: 100%;
                        object-fit: cover;
                        z-index: 5;
                        opacity: 0;
                        transition: opacity 0.5s ease-in-out;
                    `;
                    
                    // Insert video into page 8 background (the solid color background)
                    const page8Background = document.querySelector('#page8 .bg-\\[\\#1a1a1a\\]');
                    if (page8Background) {
                        page8Background.appendChild(videoElement);
                    }
                }
                
                videoElement.srcObject = stream;
                
                // Hide loading indicator and initializing text, fade in video when it starts playing
                videoElement.onloadedmetadata = () => {
                    showCameraLoading(false);
                    showInitializingText(false);
                    // Smooth transition from solid color to camera feed
                    setTimeout(() => {
                        videoElement.style.opacity = '1';
                    }, 100);
                    console.log('📷 Camera initialized successfully');
                    // Camera is now active - removed debug info per user request
                };
                
            } catch (error) {
                showCameraLoading(false);
                showInitializingText(false);
                console.error('Camera initialization failed:', error);
                
                let errorMessage = 'Camera access denied or unavailable 📵';
                
                if (error.name === 'NotAllowedError') {
                    errorMessage = 'Camera permission denied. Please allow camera access. 📵';
                } else if (error.name === 'NotFoundError') {
                    errorMessage = 'No camera found on this device 📵';
                } else if (error.name === 'NotReadableError') {
                    errorMessage = 'Camera is being used by another app 📵';
                }
                
                // showDebugInfo(errorMessage); // Removed debug info per user request
                
                // Show error state with dark background instead of camera feed
                const page8Background = document.querySelector('#page8 .bg-\\[\\#1a1a1a\\]');
                if (page8Background && !document.getElementById('cameraErrorOverlay')) {
                    const errorOverlay = document.createElement('div');
                    errorOverlay.id = 'cameraErrorOverlay';
                    errorOverlay.innerHTML = `
                        <div style="
                            position: absolute;
                            top: 50%;
                            left: 50%;
                            transform: translate(-50%, -50%);
                            color: rgba(255, 255, 255, 0.7);
                            text-align: center;
                            z-index: 10;
                        ">
                            <div style="font-size: 48px; margin-bottom: 16px;">📵</div>
                            <div style="font-size: 16px;">${errorMessage}</div>
                        </div>
                    `;
                    page8Background.appendChild(errorOverlay);
                }
            }
        }

        function showCameraLoading(show) {
            let loadingElement = document.getElementById('cameraLoading');
            
            if (show) {
                if (!loadingElement) {
                    loadingElement = document.createElement('div');
                    loadingElement.id = 'cameraLoading';
                    loadingElement.innerHTML = ``;
                    
                    // Insert into the new background structure
                    const page8Background = document.querySelector('#page8 .bg-\\[\\#1a1a1a\\]');
                    if (page8Background) {
                        page8Background.appendChild(loadingElement);
                    }
                }
                loadingElement.style.display = 'block';
            } else {
                if (loadingElement) {
                    loadingElement.style.display = 'none';
                }
            }
        }

        function showInitializingText(show) {
            const initializingText = document.getElementById('initializingText');
            if (initializingText) {
                if (show) {
                    initializingText.classList.remove('hidden');
                } else {
                    initializingText.classList.add('hidden');
                }
            }
        }

        async function switchCamera() {
            console.log('Switching camera...');
            // Switching camera - debug info removed per user request
            
            // Toggle facing mode
            currentFacingMode = currentFacingMode === 'environment' ? 'user' : 'environment';
            
            // Fade out current video
            const videoElement = document.getElementById('cameraVideo');
            if (videoElement) {
                videoElement.style.opacity = '0';
                // Remove after fade out
                setTimeout(() => {
                    videoElement.remove();
                }, 300);
            }
            
            // Stop current stream
            if (stream) {
                stream.getTracks().forEach(track => track.stop());
            }
            
            // Show brief loading state during switch
            setTimeout(async () => {
                await initializeCamera();
                // Switched camera - debug info removed per user request
            }, 300);
        }

        function stopCamera() {
            if (stream) {
                stream.getTracks().forEach(track => track.stop());
                stream = null;
                console.log('📷 Camera stopped');
            }
            
            const videoElement = document.getElementById('cameraVideo');
            if (videoElement) {
                videoElement.remove();
            }
            
            // Hide loading indicator
            showCameraLoading(false);
        }

        function handleBackFromCamera() {
            console.log('Back from camera clicked');
            
            // Stop camera stream and clean up
            stopCamera();
            
            // Clean up any captured photo backgrounds
            cleanupCameraElements();
            
            // Hide Page 8 and return to Page 7
            const cameraPage = document.getElementById('page8');
            if (cameraPage) {
                cameraPage.classList.add('hidden');
                cameraPage.classList.remove('show');
            }
            
            // Show Page 7 (Upload modal) again
            const modal = document.getElementById('page7');
            if (modal) {
                modal.classList.remove('hidden');
                modal.classList.add('show');
                console.log('📄 Successfully returned to Page 7 (Upload modal)');
                // showDebugInfo(`Returned to upload page from camera`); // Removed debug info per user request
            }
        }

        function cleanupCameraElements() {
            // Remove captured photo backgrounds from all pages
            const capturedPhotoBg = document.getElementById('capturedPhotoBackground');
            if (capturedPhotoBg) {
                capturedPhotoBg.remove();
            }
            
            const capturedPhotoBgPage10 = document.getElementById('capturedPhotoBackgroundPage10');
            if (capturedPhotoBgPage10) {
                capturedPhotoBgPage10.remove();
            }
            
            // Remove error overlay if it exists
            const errorOverlay = document.getElementById('cameraErrorOverlay');
            if (errorOverlay) {
                errorOverlay.remove();
            }
            
            // Remove loading indicator
            const loadingElement = document.getElementById('cameraLoading');
            if (loadingElement) {
                loadingElement.remove();
            }
            
            // Clear captured photo data
            capturedPhoto = null;
        }

        async function handleCameraCapture() {
            console.log('Camera capture clicked - taking photo!');
            
            // Capture photo from video stream
            await capturePhotoFromStream();
            
            // Hide Page 8 and show Page 9 with animation
            const cameraPage = document.getElementById('page8');
            if (cameraPage) {
                cameraPage.classList.add('hidden');
                cameraPage.classList.remove('show');
            }
            
            // Show Page 9 (Taking picture) with captured photo
            const takingPicturePage = document.getElementById('page9');
            if (takingPicturePage) {
                takingPicturePage.classList.remove('hidden');
                takingPicturePage.classList.add('show');
                
                // Set captured photo as background for page 9
                await setupPage9WithCapturedPhoto();
                
                // Add flash effect
                const flashEffect = document.getElementById('flashEffect');
                if (flashEffect) {
                    flashEffect.style.opacity = '0.8';
                    setTimeout(() => {
                        flashEffect.style.opacity = '0';
                    }, 150);
                }
                
                // Add spinner rotation animation
                const spinner = document.getElementById('loadingSpinner');
                if (spinner) {
                    spinner.style.animation = 'spin 1s linear infinite';
                }
                
                console.log('📸 Photo capture initiated - showing Page 9');
                // showDebugInfo(`Taking picture... 📸`); // Removed debug info per user request
                
                // After 2 seconds, navigate to next page or back to main
                setTimeout(() => {
                    console.log('📸 Photo capture complete!');
                    handlePhotoComplete();
                }, 2000);
            }
        }

        async function capturePhotoFromStream() {
            if (!stream) {
                console.warn('No camera stream available for capture');
                return;
            }

            try {
                const videoElement = document.getElementById('cameraVideo');
                if (!videoElement) {
                    console.warn('No video element found for capture');
                    return;
                }

                // Create canvas to capture the current frame
                const canvas = document.createElement('canvas');
                canvas.width = videoElement.videoWidth || 393;
                canvas.height = videoElement.videoHeight || 852;
                
                const ctx = canvas.getContext('2d');
                ctx.drawImage(videoElement, 0, 0, canvas.width, canvas.height);
                
                // Convert to blob/data URL
                capturedPhoto = canvas.toDataURL('image/jpeg', 0.8);
                
                console.log('📸 Photo captured successfully');
                
            } catch (error) {
                console.error('Failed to capture photo:', error);
            }
        }

        async function setupPage9WithCapturedPhoto() {
            if (!capturedPhoto) {
                console.warn('No captured photo available');
                return;
            }

            // Create or update the captured photo background in page 9
            let photoElement = document.getElementById('capturedPhotoBackground');
            if (!photoElement) {
                photoElement = document.createElement('div');
                photoElement.id = 'capturedPhotoBackground';
                photoElement.style.cssText = `
                    position: absolute;
                    top: 0;
                    left: 0;
                    width: 100%;
                    height: 100%;
                    background-size: cover;
                    background-position: center;
                    background-repeat: no-repeat;
                    z-index: 1;
                `;
                
                // Insert into page 9 background
                const page9Background = document.querySelector('#page9 .bg-\\[\\#221400\\]');
                if (page9Background) {
                    // Insert before the camera overlay
                    const cameraOverlay = page9Background.querySelector('.bg-\\[\\#221400\\].overflow-hidden');
                    if (cameraOverlay) {
                        page9Background.insertBefore(photoElement, cameraOverlay);
                    } else {
                        page9Background.appendChild(photoElement);
                    }
                }
            }
            
            photoElement.style.backgroundImage = `url(${capturedPhoto})`;
        }

        function setupPage10WithCapturedPhoto() {
            if (!capturedPhoto) {
                console.warn('No captured photo available for page 10');
                return;
            }

            // Create or update the captured photo background in page 10
            let photoElement = document.getElementById('capturedPhotoBackgroundPage10');
            if (!photoElement) {
                photoElement = document.createElement('div');
                photoElement.id = 'capturedPhotoBackgroundPage10';
                photoElement.style.cssText = `
                    position: absolute;
                    top: 0;
                    left: 0;
                    width: 100%;
                    height: 100%;
                    background-size: cover;
                    background-position: center;
                    background-repeat: no-repeat;
                    z-index: 1;
                `;
                
                // Insert into page 10 background
                const page10Background = document.querySelector('#page10 .bg-\\[\\#221400\\]');
                if (page10Background) {
                    // Insert before the existing background image
                    const existingBackground = page10Background.querySelector('[style*="background-image"]');
                    if (existingBackground) {
                        page10Background.insertBefore(photoElement, existingBackground);
                    } else {
                        page10Background.appendChild(photoElement);
                    }
                }
            }
            
            photoElement.style.backgroundImage = `url(${capturedPhoto})`;
            console.log('📸 Page 10 set up with captured photo');
        }

        function handlePhotoComplete() {
            console.log('Photo capture completed - starting animation sequence');
            
            // Start the animation sequence: Page 9 -> Page 10 -> Page 11 -> Page 4
            // Page 9 stays visible for a moment, then transitions
            
            // After 400ms, show Page 10 (Analyzing picture) - increased delay for better pacing
            setTimeout(() => {
                // Hide Page 9
                const takingPicturePage = document.getElementById('page9');
                if (takingPicturePage) {
                    takingPicturePage.classList.add('hidden');
                    takingPicturePage.classList.remove('show');
                }
                
                // Show Page 10
                const analyzingPage = document.getElementById('page10');
                if (analyzingPage) {
                    analyzingPage.classList.remove('hidden');
                    analyzingPage.classList.add('show');
                    
                    // Set up page 10 with captured photo
                    setupPage10WithCapturedPhoto();
                }
                
                // showDebugInfo(`Analysis phase - analyzing picture... 🔍`); // Removed debug info per user request
                
                // After another 400ms, show Page 11 (Preparing Gallery) - increased delay
                setTimeout(() => {
                    // Hide Page 10
                    if (analyzingPage) {
                        analyzingPage.classList.add('hidden');
                        analyzingPage.classList.remove('show');
                    }
                    
                    // Show Page 11
                    const galleryPage = document.getElementById('page11');
                    if (galleryPage) {
                        galleryPage.classList.remove('hidden');
                        galleryPage.classList.add('show');
                    }
                    
                    // showDebugInfo(`Gallery phase - preparing gallery... 📸`); // Removed debug info per user request
                    
                    // After another 400ms, go to Page 4 (Detail View) - increased delay
                    setTimeout(() => {
                        // Hide Page 11
                        if (galleryPage) {
                            galleryPage.classList.add('hidden');
                            galleryPage.classList.remove('show');
                        }
                        
                        // Show Page 4 (Detail View)
                        document.getElementById('page4').classList.remove('page-hidden');
                        document.getElementById('page4').classList.add('page-active');
                        currentPage = 4;
                        
                        // showDebugInfo(`Animation complete! Now viewing detail page 🎉`); // Removed debug info per user request
                    }, 400);
                    
                }, 400);
                
            }, 400);
        }

        function handleCancelUpload() {
            console.log('handleCancelUpload called');
            
            // Hide Page 7 modal and return to Page 3
            const modal = document.getElementById('page7');
            if (modal) {
                modal.classList.add('hidden');
                modal.classList.remove('show');
            }
            
            // Show Page 3 again
            document.getElementById('page3').classList.remove('page-hidden');
            document.getElementById('page3').classList.add('page-active');
            currentPage = 3;
            
            showDebugInfo(`Cancelled upload - returned to page 3`);
        }

        // Live Room Functions
        function showLiveRoom() {
            console.log('🎭 Opening enhanced live room...');
            
            // Hide current page (Page 4)
            document.getElementById('page4').classList.remove('page-active');
            document.getElementById('page4').classList.add('page-hidden');
            
            // Show Page 13 (Live Room)
            const liveRoomPage = document.getElementById('page13');
            if (liveRoomPage) {
                liveRoomPage.classList.remove('hidden');
                liveRoomPage.classList.add('show');
            }
            
            currentPage = 13;
            showDebugInfo('Entered enhanced live broadcast room 🎭');
            
            // Initialize enhanced barrage system
            setTimeout(() => {
                initializeImprovedBarrage();
                startBarrageMonitoring();
            }, 100);
            
            // Start live room animations
            startLiveRoomAnimations();
        }

        function hideLiveRoom() {
            console.log('🔙 Exiting live room...');
            
            // Clean up barrage intervals when leaving Page 13
            clearBarrageIntervals();
            
            // Hide Page 13
            const liveRoomPage = document.getElementById('page13');
            if (liveRoomPage) {
                liveRoomPage.classList.add('hidden');
                liveRoomPage.classList.remove('show');
            }
            
            // Show Page 3 (main page)
            document.getElementById('page3').classList.remove('page-hidden');
            document.getElementById('page3').classList.add('page-active');
            currentPage = 3;
            
            showDebugInfo('Returned to main page from live room');
            
            // Stop live room animations
            stopLiveRoomAnimations();
        }

        // Live Room Animation System
        let emojiAnimationInterval;
        let chatAnimationInterval;
        let emojiTypes = [
            './src/assets/e1da4bf3a87f8d2850071fcbf61284251623f44b.png', // smiling face with hearts
            './src/assets/cebe50ea4c5d9b448454b19dd79074e5c5b4d898.png', // clapping hands
            './src/assets/b9a9f2c45090ee70d6300c9e71493fd74cb39ca9.png', // partying face
            './src/assets/b7bdd4e332f1134cea6b347137499723925005ef.png', // thumbs up
            './src/assets/59520d231a783bb20cd3d4f98dfaec2de858b210.png', // red heart
            './src/assets/cfeb233a63b04fed9f64dfbb76a4cb65cc4653ca.png'  // smiling face with heart-eyes
        ];

        let chatMessages = [
            { user: './src/assets/d4d2ca48cd435cf039ebac7d781a1bb460198b85.png', text: 'Amazing artwork! 😍' },
            { user: './src/assets/e3ade9aa46c847d649f3684414fe999679b41c1d.png', text: 'The details are incredible!' },
            { user: './src/assets/d4d2ca48cd435cf039ebac7d781a1bb460198b85.png', text: 'I love the historical context' },
            { user: './src/assets/e3ade9aa46c847d649f3684414fe999679b41c1d.png', text: 'This cat looks so royal! 👑' },
            { user: './src/assets/d4d2ca48cd435cf039ebac7d781a1bb460198b85.png', text: 'Museum quality for sure' },
            { user: './src/assets/e3ade9aa46c847d649f3684414fe999679b41c1d.png', text: 'Can you zoom in on the frame?' }
        ];

        function startLiveRoomAnimations() {
            console.log('🎭 Starting live room animations...');
            
            // Initialize improved barrage system
            initializeImprovedBarrage();
            
            // Start enhanced emoji floating animation with increased frequency
            emojiAnimationInterval = setInterval(() => {
                createFloatingEmoji();
            }, 800); // Reduced from 1500ms to 800ms for higher frequency

            // Start chat message animation
            chatAnimationInterval = setInterval(() => {
                addNewChatMessage();
            }, 3000);
            
            showDebugInfo('Live room animations active - barrage scrolling smoothly');
        }

        function stopLiveRoomAnimations() {
            if (emojiAnimationInterval) {
                clearInterval(emojiAnimationInterval);
                emojiAnimationInterval = null;
            }
            if (chatAnimationInterval) {
                clearInterval(chatAnimationInterval);
                chatAnimationInterval = null;
            }
        }

        function createFloatingEmoji() {
            const emojiContainer = document.getElementById('emojiContainer');
            if (!emojiContainer) return;

            const emoji = document.createElement('div');
            emoji.className = 'enhanced-floating-emoji absolute';
            
            // Random emoji type
            const emojiSrc = emojiTypes[Math.floor(Math.random() * emojiTypes.length)];
            
            // Random position within the emoji area with more variation
            const leftPos = Math.random() * 40; // 0-40px within the 61px width
            const rotation = Math.random() * 60 - 30; // -30 to +30 degrees for more dynamic rotation
            const scale = 0.8 + Math.random() * 0.4; // Random scale between 0.8 and 1.2
            
            emoji.style.left = leftPos + 'px';
            emoji.style.bottom = '0px';
            emoji.style.transform = `rotate(${rotation}deg) scale(${scale})`;
            emoji.innerHTML = `
                <div class="w-8 h-8 bg-center bg-cover bg-no-repeat" 
                     style="background-image: url('${emojiSrc}');">
                </div>
            `;
            
            emojiContainer.appendChild(emoji);
            
            // Remove emoji after animation completes
            setTimeout(() => {
                if (emoji.parentNode) {
                    emoji.parentNode.removeChild(emoji);
                }
            }, 3000);

            // Sometimes create multiple emojis at once for burst effect
            if (Math.random() < 0.3) { // 30% chance for burst
                setTimeout(() => {
                    createFloatingEmoji();
                }, 100);
            }
        }

        function addNewChatMessage() {
            const chatContainer = document.getElementById('chatMessages');
            if (!chatContainer) return;

            // Get random message
            const message = chatMessages[Math.floor(Math.random() * chatMessages.length)];
            
            const chatDiv = document.createElement('div');
            chatDiv.className = 'chat-message backdrop-blur-[1px] backdrop-filter bg-[rgba(0,0,0,0.3)] flex flex-row gap-2 items-center p-[7px] rounded-2xl floating-chat';
            chatDiv.innerHTML = `
                <img alt="User" class="w-7 h-7 rounded-full" src="${message.user}" />
                <div class="text-white text-[13px] leading-[16px]" style="font-family: 'Avenir LT Std', sans-serif;">
                    ${message.text}
                </div>
            `;
            
            chatContainer.appendChild(chatDiv);
            
            // Auto-scroll to bottom
            chatContainer.scrollTop = chatContainer.scrollHeight;
            
            // Remove old messages to prevent overflow
            const messages = chatContainer.querySelectorAll('.chat-message');
            if (messages.length > 8) {
                messages[0].remove();
            }
            
            // Remove chat message after animation
            setTimeout(() => {
                if (chatDiv.parentNode) {
                    chatDiv.parentNode.removeChild(chatDiv);
                }
            }, 4000);
        }

        // Button interaction handlers
        function setupLiveRoomButtons() {
            // Hold to Talk Button
            const holdToTalkBtn = document.getElementById('holdToTalkBtn');
            if (holdToTalkBtn) {
                holdToTalkBtn.addEventListener('mousedown', function() {
                    this.classList.add('btn-pressed');
                    showDebugInfo('🎤 Hold to talk activated');
                });
                
                holdToTalkBtn.addEventListener('mouseup', function() {
                    this.classList.remove('btn-pressed');
                    showDebugInfo('🎤 Talk released');
                });
                
                holdToTalkBtn.addEventListener('mouseleave', function() {
                    this.classList.remove('btn-pressed');
                });
            }

            // Type Message Button
            const typeMessageBtn = document.getElementById('typeMessageBtn');
            if (typeMessageBtn) {
                typeMessageBtn.addEventListener('click', function() {
                    this.classList.add('btn-pressed');
                    setTimeout(() => this.classList.remove('btn-pressed'), 150);
                    showDebugInfo('⌨️ Type message clicked');
                    // Add a user message to the chat
                    addUserMessage('Hello everyone! 👋');
                });
            }

            // Reroll Character Button
            const rerollCharacterBtn = document.getElementById('rerollCharacterBtn');
            if (rerollCharacterBtn) {
                rerollCharacterBtn.addEventListener('click', function() {
                    this.classList.add('btn-pressed');
                    setTimeout(() => this.classList.remove('btn-pressed'), 150);
                    showDebugInfo('🎲 Character rerolled');
                });
            }

            // Like Button
            const likeBtn = document.getElementById('likeBtn');
            if (likeBtn) {
                likeBtn.addEventListener('click', function() {
                    this.classList.add('btn-pressed');
                    setTimeout(() => this.classList.remove('btn-pressed'), 150);
                    showDebugInfo('❤️ Liked!');
                    // Trigger extra emoji burst
                    for (let i = 0; i < 3; i++) {
                        setTimeout(() => createFloatingEmoji(), i * 200);
                    }
                });
            }

            // Back Button
            const backButton = document.getElementById('liveRoomBackButton');
            if (backButton) {
                backButton.addEventListener('click', hideLiveRoom);
            }
        }

        function addUserMessage(text) {
            const chatContainer = document.getElementById('chatMessages');
            if (!chatContainer) return;

            const chatDiv = document.createElement('div');
            chatDiv.className = 'chat-message backdrop-blur-[1px] backdrop-filter bg-[rgba(0,0,0,0.5)] flex flex-row gap-2 items-center p-[7px] rounded-2xl';
            chatDiv.innerHTML = `
                <img alt="You" class="w-7 h-7 rounded-full" src="./src/assets/d4d2ca48cd435cf039ebac7d781a1bb460198b85.png" />
                <div class="text-white text-[13px] leading-[16px]" style="font-family: 'Avenir LT Std', sans-serif;">
                    ${text}
                </div>
            `;
            
            chatContainer.appendChild(chatDiv);
            chatContainer.scrollTop = chatContainer.scrollHeight;
        }

        // Make all functions available globally
        window.handleBackFromSettings = handleBackFromSettings;
        window.handleLanguageChange = handleLanguageChange;
        window.selectCharacter = selectCharacter;
        window.showCharacterPreferences = showCharacterPreferences;
        window.handleBackFromCharacterPreferences = handleBackFromCharacterPreferences;
        window.toggleCharacterPreference = toggleCharacterPreference;
        window.showImageUploadModal = showImageUploadModal;
        window.handleChooseFromAlbum = handleChooseFromAlbum;
        window.handleCamera = handleCamera;
        window.handleCancelUpload = handleCancelUpload;
        window.handleBackFromCamera = handleBackFromCamera;
        window.handleCameraCapture = handleCameraCapture;
        window.handlePhotoComplete = handlePhotoComplete;

        // Live Room Functions
        function showLiveRoom() {
            console.log('Showing live room (Page 13)');
            
            // Hide current page
            document.querySelectorAll('.page-active').forEach(page => {
                page.classList.remove('page-active');
                page.classList.add('page-hidden');
            });
            
            // Show Page 13
            const liveRoom = document.getElementById('page13');
            if (liveRoom) {
                liveRoom.classList.remove('hidden');
                liveRoom.classList.add('show');
                currentPage = 13;
                
                // Start live room animations
                startLiveRoomAnimations();
                
                showDebugInfo('Entered live broadcast room! 📺');
            }
        }

        function handleBackFromLive() {
            console.log('Back from live room to Page 3');
            
            // Stop live animations
            stopLiveRoomAnimations();
            
            // Hide Page 13
            const liveRoom = document.getElementById('page13');
            if (liveRoom) {
                liveRoom.classList.add('hidden');
                liveRoom.classList.remove('show');
            }
            
            // Show Page 3
            document.getElementById('page3').classList.remove('page-hidden');
            document.getElementById('page3').classList.add('page-active');
            currentPage = 3;
            
            showDebugInfo('Returned to main page from live room');
        }

        // Live Room Animation Variables
        let emojiInterval;
        let barrageInterval;
        let barrageIndex = 0;

        // Emoji data for floating animations
        const emojis = [
            './src/assets/e1da4bf3a87f8d2850071fcbf61284251623f44b.png', // Smiling face with hearts
            './src/assets/cebe50ea4c5d9b448454b19dd79074e5c5b4d898.png', // Clapping hands
            './src/assets/b9a9f2c45090ee70d6300c9e71493fd74cb39ca9.png', // Partying face
            './src/assets/b7bdd4e332f1134cea6b347137499723925005ef.png', // Thumbs up
            './src/assets/59520d231a783bb20cd3d4f98dfaec2de858b210.png', // Red heart
            './src/assets/cfeb233a63b04fed9f64dfbb76a4cb65cc4653ca.png'  // Smiling face with heart-eyes
        ];

        // Barrage/Chat messages data
        const barrageMessages = [
            {
                avatar: './src/assets/d4d2ca48cd435cf039ebac7d781a1bb460198b85.png',
                text: 'Who else thinks this belonged to a rich kid showing off at court?',
                character: null
            },
            {
                avatar: './src/assets/d4d2ca48cd435cf039ebac7d781a1bb460198b85.png',
                text: 'Hold on, I just found a 17th-century receipt about this thing!',
                character: null
            },
            {
                avatar: './src/assets/e3ade9aa46c847d649f3684414fe999679b41c1d.png',
                text: 'Qianlong: I shall stamp it!',
                character: 'emperor'
            },
            {
                avatar: './src/assets/d4d2ca48cd435cf039ebac7d781a1bb460198b85.png',
                text: 'Unpacking centuries of opinions.',
                character: null
            },
            {
                avatar: './src/assets/d4d2ca48cd435cf039ebac7d781a1bb460198b85.png',
                text: 'This cat is probably judging all our historical debates 😸',
                character: null
            },
            {
                avatar: './src/assets/e3ade9aa46c847d649f3684414fe999679b41c1d.png',
                text: 'The frame is worth more than my house!',
                character: 'emperor'
            },
            {
                avatar: './src/assets/d4d2ca48cd435cf039ebac7d781a1bb460198b85.png',
                text: 'Museum security must be watching this stream 👀',
                character: null
            },
            {
                avatar: './src/assets/e3ade9aa46c847d649f3684414fe999679b41c1d.png',
                text: 'Plot twist: The cat is actually a time traveler',
                character: 'emperor'
            },
            {
                avatar: './src/assets/d4d2ca48cd435cf039ebac7d781a1bb460198b85.png',
                text: 'I painted not what I saw, but what I felt in that night of madness.',
                character: 'van-gogh'
            },
            {
                avatar: './src/assets/d4d2ca48cd435cf039ebac7d781a1bb460198b85.png',
                text: 'The cypress trees in my paintings reach towards the swirling sky.',
                character: 'van-gogh'
            }
        ];

        // Voice Input Page (Page 18) Functions
        let voiceRecordingInterval = null;
        let voiceTimer = 0;
        let isRecording = false;
        let voiceAnimationInterval = null;

        function navigateToVoicePage() {
            console.log('Navigating to voice input page (Page 18)');
            
            // Hide Page 13
            const page13 = document.getElementById('page13');
            if (page13) {
                page13.classList.add('hidden');
            }
            
            // Copy chat messages from Page 13 to Page 18
            copyBarrageToVoicePage();
            
            // Show Page 18
            const page18 = document.getElementById('page18');
            if (page18) {
                page18.classList.remove('hidden');
                currentPage = 18;
                showDebugInfo('Voice Input Page - Long press mic to record (1-60s)');
            }
            
            // Initialize voice input functionality
            initializeVoiceInput();
        }

        function copyBarrageToVoicePage() {
            const originalMessages = document.getElementById('chatMessages');
            const voiceMessages = document.getElementById('voiceChatMessages');
            const originalEmojis = document.getElementById('emojiContainer');
            const voiceEmojis = document.getElementById('voiceEmojiContainer');
            
            if (originalMessages && voiceMessages) {
                // Clone all current messages with their exact structure
                voiceMessages.innerHTML = originalMessages.innerHTML;
                
                // Apply the same stable animation class to maintain continuity
                const voiceChatContainer = document.getElementById('voiceChatContainer');
                if (voiceChatContainer) {
                    voiceChatContainer.classList.add('barrage-scroll-container');
                    voiceMessages.classList.add('barrage-scroll-content', 'barrage-continuous-scroll');
                }
                
                // Re-initialize click handlers for character messages on voice page
                const characterMessages = voiceMessages.querySelectorAll('.character-message');
                characterMessages.forEach(msg => {
                    msg.addEventListener('click', function(e) {
                        e.stopPropagation();
                        showPage(15);
                        showDebugInfo('Opened character intro from voice page barrage');
                    });
                });
            }
            
            if (originalEmojis && voiceEmojis) {
                // Copy current floating emojis with their animations
                voiceEmojis.innerHTML = originalEmojis.innerHTML;
            }
            
            console.log('✅ Barrage successfully copied to voice page with stable continuity');
        }

        function initializeVoiceInput() {
            const micButton = document.getElementById('voiceMicButton');
            const voiceStatus = document.getElementById('voiceInputStatus');
            const timer = document.getElementById('voiceTimer');
            const waveAnimation = document.getElementById('voiceWaveAnimation');
            
            if (!micButton) return;
            
            // Reset any previous state
            isRecording = false;
            voiceTimer = 0;
            
            // Long press detection with improved feedback
            let pressTimer = null;
            let isLongPress = false;
            
            // Mouse events for desktop
            micButton.addEventListener('mousedown', (e) => {
                e.preventDefault();
                e.stopPropagation();
                console.log('🎤 Mouse down on mic button');
                
                pressTimer = setTimeout(() => {
                    isLongPress = true;
                    startVoiceRecording();
                    console.log('🎙️ Long press detected, starting recording');
                }, 500); // 500ms for long press
                
                // Visual feedback for press
                micButton.style.transform = 'scale(0.95)';
            });
            
            micButton.addEventListener('mouseup', (e) => {
                e.preventDefault();
                e.stopPropagation();
                console.log('🎤 Mouse up on mic button, isLongPress:', isLongPress);
                
                // Reset visual state
                micButton.style.transform = 'scale(1)';
                
                if (pressTimer) {
                    clearTimeout(pressTimer);
                }
                if (isLongPress) {
                    stopVoiceRecording();
                }
                isLongPress = false;
            });
            
            micButton.addEventListener('mouseleave', (e) => {
                // Reset visual state
                micButton.style.transform = 'scale(1)';
                
                if (pressTimer) {
                    clearTimeout(pressTimer);
                }
                if (isLongPress) {
                    stopVoiceRecording();
                }
                isLongPress = false;
            });
            
            // Touch events for mobile
            micButton.addEventListener('touchstart', (e) => {
                e.preventDefault();
                e.stopPropagation();
                console.log('📱 Touch start on mic button');
                
                pressTimer = setTimeout(() => {
                    isLongPress = true;
                    startVoiceRecording();
                    console.log('🎙️ Long touch detected, starting recording');
                }, 500);
                
                // Visual feedback for touch
                micButton.style.transform = 'scale(0.95)';
            });
            
            micButton.addEventListener('touchend', (e) => {
                e.preventDefault();
                e.stopPropagation();
                console.log('📱 Touch end on mic button, isLongPress:', isLongPress);
                
                // Reset visual state
                micButton.style.transform = 'scale(1)';
                
                if (pressTimer) {
                    clearTimeout(pressTimer);
                }
                if (isLongPress) {
                    stopVoiceRecording();
                }
                isLongPress = false;
            });
            
            console.log('✅ Voice input initialized with enhanced long-press detection');
        }

        function startVoiceRecording() {
            if (isRecording) return;
            
            console.log('🎙️ Starting enhanced voice recording');
            isRecording = true;
            voiceTimer = 1;
            
            const micButton = document.getElementById('voiceMicButton');
            const voiceStatus = document.getElementById('voiceInputStatus');
            const timer = document.getElementById('voiceTimer');
            const waveAnimation = document.getElementById('voiceWaveAnimation');
            
            // Show and animate recording UI
            if (voiceStatus) {
                voiceStatus.classList.remove('hidden');
                voiceStatus.classList.add('voice-status-active');
            }
            
            // Enhanced mic button animation
            if (micButton) {
                micButton.classList.add('recording-active');
                micButton.style.boxShadow = '0 0 20px rgba(86, 66, 48, 0.6)';
            }
            
            // Enhanced wave animation
            if (waveAnimation) {
                waveAnimation.classList.add('voice-wave-active');
                
                // Activate individual wave bars
                const waveBars = waveAnimation.querySelectorAll('[class*="voice-wave-bar"]');
                waveBars.forEach((bar, index) => {
                    setTimeout(() => {
                        bar.classList.add('voice-wave-bar-' + ((index % 3) + 1));
                    }, index * 100);
                });
            }
            
            // Enhanced timer with visual feedback
            if (timer) {
                timer.classList.add('timer-active');
                timer.textContent = '1"';
            }
            
            // Start precise timer (1-60 seconds)
            voiceRecordingInterval = setInterval(() => {
                if (timer) {
                    timer.textContent = `${voiceTimer}"`;
                    
                    // Change timer color as it approaches limit
                    if (voiceTimer > 50) {
                        timer.style.color = '#d32f2f'; // Red when close to limit
                    } else if (voiceTimer > 30) {
                        timer.style.color = '#f57c00'; // Orange at halfway
                    } else {
                        timer.style.color = '#252529'; // Default dark
                    }
                }
                
                voiceTimer++;
                
                // Auto-stop at 60 seconds with visual feedback
                if (voiceTimer > 60) {
                    stopVoiceRecording();
                    showDebugInfo('🔴 Auto-stopped at 60 seconds');
                }
            }, 1000);
            
            showDebugInfo(`🎤 Recording voice... ${voiceTimer}"/60"`);
        }

        function stopVoiceRecording() {
            if (!isRecording) return;
            
            const recordingDuration = voiceTimer - 1;
            console.log(`🛑 Voice recording stopped at ${recordingDuration} seconds`);
            isRecording = false;
            
            // Clear timer
            if (voiceRecordingInterval) {
                clearInterval(voiceRecordingInterval);
                voiceRecordingInterval = null;
            }
            
            const micButton = document.getElementById('voiceMicButton');
            const voiceStatus = document.getElementById('voiceInputStatus');
            const timer = document.getElementById('voiceTimer');
            const waveAnimation = document.getElementById('voiceWaveAnimation');
            
            // Enhanced UI reset with smooth transitions
            if (voiceStatus) {
                // Fade out effect
                voiceStatus.style.transition = 'opacity 0.3s ease-out, transform 0.3s ease-out';
                voiceStatus.style.opacity = '0';
                voiceStatus.style.transform = 'translateY(10px) scale(0.98)';
                
                setTimeout(() => {
                    voiceStatus.classList.add('hidden');
                    voiceStatus.classList.remove('voice-status-active');
                    voiceStatus.style.opacity = '';
                    voiceStatus.style.transform = '';
                    voiceStatus.style.transition = '';
                }, 300);
            }
            
            // Enhanced mic button reset
            if (micButton) {
                micButton.classList.remove('recording-active');
                micButton.style.boxShadow = '';
                micButton.style.transform = 'scale(1)';
            }
            
            // Enhanced wave animation reset
            if (waveAnimation) {
                waveAnimation.classList.remove('voice-wave-active');
                
                // Remove individual wave bar animations
                const waveBars = waveAnimation.querySelectorAll('[class*="voice-wave-bar"]');
                waveBars.forEach(bar => {
                    bar.classList.remove('voice-wave-bar-1', 'voice-wave-bar-2', 'voice-wave-bar-3');
                });
            }
            
            // Reset timer display
            if (timer) {
                timer.classList.remove('timer-active');
                timer.style.color = '#252529'; // Reset to default color
                timer.textContent = '1"';
            }
            
            // Reset timer variable
            voiceTimer = 0;
            
            showDebugInfo(`✅ Voice recording completed! Duration: ${recordingDuration}s`);
        }

        function handleBackFromVoice() {
            console.log('Returning from voice page to live room');
            
            // Stop any active recording
            if (isRecording) {
                stopVoiceRecording();
            }
            
            // Hide Page 18
            const page18 = document.getElementById('page18');
            if (page18) {
                page18.classList.add('hidden');
            }
            
            // Show Page 13 and restore barrage
            const page13 = document.getElementById('page13');
            if (page13) {
                page13.classList.remove('hidden');
                currentPage = 13;
                
                // Restore barrage animation if it was stopped
                restoreBarrageAnimation();
                showDebugInfo('Live room - barrage animations active');
            }
        }

        // Enhanced Barrage System Functions with Stability Improvements
        // Global barrage management variables
        let monitoringInterval = null;
        let messageGenerationInterval = null;

        function initializeImprovedBarrage() {
            const chatMessages = document.getElementById('chatMessages');
            const chatContainer = document.getElementById('chatContainer');
            
            if (!chatMessages || !chatContainer) return;
            
            // Clear any existing intervals to prevent accumulation
            clearBarrageIntervals();
            
            console.log('🔄 Initializing stable barrage system for Page 13');
            
            // Get original messages
            const originalMessages = Array.from(chatMessages.children);
            
            // Only duplicate if we don't have enough messages already
            if (originalMessages.length < 12) {
                const duplicatedMessages = originalMessages.map(msg => {
                    const cloned = msg.cloneNode(true);
                    // Re-attach event listeners for character messages
                    if (cloned.querySelector('.character-message')) {
                        const characterMsg = cloned.querySelector('.character-message');
                        characterMsg.addEventListener('click', function(e) {
                            e.stopPropagation();
                            showPage(15);
                            showDebugInfo('Opened character intro from barrage message');
                        });
                        characterMsg.style.cursor = 'pointer';
                    }
                    
                    // Also add general click handler for all messages
                    cloned.addEventListener('click', function(e) {
                        e.stopPropagation();
                        showPage(15);
                        showDebugInfo('Opened character intro from barrage message');
                    });
                    return cloned;
                });
                
                // Add duplicated messages for seamless looping
                duplicatedMessages.forEach(msg => chatMessages.appendChild(msg));
            }
            
            // Apply stable continuous scrolling animation
            chatMessages.classList.remove('barrage-continuous-scroll', 'smooth-message-flow');
            
            // Force reflow and apply the stable animation class
            requestAnimationFrame(() => {
                chatMessages.classList.add('barrage-continuous-scroll');
                console.log('✅ Applied stable barrage animation');
            });
            
            // Start stable message generation with controlled intervals
            messageGenerationInterval = setInterval(() => {
                if (currentPage === 13) {
                    addStableDynamicMessage();
                }
            }, 6000); // Consistent 6-second intervals
            
            // Start emoji generation
            emojiInterval = setInterval(() => {
                if (currentPage === 13) {
                    createFloatingEmoji();
                }
            }, 800); // Keep existing emoji timing
            
            // Start monitoring system
            monitoringInterval = setInterval(() => {
                if (currentPage === 13) {
                    maintainBarrageContinuity();
                }
            }, 5000); // Check every 5 seconds
            
            console.log('✅ Stable barrage system initialized with proper interval management');
        }

        function clearBarrageIntervals() {
            if (barrageInterval) {
                clearInterval(barrageInterval);
                barrageInterval = null;
            }
            if (emojiInterval) {
                clearInterval(emojiInterval);
                emojiInterval = null;
            }
            if (monitoringInterval) {
                clearInterval(monitoringInterval);
                monitoringInterval = null;
            }
            if (messageGenerationInterval) {
                clearInterval(messageGenerationInterval);
                messageGenerationInterval = null;
            }
            console.log('🧹 Cleared all barrage intervals');
        }

        function maintainBarrageContinuity() {
            const chatMessages = document.getElementById('chatMessages');
            if (!chatMessages) return;
            
            // Ensure animation is still active
            if (!chatMessages.classList.contains('barrage-continuous-scroll')) {
                console.log('⚠️ Barrage animation lost, restoring...');
                chatMessages.classList.add('barrage-continuous-scroll');
            }
            
            // Ensure we have enough messages for continuous flow
            if (chatMessages.children.length < 8) {
                console.log('⚠️ Low message count, adding messages...');
                addStableDynamicMessage();
            }
        }

        function addStableDynamicMessage() {
            const chatMessages = document.getElementById('chatMessages');
            if (!chatMessages) return;

            const dynamicMessages = [
                { img: './src/assets/d4d2ca48cd435cf039ebac7d781a1bb460198b85.png', text: 'The brushwork here is absolutely mesmerizing! 🎨' },
                { img: './src/assets/e3ade9aa46c847d649f3684414fe999679b41c1d.png', text: 'I feel like stepping into this painting...' },
                { img: './src/assets/d4d2ca48cd435cf039ebac7d781a1bb460198b85.png', text: 'Vincent would be proud to see us discussing his work 💫' },
                { img: './src/assets/e3ade9aa46c847d649f3684414fe999679b41c1d.png', text: 'The starry night vibes are strong here ✨' },
                { img: './src/assets/d4d2ca48cd435cf039ebac7d781a1bb460198b85.png', text: 'This museum experience is incredible! 🏛️' },
                { img: './src/assets/e3ade9aa46c847d649f3684414fe999679b41c1d.png', text: 'Art history coming alive before our eyes 👀' }
            ];

            const randomMsg = dynamicMessages[Math.floor(Math.random() * dynamicMessages.length)];
            
            const newMessage = document.createElement('div');
            newMessage.className = 'chat-message backdrop-blur-[1px] backdrop-filter bg-[rgba(0,0,0,0.3)] flex flex-row gap-2 items-center p-[7px] rounded-2xl';
            newMessage.innerHTML = `
                <img alt="User" class="w-7 h-7 rounded-full" src="${randomMsg.img}" />
                <div class="text-white text-[13px] leading-[16px]" style="font-family: 'Avenir LT Std', sans-serif;">
                    ${randomMsg.text}
                </div>
            `;
            
            chatMessages.appendChild(newMessage);
            
            // Maintain optimal message count for performance
            if (chatMessages.children.length > 18) {
                chatMessages.removeChild(chatMessages.firstChild);
            }
        }

        function resetBarrageSystem() {
            console.log('🔄 Resetting barrage system completely');
            
            // Clear all intervals
            clearBarrageIntervals();
            
            // Reset the chat container
            const chatMessages = document.getElementById('chatMessages');
            if (chatMessages) {
                // Remove all animation classes
                chatMessages.classList.remove('barrage-continuous-scroll', 'smooth-message-flow', 'scrolling');
                
                // Clear all messages except the original ones (keep first 6 messages)
                const allMessages = Array.from(chatMessages.children);
                const originalMessages = allMessages.slice(0, 6); // Keep original messages
                
                // Clear container and restore originals
                chatMessages.innerHTML = '';
                originalMessages.forEach(msg => chatMessages.appendChild(msg));
            }
            
            // Clear emoji container
            const emojiContainer = document.getElementById('emojiContainer');
            if (emojiContainer) {
                emojiContainer.innerHTML = '';
            }
            
            // Restart the entire system after a brief delay
            setTimeout(() => {
                initializeImprovedBarrage();
                // Re-setup bullet screen navigation after reset
                if (window.setupBulletScreenNavigation) {
                    window.setupBulletScreenNavigation();
                }
                console.log('✅ Barrage system completely reset and restarted with navigation');
            }, 500);
        }

        function addDynamicMessage() {
            const chatMessages = document.getElementById('chatMessages');
            if (!chatMessages) return;

            const dynamicMessages = [
                { img: './src/assets/d4d2ca48cd435cf039ebac7d781a1bb460198b85.png', text: 'The brushwork here is absolutely mesmerizing! 🎨' },
                { img: './src/assets/e3ade9aa46c847d649f3684414fe999679b41c1d.png', text: 'I feel like stepping into this painting...' },
                { img: './src/assets/d4d2ca48cd435cf039ebac7d781a1bb460198b85.png', text: 'Vincent would be proud to see us discussing his work 💫' },
                { img: './src/assets/e3ade9aa46c847d649f3684414fe999679b41c1d.png', text: 'The starry night vibes are strong here ✨' }
            ];

            const randomMsg = dynamicMessages[Math.floor(Math.random() * dynamicMessages.length)];
            
            const newMessage = document.createElement('div');
            newMessage.className = 'chat-message backdrop-blur-[1px] backdrop-filter bg-[rgba(0,0,0,0.3)] flex flex-row gap-2 items-center p-[7px] rounded-2xl chat-message-new';
            newMessage.innerHTML = `
                <img alt="User" class="w-7 h-7 rounded-full" src="${randomMsg.img}" />
                <div class="text-white text-[13px] leading-[16px]" style="font-family: 'Avenir LT Std', sans-serif;">
                    ${randomMsg.text}
                </div>
            `;
            
            chatMessages.appendChild(newMessage);
            
            // Remove oldest message to maintain scroll performance
            if (chatMessages.children.length > 20) {
                chatMessages.removeChild(chatMessages.firstChild);
            }
        }

        function addDynamicMessage() {
            const chatMessages = document.getElementById('chatMessages');
            if (!chatMessages) return;

            const dynamicMessages = [
                { img: './src/assets/d4d2ca48cd435cf039ebac7d781a1bb460198b85.png', text: 'The brushwork here is absolutely mesmerizing! 🎨' },
                { img: './src/assets/e3ade9aa46c847d649f3684414fe999679b41c1d.png', text: 'I feel like stepping into this painting...' },
                { img: './src/assets/d4d2ca48cd435cf039ebac7d781a1bb460198b85.png', text: 'Vincent would be proud to see us discussing his work 💫' },
                { img: './src/assets/e3ade9aa46c847d649f3684414fe999679b41c1d.png', text: 'The starry night vibes are strong here ✨' }
            ];

            const randomMsg = dynamicMessages[Math.floor(Math.random() * dynamicMessages.length)];
            
            const newMessage = document.createElement('div');
            newMessage.className = 'chat-message backdrop-blur-[1px] backdrop-filter bg-[rgba(0,0,0,0.3)] flex flex-row gap-2 items-center p-[7px] rounded-2xl chat-message-new';
            newMessage.innerHTML = `
                <img alt="User" class="w-7 h-7 rounded-full" src="${randomMsg.img}" />
                <div class="text-white text-[13px] leading-[16px]" style="font-family: 'Avenir LT Std', sans-serif;">
                    ${randomMsg.text}
                </div>
            `;
            
            chatMessages.appendChild(newMessage);
            
            // Remove oldest message to maintain scroll performance
            if (chatMessages.children.length > 20) {
                chatMessages.removeChild(chatMessages.firstChild);
            }
            
            console.log('✅ Enhanced barrage system initialized with', chatMessages.children.length, 'total messages');
        }

        function restoreBarrageAnimation() {
            const chatMessages = document.getElementById('chatMessages');
            const chatContainer = document.getElementById('chatContainer');
            
            if (chatMessages && chatContainer) {
                // Force restart continuous scrolling
                chatMessages.classList.remove('barrage-continuous-scroll');
                
                // Use requestAnimationFrame for smoother restart
                requestAnimationFrame(() => {
                    chatMessages.classList.add('barrage-continuous-scroll');
                });
                
                // Re-initialize if needed
                if (chatMessages.children.length < 10) {
                    initializeImprovedBarrage();
                }
                
                console.log('✅ Barrage animation restored and stabilized');
            }
        }

        function stabilizeBarrageSystem() {
            // Function to ensure barrage continues working properly
            const chatMessages = document.getElementById('chatMessages');
            if (!chatMessages) return;
            
            // Check if animation is still active
            const isAnimating = chatMessages.classList.contains('barrage-continuous-scroll');
            
            if (!isAnimating) {
                console.log('⚠️ Barrage animation detected as stopped, restarting...');
                restoreBarrageAnimation();
            }
            
            // Remove any messages that might have become orphaned
            const messages = chatMessages.querySelectorAll('.chat-message');
            messages.forEach(msg => {
                if (msg.style.opacity === '0' || msg.style.display === 'none') {
                    msg.remove();
                }
            });
        }

        // Enhanced message creation with better stability
        function addNewChatMessage() {
            const chatContainer = document.getElementById('chatMessages');
            if (!chatContainer) return;

            // Get random message
            const message = barrageMessages[Math.floor(Math.random() * barrageMessages.length)];
            
            const chatDiv = document.createElement('div');
            const isCharacterMessage = message.character === 'van-gogh';
            
            // Enhanced styling with stability classes
            chatDiv.className = `chat-message chat-message-new backdrop-blur-[1px] backdrop-filter bg-[rgba(0,0,0,0.3)] flex flex-row gap-2 items-center p-[7px] rounded-2xl cursor-pointer ${isCharacterMessage ? 'character-message' : ''}`;
            
            if (isCharacterMessage) {
                chatDiv.dataset.character = message.character;
            }
            
            chatDiv.innerHTML = `
                <img alt="User" class="w-7 h-7 rounded-full" src="${message.avatar}" />
                <div class="text-white text-[13px] leading-[16px] ${isCharacterMessage ? 'underline decoration-white/50' : ''}" style="font-family: 'Avenir LT Std', sans-serif;">
                    ${message.text}
                </div>
            `;
            
            // Add click handler for ALL messages to open character intro
            chatDiv.addEventListener('click', function(e) {
                e.stopPropagation();
                showPage(15);
                showDebugInfo('Opened character intro from barrage message');
            });
            
            // Add message with smooth animation
            chatDiv.style.opacity = '0';
            chatDiv.style.transform = 'translateY(10px)';
            chatContainer.appendChild(chatDiv);
            
            // Animate in
            requestAnimationFrame(() => {
                chatDiv.style.transition = 'opacity 0.3s ease-out, transform 0.3s ease-out';
                chatDiv.style.opacity = '1';
                chatDiv.style.transform = 'translateY(0)';
            });
            
            // Maintain message count (keep last 15 messages for better continuity)
            const messages = chatContainer.querySelectorAll('.chat-message');
            if (messages.length > 15) {
                const oldMessage = messages[0];
                // Smooth removal
                oldMessage.style.transition = 'opacity 0.3s ease-out, transform 0.3s ease-out';
                oldMessage.style.opacity = '0';
                oldMessage.style.transform = 'translateY(-10px)';
                setTimeout(() => {
                    if (oldMessage.parentNode) {
                        oldMessage.remove();
                    }
                }, 300);
            }
            
            // Ensure barrage animation stays active
            setTimeout(() => {
                stabilizeBarrageSystem();
            }, 100);
        }

        function createFloatingEmoji() {
            const emojiContainer = document.getElementById('emojiContainer');
            if (!emojiContainer) return;

            // Create 1-2 emojis per call for density
            const emojiCount = Math.random() > 0.5 ? 2 : 1;
            
            for (let i = 0; i < emojiCount; i++) {
                setTimeout(() => {
                    const emoji = document.createElement('div');
                    emoji.className = 'floating-emoji absolute w-8 h-8';
                    
                    // Random emoji from array
                    const randomEmoji = emojis[Math.floor(Math.random() * emojis.length)];
                    emoji.style.backgroundImage = `url('${randomEmoji}')`;
                    emoji.style.backgroundSize = 'cover';
                    emoji.style.backgroundPosition = 'center';
                    
                    // Random horizontal position within container (wider spread)
                    emoji.style.left = Math.random() * 30 + 'px'; // 0-30px within the 61px width
                    emoji.style.bottom = '0px';
                    
                    // Random rotation and slight scale variation
                    const rotation = Math.random() * 40 - 20; // -20 to +20 degrees
                    const scale = 0.7 + Math.random() * 0.6; // 0.7 to 1.3 scale for variety
                    emoji.style.transform = `rotate(${rotation}deg) scale(${scale})`;
                    
                    emojiContainer.appendChild(emoji);
                    
                    // Remove emoji after animation completes (1.5 seconds now)
                    setTimeout(() => {
                        if (emoji.parentNode) {
                            emoji.parentNode.removeChild(emoji);
                        }
                    }, 1500);
                }, i * 100); // Slight delay between multiple emojis
            }
        }

        function createBarrageMessage(msgData) {
            const messageEl = document.createElement('div');
            messageEl.className = 'chat-message backdrop-blur-[1px] backdrop-filter bg-[rgba(0,0,0,0.3)] flex flex-row gap-2 items-center p-[7px] rounded-2xl cursor-pointer';
            
            if (msgData.character) {
                messageEl.classList.add('character-message');
                messageEl.dataset.character = msgData.character;
            }
            
            messageEl.innerHTML = `
                <img src="${msgData.avatar}" alt="Avatar" class="w-7 h-7 rounded-full">
                <div class="text-white text-[13px] leading-[16px]" style="font-family: 'Avenir LT Std', sans-serif;">${msgData.text}</div>
            `;
            
            // Add click handler
            messageEl.addEventListener('click', function(e) {
                e.stopPropagation();
                showPage(15);
                showDebugInfo('Opened character intro from barrage message');
            });
            
            return messageEl;
        }

        // Simplified barrage monitoring system (no duplicate intervals)
        function startBarrageMonitoring() {
            // Only start if not already running to prevent duplicates
            if (monitoringInterval) {
                console.log('🔄 Barrage monitoring already active');
                return;
            }
            
            console.log('✅ Starting stable barrage monitoring system');
            // The intervals are now managed within initializeImprovedBarrage()
            // This function is kept for compatibility but doesn't create new intervals
        }

        // Enable manual scroll mode when user interacts
        function enableManualScroll() {
            const chatContainer = document.getElementById('chatMessages');
            const scrollOverlay = document.getElementById('chatScrollOverlay');
            const scrollArea = document.getElementById('chatScrollArea');
            
            if (chatContainer && scrollOverlay && scrollArea) {
                // Stop auto-scroll animation
                chatContainer.classList.remove('barrage-auto-scroll');
                
                // Copy current messages to scroll area
                scrollArea.innerHTML = chatContainer.innerHTML;
                
                // Show manual scroll overlay
                scrollOverlay.style.opacity = '1';
                scrollOverlay.style.pointerEvents = 'auto';
                
                // Auto-hide after 5 seconds of no interaction
                setTimeout(() => {
                    scrollOverlay.style.opacity = '0';
                    scrollOverlay.style.pointerEvents = 'none';
                    
                    // Resume auto-scroll
                    chatContainer.classList.add('barrage-auto-scroll');
                }, 5000);
            }
        }

        function handleLikeClick() {
            // Create multiple emojis for like effect - more emojis since they're faster
            for (let i = 0; i < 5; i++) {
                setTimeout(() => createFloatingEmoji(), i * 150);
            }
            
            showDebugInfo('Liked! 💖');
        }

        // Setup Live Room Button Interactions
        function setupLiveRoomButtons() {
            // Hold to Talk Button
            const holdToTalkBtn = document.getElementById('holdToTalkBtn');
            if (holdToTalkBtn) {
                holdToTalkBtn.addEventListener('mousedown', function() {
                    this.classList.add('btn-pressed');
                    showDebugInfo('🎤 Hold to talk activated');
                });
                
                holdToTalkBtn.addEventListener('mouseup', function() {
                    this.classList.remove('btn-pressed');
                    showDebugInfo('🎤 Talk released');
                });
                
                holdToTalkBtn.addEventListener('mouseleave', function() {
                    this.classList.remove('btn-pressed');
                });
            }

            // Type Message Button
            const typeMessageBtn = document.getElementById('typeMessageBtn');
            if (typeMessageBtn) {
                typeMessageBtn.addEventListener('click', function() {
                    this.classList.add('btn-pressed');
                    setTimeout(() => this.classList.remove('btn-pressed'), 150);
                    showDebugInfo('⌨️ Type message clicked');
                    addUserMessage('Hello everyone! 👋');
                });
            }

            // Reroll Character Button - Reset barrage system
            const rerollCharacterBtn = document.getElementById('rerollCharacterBtn');
            if (rerollCharacterBtn) {
                rerollCharacterBtn.addEventListener('click', function() {
                    this.classList.add('btn-pressed');
                    setTimeout(() => this.classList.remove('btn-pressed'), 150);
                    
                    // Reset the entire barrage system
                    resetBarrageSystem();
                    showDebugInfo('🎲 Character rerolled - Barrage reset!');
                });
            }

            // Like Button
            const likeBtn = document.getElementById('likeBtn');
            if (likeBtn) {
                likeBtn.addEventListener('click', function() {
                    this.classList.add('btn-pressed');
                    setTimeout(() => this.classList.remove('btn-pressed'), 150);
                    showDebugInfo('❤️ Liked!');
                    handleLikeClick();
                });
            }

            // Back Button for Live Room
            const liveRoomBackButton = document.getElementById('liveRoomBackButton');
            if (liveRoomBackButton) {
                liveRoomBackButton.addEventListener('click', function(e) {
                    e.stopPropagation();
                    e.preventDefault();
                    handleBackFromLive();
                });
            }

            // Settings icon click handler - show volume settings (Page 17)
            const settingsIcon = document.querySelector('[data-name="Component 28"]');
            if (settingsIcon) {
                settingsIcon.addEventListener('click', function(e) {
                    e.stopPropagation();
                    showVolumeSettings(); // Use the new function that initializes slider
                    showDebugInfo('Opened volume settings');
                });
                settingsIcon.style.cursor = 'pointer';
            }
            
            // Page 18 Settings Icon click handler
            const page18SettingsIcon = document.getElementById('page18SettingsIcon');
            if (page18SettingsIcon) {
                page18SettingsIcon.addEventListener('click', function(e) {
                    e.stopPropagation();
                    showVolumeSettings();
                    showDebugInfo('Opened volume settings from page 18');
                });
            }
            
            // Enhanced bullet screen click handlers for all pages
            function setupBulletScreenNavigation() {
                // Page 13 character message handlers
                const page13CharacterMessages = document.querySelectorAll('#page13 .character-message');
                page13CharacterMessages.forEach(message => {
                    message.addEventListener('click', function(e) {
                        e.stopPropagation();
                        showPage(15);
                        showDebugInfo('Opened character intro from page 13 bullet screen');
                    });
                    message.style.cursor = 'pointer';
                });
                
                // Page 18 character message handlers
                const page18CharacterMessages = document.querySelectorAll('#page18 .character-message');
                page18CharacterMessages.forEach(message => {
                    message.addEventListener('click', function(e) {
                        e.stopPropagation();
                        showPage(15);
                        showDebugInfo('Opened character intro from page 18 bullet screen');
                    });
                    message.style.cursor = 'pointer';
                });
                
                // Add delegated event listeners for dynamically created messages
                const chatContainer13 = document.getElementById('chatContainer');
                if (chatContainer13) {
                    chatContainer13.addEventListener('click', function(e) {
                        if (e.target.closest('.character-message')) {
                            e.stopPropagation();
                            showPage(15);
                            showDebugInfo('Opened character intro from page 13 dynamic bullet screen');
                        }
                    });
                }
                
                const voiceChatContainer = document.getElementById('voiceChatContainer');
                if (voiceChatContainer) {
                    voiceChatContainer.addEventListener('click', function(e) {
                        if (e.target.closest('.character-message')) {
                            e.stopPropagation();
                            showPage(15);
                            showDebugInfo('Opened character intro from page 18 dynamic bullet screen');
                        }
                    });
                }
            }
            
            // Setup bullet screen navigation
            setupBulletScreenNavigation();
            
            // Re-setup bullet screen navigation when barrage system resets
            window.setupBulletScreenNavigation = setupBulletScreenNavigation;
            
            // Page 15 handlers
            setTimeout(() => {
                const page15BackButton = document.getElementById('page15BackButton');
                if (page15BackButton) {
                    page15BackButton.addEventListener('click', function() {
                        showPage(13);
                        showDebugInfo('Back to live room from character intro');
                    });
                }
                
                const page15CloseButton = document.getElementById('page15CloseButton');
                if (page15CloseButton) {
                    page15CloseButton.addEventListener('click', function() {
                        showPage(13);
                        showDebugInfo('Closed character intro');
                    });
                }
                
                // Zoom icon click handler - go to expanded view (Page 16)
                const zoomIcon = document.getElementById('zoomIcon');
                if (zoomIcon) {
                    zoomIcon.addEventListener('click', function(e) {
                        e.stopPropagation();
                        showPage(16);
                        showDebugInfo('Opened expanded character view');
                    });
                    zoomIcon.style.cursor = 'pointer';
                }

                // Page 16 handlers
                const page16BackButton = document.getElementById('page16BackButton');
                if (page16BackButton) {
                    page16BackButton.addEventListener('click', function() {
                        showPage(15);
                        showDebugInfo('Back to character intro from expanded view');
                    });
                }

                // Page 17 handlers
                const page17BackButton = document.getElementById('page17BackButton');
                if (page17BackButton) {
                    page17BackButton.addEventListener('click', function() {
                        showPage(13);
                        showDebugInfo('Back to live room from volume settings');
                    });
                }
                
                const page17CloseButton = document.getElementById('page17CloseButton');
                if (page17CloseButton) {
                    page17CloseButton.addEventListener('click', function() {
                        showPage(13);
                        showDebugInfo('Closed volume settings');
                    });
                }
            }, 500);
        }

        function addUserMessage(text) {
            const chatContainer = document.getElementById('chatMessages');
            if (!chatContainer) return;

            const chatDiv = document.createElement('div');
            chatDiv.className = 'chat-message backdrop-blur-[1px] backdrop-filter bg-[rgba(0,0,0,0.5)] flex flex-row gap-2 items-center p-[7px] rounded-2xl';
            chatDiv.innerHTML = `
                <img alt="You" class="w-7 h-7 rounded-full" src="./src/assets/d4d2ca48cd435cf039ebac7d781a1bb460198b85.png" />
                <div class="text-white text-[13px] leading-[16px]" style="font-family: 'Avenir LT Std', sans-serif;">
                    ${text}
                </div>
            `;
            
            chatContainer.appendChild(chatDiv);
            chatContainer.scrollTop = chatContainer.scrollHeight;
        }

        // Make live room functions available globally
        window.showLiveRoom = showLiveRoom;
        window.handleBackFromLive = handleBackFromLive;
        window.handleLikeClick = handleLikeClick;

        // Touch event handlers for swipe functionality
        function handleTouchStart(e) {
            console.log('🤚 handleTouchStart called');
            console.log('Touch target:', e.target);
            console.log('Closest settings element:', e.target.closest('.settings-hover, .upload-button, .cursor-pointer'));
            
            // Don't start swipe if touching interactive elements
            if (e.target.closest('.settings-hover, .upload-button, .cursor-pointer')) {
                console.log('🚫 Touch start on interactive element, skipping swipe detection');
                return;
            }
            
            if (currentPage !== 3 && currentPage !== 4) {
                console.log('🚫 Touch start not on swipeable page, skipping');
                return; // Only allow swipe between pages 3 and 4
            }
            
            startX = e.touches[0].clientX;
            isSweping = true;
            console.log('✅ Touch start registered for swipe, startX:', startX);
            showDebugInfo(`Touch start at X: ${startX}`);
        }

        function handleTouchMove(e) {
            if (!isSweping || (currentPage !== 3 && currentPage !== 4)) return;
            
            currentX = e.touches[0].clientX;
            const diffX = startX - currentX;
            
            showDebugInfo(`Touch move - Diff: ${diffX}px`);
            
            // Prevent scrolling while swiping
            if (Math.abs(diffX) > 10) {
                e.preventDefault();
            }
        }

        function handleTouchEnd(e) {
            console.log('🤚 handleTouchEnd called, isSweping:', isSweping);
            
            if (!isSweping || (currentPage !== 3 && currentPage !== 4)) {
                console.log('🚫 Touch end: not swiping or not on swipeable page');
                return;
            }
            
            const diffX = startX - currentX;
            const threshold = 50; // Minimum swipe distance
            
            console.log('📏 Touch end - Diff:', diffX, 'Threshold:', threshold);
            showDebugInfo(`Touch end - Diff: ${diffX}px (need ${threshold}px)`);
            
            if (currentPage === 3 && diffX > threshold) {
                // Swipe left from page 3 (go to page 4)
                console.log('⬅️ Swiping left from page 3 to page 4');
                showPage(4);
                showDebugInfo(`Swiped to page 4! 🎉`);
            } else if (currentPage === 4 && diffX < -threshold) {
                // Swipe right from page 4 (go back to page 3)
                console.log('➡️ Swiping right from page 4 to page 3');
                showPage(3);
                showDebugInfo(`Swiped back to page 3! 🎉`);
            } else {
                console.log('🚫 Swipe too small or invalid direction');
                showDebugInfo(`Swipe too small (${diffX}px < ${threshold}px)`);
            }
            
            isSweping = false;
            startX = 0;
            currentX = 0;
        }

        // Mouse event handlers for desktop testing (simulate touch)
        function handleMouseDown(e) {
            // Don't start swipe if clicking on interactive elements
            if (e.target.closest('.settings-hover, .upload-button, .cursor-pointer')) {
                console.log('Mouse down on interactive element, skipping swipe detection');
                isSweping = false; // Make sure we don't interfere with clicks
                startX = 0;
                currentX = 0;
                return;
            }
            
            if (currentPage !== 3 && currentPage !== 4) return; // Only allow swipe between pages 3 and 4
            
            startX = e.clientX;
            currentX = e.clientX; // Initialize currentX to startX
            isSweping = true;
            showDebugInfo(`Mouse down at X: ${startX}`);
        }

        function handleMouseMove(e) {
            // Don't continue swipe if moving over interactive elements
            if (e.target.closest('.settings-hover, .upload-button, .cursor-pointer')) {
                if (isSweping) {
                    console.log('Mouse move over interactive element, canceling swipe');
                    isSweping = false;
                    startX = 0;
                    currentX = 0;
                }
                return;
            }
            
            if (!isSweping || (currentPage !== 3 && currentPage !== 4)) return;
            
            currentX = e.clientX;
            const diffX = startX - currentX;
            showDebugInfo(`Mouse move - Diff: ${diffX}px`);
        }

        function handleMouseUp(e) {
            // Don't complete swipe if mouse up is on interactive elements
            if (e.target.closest('.settings-hover, .upload-button, .cursor-pointer')) {
                console.log('Mouse up on interactive element, canceling any swipe');
                isSweping = false;
                startX = 0;
                currentX = 0;
                return;
            }
            
            if (!isSweping || (currentPage !== 3 && currentPage !== 4)) return;
            
            const diffX = startX - currentX;
            const threshold = 50;
            
            showDebugInfo(`Mouse up - Diff: ${diffX}px (need ${threshold}px)`);
            
            if (currentPage === 3 && diffX > threshold) {
                // Mouse drag left from page 3 (go to page 4)
                showPage(4);
                showDebugInfo(`Dragged to page 4! 🎉`);
            } else if (currentPage === 4 && diffX < -threshold) {
                // Mouse drag right from page 4 (go back to page 3)
                showPage(3);
                showDebugInfo(`Dragged back to page 3! 🎉`);
            } else {
                showDebugInfo(`Drag too small (${diffX}px < ${threshold}px)`);
            }
            
            isSweping = false;
            startX = 0;
            currentX = 0;
        }

        // Keyboard navigation for desktop testing
        function handleKeyDown(e) {
            if (e.key === 'ArrowRight' && currentPage === 3) {
                // Arrow right: page 3 → page 4
                showPage(4);
                showDebugInfo(`Arrow key → to page 4! 🎉`);
            } else if (e.key === 'ArrowLeft' && currentPage === 4) {
                // Arrow left: page 4 → page 3
                showPage(3);
                showDebugInfo(`Arrow key ← back to page 3`);
            } else if (e.key === '4' && currentPage === 3) {
                // Quick test - press '4' key to go to page 4
                showPage(4);
                showDebugInfo(`Pressed '4' key to page 4! 🎉`);
            } else if (e.key === '3' && currentPage === 4) {
                // Quick test - press '3' key to go back
                showPage(3);
                showDebugInfo(`Pressed '3' key back to page 3`);
            } else if (e.key === '5' && (currentPage === 3 || currentPage === 4)) {
                // Quick test - press '5' key to open settings
                handleSettings();
                showDebugInfo(`Pressed '5' key to settings! 🎉`);
            } else if (e.key === '6' && currentPage === 5) {
                // Quick test - press '6' key to open character preferences
                showCharacterPreferences();
                showDebugInfo(`Pressed '6' key to character preferences! 🎉`);
            } else if (e.key === '7' && currentPage === 3) {
                // Quick test - press '7' key to open upload modal
                handleUpload();
                showDebugInfo(`Pressed '7' key to upload modal! 🎉`);
            } else if (e.key === '8') {
                // Quick test - press '8' key to open camera
                if (document.getElementById('page7').classList.contains('show')) {
                    handleCamera();
                    showDebugInfo(`Pressed '8' key to camera! 📷`);
                }
            } else if (e.key === '9') {
                // Quick test - press '9' key to capture photo
                if (document.getElementById('page8').classList.contains('show')) {
                    handleCameraCapture();
                    showDebugInfo(`Pressed '9' key to capture photo! 📸`);
                }
            } else if (e.key === 'Escape') {
                // Escape key to close modals
                if (document.getElementById('page9').classList.contains('show')) {
                    handlePhotoComplete();
                    showDebugInfo(`Pressed Escape to complete photo capture`);
                } else if (document.getElementById('page8').classList.contains('show')) {
                    handleBackFromCamera();
                    showDebugInfo(`Pressed Escape to close camera`);
                } else if (document.getElementById('page7').classList.contains('show')) {
                    handleCancelUpload();
                    showDebugInfo(`Pressed Escape to close upload modal`);
                } else if (document.getElementById('page6').classList.contains('show')) {
                    handleBackFromCharacterPreferences();
                    showDebugInfo(`Pressed Escape to close character preferences`);
                } else if (currentPage === 5) {
                    showPage(3);
                    showDebugInfo(`Pressed Escape to close settings`);
                }
            } else if (e.key === 's' || e.key === 'S') {
                // Debug: force settings to open
                console.log('Force opening settings with S key');
                handleSettings();
                showDebugInfo(`Forced settings open with S key! 🔧`);
            }
        }

        // Add touch support for mobile swipe gestures
        document.addEventListener('touchstart', handleTouchStart, { passive: false });
        document.addEventListener('touchmove', handleTouchMove, { passive: false });
        document.addEventListener('touchend', handleTouchEnd, { passive: false });

        // Add mouse support for desktop testing
        document.addEventListener('mousedown', handleMouseDown);
        document.addEventListener('mousemove', handleMouseMove);
        document.addEventListener('mouseup', handleMouseUp);

        // Add keyboard navigation for desktop testing
        document.addEventListener('keydown', handleKeyDown);

        // Remove the click-to-go-back functionality between pages 3-4
        // Only allow swipe navigation between these pages
        // Click interactions are limited to settings icon and upload button only
        
        // Start the opening sequence automatically when page loads
        console.log('🚀 Page loaded, starting opening sequence...');
        startOpeningSequence();
        
        // Add event listeners for interactive elements with highest priority
        document.getElementById('uploadButton').addEventListener('click', function(e) {
            console.log('🎯 Upload CLICKED! Event triggered!');
            console.log('📤 About to call handleUpload...');
            e.stopPropagation();
            e.preventDefault();
            handleUpload();
            console.log('✅ handleUpload call completed');
        }, true); // Use capture phase for highest priority
        
        document.getElementById('settingsIcon').addEventListener('click', function(e) {
            console.log('🎯 Settings CLICKED! Event triggered!');
            console.log('⚙️ About to call handleSettings...');
            e.stopPropagation();
            e.preventDefault();
            handleSettings();
            console.log('✅ handleSettings call completed');
        }, true); // Use capture phase for highest priority
        
        // Add mouse event debugging for interactive elements
        document.getElementById('uploadButton').addEventListener('mousedown', function(e) {
            console.log('🖱️ UPLOAD: Mouse down detected');
            e.stopPropagation();
        }, true);
        
        document.getElementById('uploadButton').addEventListener('mouseup', function(e) {
            console.log('🖱️ UPLOAD: Mouse up detected');
            e.stopPropagation();
        }, true);
        
        document.getElementById('settingsIcon').addEventListener('mousedown', function(e) {
            console.log('🖱️ SETTINGS: Mouse down detected');
            e.stopPropagation();
        }, true);
        
        document.getElementById('settingsIcon').addEventListener('mouseup', function(e) {
            console.log('🖱️ SETTINGS: Mouse up detected');
            e.stopPropagation();
        }, true);
        
        // Add back button handlers for Pages 10 and 11
        // Page 10 back button - return to camera page (Page 8)
        const page10BackButton = document.querySelector('#page10 .cursor-pointer');
        if (page10BackButton) {
            page10BackButton.addEventListener('click', function(e) {
                console.log('🔙 Page 10 back button clicked');
                e.stopPropagation();
                e.preventDefault();
                
                // Hide Page 10
                const analyzingPage = document.getElementById('page10');
                if (analyzingPage) {
                    analyzingPage.classList.add('hidden');
                    analyzingPage.classList.remove('show');
                }
                
                // Show Page 8 (camera) and reinitialize camera
                const cameraPage = document.getElementById('page8');
                if (cameraPage) {
                    cameraPage.classList.remove('hidden');
                    cameraPage.classList.add('show');
                    
                    // Reinitialize camera if it's not already running
                    if (!stream) {
                        initializeCamera();
                    }
                }
                
                showDebugInfo('Returned to camera from analysis');
            }, true);
        }
        
        // Page 11 back button - return to Page 10 or camera
        const page11BackButton = document.querySelector('#page11 .cursor-pointer');
        if (page11BackButton) {
            page11BackButton.addEventListener('click', function(e) {
                console.log('🔙 Page 11 back button clicked');
                e.stopPropagation();
                e.preventDefault();
                
                // Hide Page 11
                const galleryPage = document.getElementById('page11');
                if (galleryPage) {
                    galleryPage.classList.add('hidden');
                    galleryPage.classList.remove('show');
                }
                
                // Show Page 8 (camera) and reinitialize camera
                const cameraPage = document.getElementById('page8');
                if (cameraPage) {
                    cameraPage.classList.remove('hidden');
                    cameraPage.classList.add('show');
                    
                    // Reinitialize camera if it's not already running
                    if (!stream) {
                        initializeCamera();
                    }
                }
                
                showDebugInfo('Returned to camera from gallery prep');
            }, true);
        }
        
        // Volume Slider Functionality
        function initVolumeSlider() {
            const slider = document.getElementById('volumeSlider');
            const handle = document.getElementById('volumeHandle');
            const progress = document.getElementById('volumeProgress');
            
            if (!slider || !handle || !progress) return;
            
            let currentVolume = 6; // Start at 6% as shown in design
            const maxWidth = 248; // Slider width
            
            function updateSlider(volume) {
                const widthPx = Math.max(16, (volume / 100) * maxWidth); // Minimum 16px
                const handlePos = Math.max(8, widthPx - 8); // Handle position
                
                progress.style.width = widthPx + 'px';
                handle.style.left = handlePos + 'px';
                
                // Store volume for persistence
                localStorage.setItem('backgroundMusicVolume', volume);
                
                showDebugInfo(`Volume: ${Math.round(volume)}%`);
            }
            
            function handleSliderInteraction(e) {
                const rect = slider.getBoundingClientRect();
                const x = (e.touches ? e.touches[0].clientX : e.clientX) - rect.left;
                const newVolume = Math.max(6, Math.min(100, (x / maxWidth) * 100)); // Min 6%, Max 100%
                
                currentVolume = newVolume;
                updateSlider(currentVolume);
            }
            
            let isDragging = false;
            
            // Mouse events
            slider.addEventListener('click', handleSliderInteraction);
            
            handle.addEventListener('mousedown', (e) => {
                isDragging = true;
                e.preventDefault();
            });
            
            document.addEventListener('mousemove', (e) => {
                if (!isDragging) return;
                handleSliderInteraction(e);
            });
            
            document.addEventListener('mouseup', () => {
                isDragging = false;
            });
            
            // Touch events for mobile
            slider.addEventListener('touchstart', handleSliderInteraction);
            
            handle.addEventListener('touchstart', (e) => {
                isDragging = true;
                e.preventDefault();
            });
            
            document.addEventListener('touchmove', (e) => {
                if (!isDragging) return;
                e.preventDefault();
                handleSliderInteraction(e);
            });
            
            document.addEventListener('touchend', () => {
                isDragging = false;
            });
            
            // Load saved volume or use default
            const savedVolume = localStorage.getItem('backgroundMusicVolume');
            if (savedVolume) {
                currentVolume = parseFloat(savedVolume);
            }
            updateSlider(currentVolume);
            
            console.log('✅ Volume slider initialized');
        }
        
        // Initialize volume slider when page 17 is shown
        function showVolumeSettings() {
            showPage(17);
            setTimeout(() => {
                initVolumeSlider();
            }, 100);
        }

        // Initialize language preference
        function initLanguagePreference() {
            const savedLanguage = localStorage.getItem('selectedLanguage');
            if (savedLanguage) {
                const languageToggle = document.getElementById('languageToggle');
                if (languageToggle) {
                    languageToggle.querySelector('p').textContent = savedLanguage;
                }
            }
        }

        // Test if functions are available globally
        setTimeout(() => {
            console.log('🧪 Testing global functions availability:');
            console.log('handleUpload available?', typeof window.handleUpload);
            console.log('handleSettings available?', typeof window.handleSettings);
            console.log('Current page:', currentPage);
            console.log('Page 3 visible?', document.getElementById('page3').classList.contains('page-active'));
            
            // Initialize language preference
            initLanguagePreference();
        }, 2000);
        
        // Setup live room button interactions
        setTimeout(() => {
            setupLiveRoomButtons();
            
            // Initialize barrage monitoring system globally
            startBarrageMonitoring();
            
            // Setup initial character message click handlers
            setTimeout(() => {
                if (window.setupBulletScreenNavigation) {
                    window.setupBulletScreenNavigation();
                }
            }, 500);
        }, 100);

        // Message Input Functions for Page 14
        function showMessageInput() {
            console.log('🎯 Navigating from Page 13 to Page 14 (Message Input)');
            
            // Hide page 13
            const page13 = document.getElementById('page13');
            if (page13) {
                page13.classList.add('hidden');
                page13.classList.remove('page-active');
            }
            
            // Show page 14
            const page14 = document.getElementById('page14');
            if (page14) {
                page14.classList.remove('hidden');
                page14.classList.add('page-active');
                
                // Focus on the input field
                setTimeout(() => {
                    const messageInput = document.getElementById('messageInput');
                    if (messageInput) {
                        messageInput.focus();
                    }
                }, 100);
                
                // Initialize page 14 bullet screen system
                initializePage14BulletScreen();
            }
        }

        function initializePage14BulletScreen() {
            console.log('� Initializing Page 14 bullet screen system');
            
            // Start the bullet screen animation system for page 14 immediately
            startPage14BarrageSystem();
            
            // Setup click handlers for navigation
            setupPage14BulletScreenNavigation();
        }

        function startPage14BarrageSystem() {
            console.log('🚀 Starting Page 14 barrage system');
            
            // Initialize page 14 specific barrage data
            if (!window.page14BarrageData) {
                window.page14BarrageData = {
                    isScrolling: true,
                    scrollInterval: null,
                    messageInterval: null,
                    emojiInterval: null
                };
            }

            const page14ChatContainer = document.getElementById('page14ChatContainer');
            const page14ChatMessages = document.getElementById('page14ChatMessages');
            
            if (!page14ChatContainer || !page14ChatMessages) {
                console.log('❌ Page 14 chat containers not found');
                return;
            }

            // Apply continuous scrolling animation immediately (like page 13)
            page14ChatMessages.classList.remove('barrage-continuous-scroll');
            
            // Force reflow and apply animation
            requestAnimationFrame(() => {
                page14ChatMessages.classList.add('barrage-continuous-scroll');
                console.log('✅ Page 14 barrage continuous scrolling animation applied');
            });
            
            // Add periodic new messages like page 13 (same interval)
            window.page14BarrageData.messageInterval = setInterval(() => {
                addRandomMessageToPage14();
            }, 6000); // Match page 13's 6-second interval

            console.log('✅ Page 14 barrage system started with continuous scrolling');
        }

        function addRandomMessageToPage14() {
            const dynamicMessages = [
                { img: './src/assets/d4d2ca48cd435cf039ebac7d781a1bb460198b85.png', text: 'This piece has such incredible detail!' },
                { img: './src/assets/e3ade9aa46c847d649f3684414fe999679b41c1d.png', text: 'The historical significance is amazing' },
                { img: './src/assets/d4d2ca48cd435cf039ebac7d781a1bb460198b85.png', text: 'I love the artistic technique used here' },
                { img: './src/assets/e3ade9aa46c847d649f3684414fe999679b41c1d.png', text: 'The colors are so vibrant even after centuries' },
                { img: './src/assets/d4d2ca48cd435cf039ebac7d781a1bb460198b85.png', text: 'What an incredible cultural artifact!' },
                { img: './src/assets/e3ade9aa46c847d649f3684414fe999679b41c1d.png', text: 'The craftsmanship is extraordinary' },
                { img: './src/assets/d4d2ca48cd435cf039ebac7d781a1bb460198b85.png', text: 'This tells such a compelling story' },
                { img: './src/assets/e3ade9aa46c847d649f3684414fe999679b41c1d.png', text: 'Beautiful example of period artistry' }
            ];

            const randomMsg = dynamicMessages[Math.floor(Math.random() * dynamicMessages.length)];

            const page14ChatMessages = document.getElementById('page14ChatMessages');
            if (!page14ChatMessages) return;

            const messageElement = document.createElement('div');
            messageElement.className = 'chat-message backdrop-blur-[1px] backdrop-filter bg-[rgba(0,0,0,0.3)] flex flex-row gap-2 items-center p-[7px] rounded-2xl cursor-pointer';
            messageElement.onclick = () => showIntro();
            
            messageElement.innerHTML = `
                <img alt="User" class="w-7 h-7 rounded-full" src="${randomMsg.img}" />
                <div class="text-white text-[13px] leading-[16px]" style="font-family: 'Avenir LT Std', sans-serif;">
                    ${randomMsg.text}
                </div>
            `;

            page14ChatMessages.appendChild(messageElement);

            // Remove old messages to prevent overflow (keep continuous flow)
            const allMessages = page14ChatMessages.querySelectorAll('.chat-message');
            if (allMessages.length > 20) {
                allMessages[0].remove();
            }
        }

        function setupPage14BulletScreenNavigation() {
            const page14ChatMessages = document.getElementById('page14ChatMessages');
            if (!page14ChatMessages) return;

            // Use event delegation for dynamic messages
            page14ChatMessages.addEventListener('click', function(event) {
                const messageElement = event.target.closest('.chat-message');
                if (messageElement) {
                    event.preventDefault();
                    event.stopPropagation();
                    showIntro();
                }
            });
        }

        function stopPage14BarrageSystem() {
            console.log('🛑 Stopping Page 14 barrage system');
            
            if (window.page14BarrageData) {
                if (window.page14BarrageData.messageInterval) {
                    clearInterval(window.page14BarrageData.messageInterval);
                    window.page14BarrageData.messageInterval = null;
                }
                window.page14BarrageData.isScrolling = false;
            }

            const page14ChatMessages = document.getElementById('page14ChatMessages');
            if (page14ChatMessages) {
                page14ChatMessages.classList.remove('barrage-continuous-scroll');
            }
        }

        function backToLiveRoom() {
            console.log('🔙 Navigating back from Page 14 to Page 13');
            
            // Stop page 14 barrage system
            stopPage14BarrageSystem();
            
            // Hide page 14
            const page14 = document.getElementById('page14');
            if (page14) {
                page14.classList.add('hidden');
                page14.classList.remove('page-active');
                
                // Clear the input field
                const messageInput = document.getElementById('messageInput');
                if (messageInput) {
                    messageInput.value = '';
                }
            }
            
            // Show page 13
            const page13 = document.getElementById('page13');
            if (page13) {
                page13.classList.remove('hidden');
                page13.classList.add('page-active');
            }
        }

        function sendMessage() {
            const messageInput = document.getElementById('messageInput');
            if (!messageInput || !messageInput.value.trim()) {
                console.log('⚠️ No message to send');
                return;
            }
            
            const messageText = messageInput.value.trim();
            console.log('📤 Sending message:', messageText);
            
            // Clear input immediately for instant feedback
            messageInput.value = '';
            
            // Add message to page 14 bullet screen immediately (no delay)
            addUserMessageToPage14BulletScreen(messageText);
            
            // Add message to page 13 bullet screen system
            addMessageToBulletScreen(messageText);
            
            // Show confirmation
            showDebugInfo(`📤 Message sent: "${messageText}"`);
        }

        function addUserMessageToPage14BulletScreen(messageText) {
            const page14ChatMessages = document.getElementById('page14ChatMessages');
            if (!page14ChatMessages) return;
            
            // Create new message element for page 14 bullet screen with immediate appearance
            const messageElement = document.createElement('div');
            // Remove chat-message-new class to eliminate fade-in delay - message appears instantly
            messageElement.className = 'chat-message backdrop-blur-[1px] backdrop-filter bg-[rgba(0,0,0,0.3)] flex flex-row gap-2 items-center p-[7px] rounded-2xl cursor-pointer';
            messageElement.onclick = () => showIntro();
            
            messageElement.innerHTML = `
                <img alt="User Avatar" class="w-7 h-7 rounded-full" src="./src/assets/fb5cbc298c5f876217f162c4522b076b5a9b5e05.png" />
                <div class="text-white text-[13px] leading-[16px]" style="font-family: 'Avenir LT Std', sans-serif;">
                    ${messageText}
                </div>
            `;
            
            // Add to page 14 chat messages immediately - appears in bullet stream right away with no delay
            page14ChatMessages.appendChild(messageElement);
            
            // Remove old messages to prevent overflow (keep continuous flow)
            const allMessages = page14ChatMessages.querySelectorAll('.chat-message');
            if (allMessages.length > 20) {
                allMessages[0].remove();
            }
            
            console.log('✅ User message added to page 14 bullet screen instantly (no animation delay)');
        }

        function addMessageToBulletScreen(messageText) {
            // Add message to page 13 bullet screen system
            const page13ChatContainer = document.getElementById('chatMessages');
            if (!page13ChatContainer) return;
            
            // Create new message element for page 13
            const messageElement = document.createElement('div');
            messageElement.className = 'chat-message backdrop-blur-[1px] backdrop-filter bg-[rgba(0,0,0,0.3)] flex flex-row gap-2 items-center p-[7px] rounded-2xl cursor-pointer smooth-message-flow';
            messageElement.onclick = () => showIntro();
            
            messageElement.innerHTML = `
                <div class="w-7 h-7 rounded-full overflow-hidden flex-shrink-0">
                    <img alt="User Avatar" class="w-full h-full object-cover" src="./src/assets/fb5cbc298c5f876217f162c4522b076b5a9b5e05.png" />
                </div>
                <div class="text-white text-[13px] font-['Avenir_LT_Std:45_Book',_sans-serif] leading-[16px] flex-1">
                    ${messageText}
                </div>
            `;
            
            // Add to page 13 chat container
            page13ChatContainer.appendChild(messageElement);
            
            // Trigger scroll animation if barrage system is active
            if (window.barrageData && window.barrageData.isScrolling) {
                messageElement.classList.add('barrage-continuous-scroll');
            }
            
            // Remove old messages to prevent overflow
            const allMessages = page13ChatContainer.querySelectorAll('.chat-message');
            if (allMessages.length > 20) {
                allMessages[0].remove();
            }
        }

        function handleMessageInputKeyPress(event) {
            if (event.key === 'Enter') {
                sendMessage();
            }
        }

        // Virtual keyboard functions
        function addToInput(char) {
            const messageInput = document.getElementById('messageInput');
            if (messageInput) {
                messageInput.value += char;
                messageInput.focus();
            }
        }

        function deleteLastChar() {
            const messageInput = document.getElementById('messageInput');
            if (messageInput && messageInput.value.length > 0) {
                messageInput.value = messageInput.value.slice(0, -1);
                messageInput.focus();
            }
        }

        // Space key function for virtual keyboard
        function addSpace() {
            addToInput(' ');
        }

        // Make functions globally available
        window.showMessageInput = showMessageInput;
        window.backToLiveRoom = backToLiveRoom;
        window.sendMessage = sendMessage;
        window.handleMessageInputKeyPress = handleMessageInputKeyPress;
        window.addToInput = addToInput;
        window.deleteLastChar = deleteLastChar;
        window.addSpace = addSpace;

        // Function to show character intro page (Page 15)
        function showIntro() {
            console.log('🎭 Opening character intro page...');
            showPage(15);
            showDebugInfo('Opened character intro from bullet screen message');
        }

        // Export showIntro to global scope
        window.showIntro = showIntro;

        // Test settings functionality
        function testSettingsModal() {
            console.log('🧪 Testing settings modal functionality...');
            
            // Test opening settings
            setTimeout(() => {
                console.log('🔧 Testing handleSettings()...');
                handleSettings();
                
                // Test closing settings after 2 seconds
                setTimeout(() => {
                    console.log('🔙 Testing handleBackFromSettings()...');
                    handleBackFromSettings();
                }, 2000);
            }, 1000);
        }

        // Add global test function
        window.testSettingsModal = testSettingsModal;

        // Initialize the app when DOM is loaded
        document.addEventListener('DOMContentLoaded', function() {
            console.log('🎬 DOM loaded - Starting opening sequence...');
            startOpeningSequence();
            
            // Optional: uncomment to test settings automatically
            // setTimeout(testSettingsModal, 5000);
        });
    </script>
</body>
</html>
